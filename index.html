<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI内容管理后台 - 创意工具</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: #f5f5f5;
            color: #333;
            overflow-y: auto;
            height: 100vh;
        }

        .app-container {
            display: flex;
            height: 100vh;
            background-color: #fff;
        }

        .sidebar {
            width: 240px;
            background: linear-gradient(180deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px 0;
        }

        .logo {
            padding: 0 20px 20px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            margin-bottom: 20px;
        }

        .logo h1 {
            font-size: 16px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .nav-menu {
            list-style: none;
        }

        .nav-item {
            margin-bottom: 4px;
        }

        .nav-link {
            display: flex;
            align-items: center;
            padding: 12px 20px;
            color: rgba(255,255,255,0.8);
            text-decoration: none;
            transition: all 0.3s;
            border-radius: 0 20px 20px 0;
            margin-right: 20px;
        }

        .nav-link:hover {
            background-color: rgba(255,255,255,0.1);
            color: white;
        }

        .nav-link.active {
            background-color: rgba(255,255,255,0.2);
            color: white;
        }

        .sub-menu {
            list-style: none;
            margin-left: 20px;
            margin-top: 8px;
        }

        .sub-menu .nav-link {
            padding: 8px 20px;
            font-size: 14px;
        }

        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .header {
            height: 60px;
            background: white;
            border-bottom: 1px solid #e8e8e8;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 24px;
        }

        .breadcrumb {
            font-size: 16px;
            font-weight: 500;
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }

        @media (max-width: 768px) {
            .btn {
                padding: 10px 16px;
                font-size: 16px;
            }
        }

        .btn-primary {
            background-color: #1890ff;
            color: white;
        }

        .btn-primary:hover {
            background-color: #40a9ff;
        }

        .btn-secondary {
            background-color: #f0f0f0;
            color: #333;
        }

        .content-area {
            flex: 1;
            display: flex;
            padding: 24px;
            gap: 24px;
            overflow-y: auto;
        }

        .panel {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .panel-header {
            padding: 16px 20px;
            border-bottom: 1px solid #f0f0f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .panel-header .btn {
            margin-left: 8px;
        }

        .panel-title {
            font-size: 16px;
            font-weight: 500;
        }

        .panel-content {
            padding: 20px;
            height: calc(100% - 60px);
            overflow-y: auto;
        }

        .left-panel {
            width: 450px;
            min-width: 350px;
            display: flex;
            flex-direction: column;
        }

        .middle-panel {
            flex: 1;
            min-width: 300px;
            display: flex;
            flex-direction: column;
        }

        .right-panel {
            width: 350px;
            min-width: 300px;
            display: flex;
            flex-direction: column;
        }

        /* 确保右侧面板显示 */
        .content-area {
            flex: 1;
            display: flex;
            padding: 24px;
            gap: 24px;
            overflow-y: auto;
            min-height: 0;
            background-color: #f5f5f5;
        }

        .left-panel, .middle-panel, .right-panel {
            display: flex;
            flex-direction: column;
            min-height: 0;
        }



        /* 抽屉组件样式 */
        .drawer-container {
            position: relative;
        }

        .drawer-toggle {
            position: fixed;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            z-index: 1001;
            background: #1890ff;
            color: white;
            border: none;
            border-radius: 50%;
            width: 48px;
            height: 48px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
            transition: all 0.3s ease;
        }

        .drawer-toggle:hover {
            background: #40a9ff;
            transform: translateY(-50%) scale(1.1);
        }

        .drawer-panel {
            position: fixed;
            right: 0;
            top: 0;
            width: 320px;
            height: 100vh;
            background: white;
            z-index: 1000;
            transform: translateX(100%);
            transition: transform 0.3s ease;
            box-shadow: -2px 0 8px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
        }

        .drawer-panel.open {
            transform: translateX(0);
        }

        .drawer-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(0,0,0,0.5);
            z-index: 999;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .drawer-overlay.show {
            opacity: 1;
            visibility: visible;
        }

        .drawer-header {
            padding: 20px;
            border-bottom: 1px solid #f0f0f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: white;
        }

        .drawer-title {
            font-size: 18px;
            font-weight: 500;
            color: #333;
        }

        .drawer-close {
            background: none;
            border: none;
            font-size: 20px;
            cursor: pointer;
            color: #666;
            padding: 4px;
            border-radius: 4px;
            transition: all 0.2s;
        }

        .drawer-close:hover {
            background: #f5f5f5;
            color: #333;
        }

        .drawer-content {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
        }

        /* 响应式设计 */
        @media (max-width: 1200px) {
            .content-area {
                gap: 16px;
            }
            
            .left-panel {
                width: 450px;
                min-width: 350px;
            }
            
            .middle-panel {
                flex: 1;
                min-width: auto;
            }
            
            .drawer-panel {
                width: 300px;
            }
        }

        @media (max-width: 768px) {
            .app-container {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
                height: auto;
                padding: 10px 0;
            }
            
            .main-content {
                width: 100%;
            }
            
            .content-area {
                padding: 16px;
                gap: 12px;
            }
            
            .left-panel {
                width: 100%;
                min-width: auto;
            }
            
            .middle-panel {
                width: 100%;
                min-width: auto;
            }
            
            .panel-header {
                padding: 12px 16px;
                flex-direction: column;
                gap: 8px;
                align-items: flex-start;
            }
            
            .panel-content {
                padding: 16px;
            }
            
            .radio-group {
                flex-direction: column;
                gap: 8px;
            }
            
            .input-group {
                flex-direction: column;
                gap: 8px;
            }
            
            .input-group .form-input {
                width: 100%;
            }
            
            .input-group .btn {
                width: 100%;
            }
            
            .drawer-panel {
                width: 100vw;
            }
            
            .drawer-toggle {
                right: 16px;
                width: 44px;
                height: 44px;
            }
        }

        @media (max-width: 480px) {
            .header {
                padding: 0 16px;
                flex-direction: column;
                height: auto;
                gap: 8px;
                padding: 12px 16px;
            }
            
            .header-actions {
                flex-direction: column;
                gap: 8px;
                align-items: flex-start;
            }
            
            .panel-header {
                padding: 10px 12px;
            }
            
            .panel-content {
                padding: 12px;
            }
            
            .form-section {
                margin-bottom: 16px;
            }
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
        }

        .form-label.required::after {
            content: '*';
            color: #ff4d4f;
            margin-left: 4px;
        }

        .form-input {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #d9d9d9;
            border-radius: 6px;
            font-size: 14px;
        }

        .form-input:focus {
            outline: none;
            border-color: #1890ff;
            box-shadow: 0 0 0 2px rgba(24, 144, 255, 0.2);
        }

        .radio-group {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .radio-group label {
            display: flex;
            align-items: center;
            gap: 5px;
            cursor: pointer;
            user-select: none;
        }

        .radio-group input[type="radio"] {
            cursor: pointer;
        }

        .upload-area {
            border: 2px dashed #d9d9d9;
            border-radius: 8px;
            padding: 40px;
            text-align: center;
            cursor: pointer;
            background: #fafafa;
            transition: all 0.3s;
        }

        @media (max-width: 768px) {
            .upload-area {
                padding: 20px;
            }
            
            .ratio-options {
                grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
                gap: 8px;
            }
            
            .ratio-option {
                padding: 8px;
            }
            
            .ratio-visual {
                margin-bottom: 6px;
            }
            
            .ratio-label {
                font-size: 11px;
            }
            
            .ratio-value {
                font-size: 10px;
            }
        }

        .upload-area:hover {
            border-color: #1890ff;
            background: #f0f8ff;
        }

        .upload-area .material-icons {
            font-size: 48px;
            color: #d9d9d9;
            margin-bottom: 10px;
        }

        .upload-area:hover .material-icons {
            color: #1890ff;
        }

        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #999;
        }

        .empty-state .material-icons {
            font-size: 48px;
            color: #d9d9d9;
            margin-bottom: 16px;
        }

        .form-section {
            margin-bottom: 24px;
        }

        .form-section h4 {
            margin-bottom: 12px;
            color: #333;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .form-section .help-icon {
            color: #999;
            font-size: 14px;
            cursor: help;
        }

        .custom-ratio-inputs {
            background: #f9f9f9;
            padding: 16px;
            border-radius: 8px;
            border: 1px solid #e8e8e8;
            margin-top: 12px;
        }

        .ratio-input-group {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 8px;
        }

        .ratio-input {
            width: 80px;
            text-align: center;
        }

        .ratio-separator {
            font-weight: bold;
            color: #666;
            font-size: 16px;
        }

        .ratio-hint {
            font-size: 12px;
            color: #999;
            margin-top: 4px;
        }

        /* 可视化比例组件样式 */
        .ratio-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 12px;
            margin-top: 8px;
        }

        .ratio-option {
            position: relative;
            cursor: pointer;
            border: 2px solid #e8e8e8;
            border-radius: 8px;
            padding: 12px;
            background: white;
            transition: all 0.2s ease;
            text-align: center;
        }

        .ratio-option:hover {
            border-color: #40a9ff;
            background: #f0f8ff;
        }

        .ratio-option.selected {
            border-color: #1890ff;
            background: #e6f7ff;
        }

        .ratio-option input[type="radio"] {
            position: absolute;
            opacity: 0;
            width: 0;
            height: 0;
        }

        .ratio-visual {
            width: 60px;
            height: 40px;
            margin: 0 auto 8px;
            border: 2px solid #d9d9d9;
            border-radius: 4px;
            background: #fafafa;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            transition: all 0.2s ease;
        }

        .ratio-option:hover .ratio-visual {
            border-color: #40a9ff;
            background: #f0f8ff;
        }

        .ratio-option.selected .ratio-visual {
            border-color: #1890ff;
            background: #e6f7ff;
        }

        /* 不同比例的可视化样式 */
        .ratio-visual.ratio-9-16 {
            width: 24px;
            height: 36px;
        }

        .ratio-visual.ratio-2-3 {
            width: 26px;
            height: 36px;
        }

        .ratio-visual.ratio-16-9 {
            width: 48px;
            height: 27px;
        }

        .ratio-visual.ratio-3-2 {
            width: 45px;
            height: 30px;
        }

        .ratio-visual.ratio-custom {
            width: 40px;
            height: 30px;
            background: linear-gradient(45deg, #f0f0f0 25%, transparent 25%), 
                        linear-gradient(-45deg, #f0f0f0 25%, transparent 25%), 
                        linear-gradient(45deg, transparent 75%, #f0f0f0 75%), 
                        linear-gradient(-45deg, transparent 75%, #f0f0f0 75%);
            background-size: 6px 6px;
            background-position: 0 0, 0 3px, 3px -3px, -3px 0px;
        }

        .ratio-label {
            font-size: 12px;
            color: #666;
            font-weight: 500;
            margin-bottom: 2px;
        }

        .ratio-option.selected .ratio-label {
            color: #1890ff;
            font-weight: 600;
        }

        .ratio-value {
            font-size: 11px;
            color: #999;
        }

        .ratio-option.selected .ratio-value {
            color: #1890ff;
        }

        .custom-ratio-card {
            border: 2px dashed #d9d9d9;
            background: #fafafa;
        }

        .custom-ratio-card:hover {
            border-color: #40a9ff;
            background: #f0f8ff;
        }

        .custom-ratio-card.selected {
            border-color: #1890ff;
            background: #e6f7ff;
        }

        /* 图片创作页面样式 */
        .image-type-tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 12px;
        }

        .image-type-tabs .tab {
            padding: 6px 12px;
            border: 1px solid #d9d9d9;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.2s;
        }

        .image-type-tabs .tab.active {
            background: #1890ff;
            color: white;
            border-color: #1890ff;
        }

        .image-label {
            font-size: 11px;
            color: #666;
            text-align: center;
            margin-top: 4px;
            line-height: 1.2;
        }

        .filter-tabs {
            display: flex;
            gap: 4px;
        }

        .filter-tab {
            padding: 4px 8px;
            border: 1px solid #d9d9d9;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.2s;
            background: white;
        }

        .filter-tab:hover {
            border-color: #40a9ff;
        }

        .filter-tab.active {
            background: #1890ff;
            color: white;
            border-color: #1890ff;
        }

        .template-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 16px;
            margin-top: 20px;
        }

        .template-item {
            border: 2px solid #e8e8e8;
            border-radius: 8px;
            overflow: hidden;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
        }

        .template-item:hover {
            border-color: #40a9ff;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .template-item.selected {
            border-color: #1890ff;
            background: #e6f7ff;
        }

        .template-item img {
            width: 100%;
            height: 150px;
            object-fit: cover;
        }

        .template-checkbox {
            position: absolute;
            top: 8px;
            right: 8px;
            width: 20px;
            height: 20px;
            background: rgba(255,255,255,0.9);
            border: 2px solid #d9d9d9;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 12px;
        }

        .template-item.selected .template-checkbox {
            background: #1890ff;
            border-color: #1890ff;
        }

        .template-info {
            padding: 8px;
            background: white;
        }

        .template-title {
            font-size: 12px;
            color: #333;
            margin-bottom: 4px;
        }

        .template-price {
            font-size: 11px;
            color: #ff4d4f;
            font-weight: 500;
        }

        /* 模板配置按钮样式 */
        .template-config-btn {
            position: absolute;
            bottom: 8px;
            right: 8px;
            background: rgba(24, 144, 255, 0.9);
            color: white;
            border: none;
            border-radius: 4px;
            padding: 4px 8px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 10;
        }

        .template-config-btn:hover {
            background: rgba(24, 144, 255, 1);
            transform: scale(1.05);
        }

        .config-label {
            font-weight: 500;
        }

        /* 结果页面样式 */
        .result-panel {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .result-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .result-actions {
            display: flex;
            gap: 8px;
        }

        .result-image {
            width: 100%;
            max-width: 400px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .edit-options {
            margin-top: 16px;
            padding: 16px;
            background: #f9f9f9;
            border-radius: 6px;
        }

        .edit-options h4 {
            margin-bottom: 12px;
            color: #333;
        }

        .edit-tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 12px;
        }

        .edit-tab {
            padding: 6px 12px;
            border: 1px solid #d9d9d9;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            background: white;
        }

        .edit-tab.active {
            background: #1890ff;
            color: white;
            border-color: #1890ff;
        }

        /* 美化编辑面板样式 */
        .edit-tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 20px;
            padding: 0 4px;
        }

        .edit-tab {
            padding: 10px 16px;
            border: 2px solid #e8e8e8;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            background: white;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .edit-tab:hover {
            border-color: #1890ff;
            background: #f0f8ff;
        }

        .edit-tab.active {
            background: linear-gradient(135deg, #1890ff, #40a9ff);
            color: white;
            border-color: #1890ff;
            box-shadow: 0 4px 12px rgba(24, 144, 255, 0.3);
        }

        .edit-filters {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 20px;
        }

        .filter-group {
            display: flex;
            gap: 12px;
            margin-bottom: 16px;
            flex-wrap: wrap;
        }

        .form-select {
            padding: 8px 12px;
            border: 1px solid #d9d9d9;
            border-radius: 6px;
            font-size: 14px;
            background: white;
            min-width: 100px;
            transition: all 0.3s ease;
        }

        .form-select:focus {
            border-color: #1890ff;
            box-shadow: 0 0 0 2px rgba(24, 144, 255, 0.2);
            outline: none;
        }

        .search-group {
            display: flex;
            gap: 8px;
            align-items: center;
            flex-wrap: wrap;
        }

        .form-input {
            flex: 1;
            padding: 8px 12px;
            border: 1px solid #d9d9d9;
            border-radius: 6px;
            font-size: 14px;
            transition: all 0.3s ease;
            min-width: 200px;
        }

        .form-input:focus {
            border-color: #1890ff;
            box-shadow: 0 0 0 2px rgba(24, 144, 255, 0.2);
            outline: none;
        }

        .edit-grid {
            flex: 1;
            overflow-y: auto;
            padding: 4px;
            background-color: #f8f9fa;
        }

        .edit-grid-content {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            gap: 16px;
            padding: 8px;
        }

        .edit-item {
            position: relative;
            border: 2px solid transparent;
            border-radius: 12px;
            cursor: pointer;
            overflow: hidden;
            background: white;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }

        .edit-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.15);
            border-color: #1890ff;
        }

        .edit-item.selected {
            border-color: #1890ff;
            box-shadow: 0 4px 16px rgba(24, 144, 255, 0.3);
        }

        .edit-item img {
            width: 100%;
            height: 120px;
            object-fit: cover;
            border-radius: 8px 8px 0 0;
        }

        .edit-item-info {
            padding: 12px;
            background: white;
        }

        .edit-item-title {
            font-size: 13px;
            font-weight: 500;
            margin-bottom: 4px;
            color: #333;
            line-height: 1.3;
        }

        .edit-item-price {
            font-size: 12px;
            color: #ff4d4f;
            font-weight: 600;
        }

        .edit-checkbox {
            position: absolute;
            top: 8px;
            right: 8px;
            width: 20px;
            height: 20px;
            border: 2px solid #ddd;
            border-radius: 50%;
            background: white;
            transition: all 0.3s ease;
        }

        .edit-item.selected .edit-checkbox {
            background: #1890ff;
            border-color: #1890ff;
        }

        .edit-item.selected .edit-checkbox::after {
            content: '✓';
            color: white;
            font-size: 12px;
            font-weight: bold;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        /* 禁用状态样式 */
        .edit-item.disabled {
            opacity: 0.5;
            pointer-events: none;
            cursor: not-allowed;
        }

        .edit-item.disabled:hover {
            transform: none;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            border-color: transparent;
        }

        /* 编辑操作按钮样式 */
        .edit-actions {
            display: flex;
            gap: 12px;
            align-items: center;
        }

        .edit-actions .btn {
            padding: 10px 20px;
            font-weight: 500;
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        .edit-actions .btn-primary {
            background: linear-gradient(135deg, #1890ff, #40a9ff);
            border: none;
            box-shadow: 0 2px 8px rgba(24, 144, 255, 0.3);
        }

        .edit-actions .btn-primary:hover {
            background: linear-gradient(135deg, #40a9ff, #69c0ff);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(24, 144, 255, 0.4);
        }

        /* 生成记录样式 */
        .generation-section {
            margin-bottom: 24px;
            border: 1px solid #e8e8e8;
            border-radius: 8px;
            background: white;
        }

        .product-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 16px;
            background: #fafafa;
            border-bottom: 1px solid #e8e8e8;
        }

        .product-details {
            display: flex;
            gap: 16px;
            align-items: center;
        }

        .product-id {
            font-weight: 500;
            color: #333;
        }

        .generation-time {
            color: #666;
            font-size: 12px;
        }

        .image-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 12px;
            padding: 16px;
        }

        .image-item {
            position: relative;
            background: white;
            border-radius: 6px;
            overflow: hidden;
            border: 1px solid #e8e8e8;
        }

        .image-id {
            position: absolute;
            top: 8px;
            left: 8px;
            background: #ffd700;
            color: white;
            padding: 2px 6px;
            font-size: 11px;
            font-weight: 500;
            border-radius: 3px;
            z-index: 10;
        }

        .image-item img {
            width: 100%;
            height: 120px;
            object-fit: cover;
            display: block;
        }

        .image-actions {
            display: flex;
            gap: 4px;
            padding: 8px;
            background: #fafafa;
        }

        .image-actions .btn {
            flex: 1;
            padding: 4px 6px;
            font-size: 10px;
            border-radius: 3px;
            border: 1px solid #d9d9d9;
            background: #f5f5f5;
            color: #666;
        }

        .image-actions .btn-primary {
            background: #1890ff;
            color: white;
            border-color: #1890ff;
        }

        .image-actions .btn-secondary {
            background: #f5f5f5;
            color: #666;
            border-color: #d9d9d9;
        }

        .btn-feedback {
            background: #f5f5f5;
            color: #666;
            border: 1px solid #d9d9d9;
            font-size: 12px;
        }

        /* 配置弹窗样式 */
        .config-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
        }

        .config-modal-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
        }

        .config-modal-content {
            position: relative;
            background: white;
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
            width: 90%;
            max-width: 800px;
            max-height: 80vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .config-modal-header {
            padding: 20px 24px;
            border-bottom: 1px solid #f0f0f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .config-modal-header h3 {
            margin: 0;
            font-size: 18px;
            font-weight: 600;
        }

        .config-modal-close {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #999;
            padding: 0;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.3s ease;
        }

        .config-modal-close:hover {
            background: #f5f5f5;
            color: #333;
        }

        .config-modal-body {
            flex: 1;
            padding: 24px;
            overflow-y: auto;
        }

        .config-tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 20px;
            padding: 0 4px;
        }

        .config-tab {
            padding: 10px 16px;
            border: 2px solid #e8e8e8;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            background: white;
            transition: all 0.3s ease;
        }

        .config-tab:hover {
            border-color: #1890ff;
            background: #f0f8ff;
        }

        .config-tab.active {
            background: linear-gradient(135deg, #1890ff, #40a9ff);
            color: white;
            border-color: #1890ff;
            box-shadow: 0 4px 12px rgba(24, 144, 255, 0.3);
        }

        .config-grid {
            flex: 1;
            overflow-y: auto;
            padding: 4px;
        }

        .config-grid-content {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            gap: 16px;
            padding: 8px;
        }

        .config-item {
            position: relative;
            border: 2px solid transparent;
            border-radius: 12px;
            cursor: pointer;
            overflow: hidden;
            background: white;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }

        .config-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.15);
            border-color: #1890ff;
        }

        .config-item.selected {
            border-color: #1890ff;
            box-shadow: 0 4px 16px rgba(24, 144, 255, 0.3);
        }

        .config-item img {
            width: 100%;
            height: 120px;
            object-fit: cover;
            border-radius: 8px 8px 0 0;
        }

        .config-item-info {
            padding: 12px;
            background: white;
        }

        .config-item-title {
            font-size: 13px;
            font-weight: 500;
            margin-bottom: 4px;
            color: #333;
            line-height: 1.3;
        }

        .config-checkbox {
            position: absolute;
            top: 8px;
            right: 8px;
            width: 20px;
            height: 20px;
            border: 2px solid #ddd;
            border-radius: 50%;
            background: white;
            transition: all 0.3s ease;
        }

        .config-item.selected .config-checkbox {
            background: #1890ff;
            border-color: #1890ff;
        }

        .config-item.selected .config-checkbox::after {
            content: '✓';
            color: white;
            font-size: 12px;
            font-weight: bold;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        .config-modal-footer {
            padding: 20px 24px;
            border-top: 1px solid #f0f0f0;
            display: flex;
            justify-content: flex-end;
            gap: 12px;
        }

        /* 生成结果页面样式 */
        .result-panel {
            height: 100%;
            display: flex;
            flex-direction: column;
        }

        .result-header {
            padding: 16px;
            border-bottom: 1px solid #eee;
        }

        .result-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .result-actions {
            display: flex;
            gap: 8px;
        }

        .main-preview {
            flex: 1;
            padding: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #f8f9fa;
        }

        .result-image {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }

        .generated-thumbnails {
            display: flex;
            gap: 8px;
            padding: 16px;
            border-top: 1px solid #eee;
            overflow-x: auto;
        }

        .thumbnail-item {
            position: relative;
            width: 80px;
            height: 80px;
            border: 2px solid transparent;
            border-radius: 4px;
            cursor: pointer;
            flex-shrink: 0;
        }

        .thumbnail-item.selected {
            border-color: #1890ff;
        }

        .thumbnail-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 2px;
        }

        .thumbnail-id {
            position: absolute;
            bottom: 2px;
            left: 2px;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 1px 4px;
            border-radius: 2px;
            font-size: 10px;
        }

        .thumbnail-close {
            position: absolute;
            top: 2px;
            right: 2px;
            background: rgba(255, 0, 0, 0.8);
            color: white;
            border: none;
            border-radius: 50%;
            width: 16px;
            height: 16px;
            font-size: 10px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .failed-placeholder {
            width: 100%;
            height: 100%;
            background: #f0f0f0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: #999;
            font-size: 12px;
        }

        .failed-placeholder .material-icons {
            font-size: 20px;
            margin-bottom: 4px;
        }

        /* 编辑面板样式 */
        .edit-panel {
            height: 100%;
            display: flex;
            flex-direction: column;
        }

        .edit-header {
            padding: 16px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .edit-content {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .edit-tabs {
            display: flex;
            padding: 16px 16px 0;
            border-bottom: 1px solid #eee;
        }

        .edit-filters {
            padding: 16px;
            border-bottom: 1px solid #eee;
        }

        .filter-group {
            display: flex;
            gap: 8px;
            margin-bottom: 12px;
        }

        .search-group {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .edit-grid {
            flex: 1;
            padding: 16px;
            overflow-y: auto;
            background-color: #f8f9fa;
        }

        .edit-grid-content {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 12px;
        }

        .edit-item {
            position: relative;
            border: 2px solid transparent;
            border-radius: 8px;
            cursor: pointer;
            overflow: hidden;
        }

        .edit-item.selected {
            border-color: #1890ff;
        }

        .edit-item img {
            width: 100%;
            height: 120px;
            object-fit: cover;
        }

        .edit-item-info {
            padding: 8px;
            background: white;
        }

        .edit-item-title {
            font-size: 12px;
            font-weight: 500;
            margin-bottom: 2px;
        }

        .edit-item-price {
            font-size: 11px;
            color: #ff4d4f;
        }

        .edit-checkbox {
            position: absolute;
            top: 8px;
            right: 8px;
            width: 16px;
            height: 16px;
            border: 2px solid #ddd;
            border-radius: 2px;
            background: white;
        }

        .edit-item.selected .edit-checkbox {
            background: #1890ff;
            border-color: #1890ff;
        }

        .edit-item.selected .edit-checkbox::after {
            content: '✓';
            color: white;
            font-size: 10px;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        /* 右侧面板商品详情样式 */
        .product-section, .text-section {
            margin-bottom: 20px;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .product-tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 12px;
        }

        .product-tab {
            padding: 4px 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 12px;
            cursor: pointer;
        }

        .product-tab.active {
            background: #1890ff;
            color: white;
            border-color: #1890ff;
        }

        .product-id {
            font-size: 12px;
            color: #666;
            margin-bottom: 8px;
        }

        .product-images {
            display: flex;
            gap: 8px;
            margin-bottom: 8px;
        }

        .product-image {
            position: relative;
            width: 40px;
            height: 40px;
            border: 2px solid transparent;
            border-radius: 4px;
            cursor: pointer;
        }

        .product-image.selected {
            border-color: #1890ff;
        }

        .product-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 2px;
        }

        .image-check {
            position: absolute;
            top: 2px;
            right: 2px;
            background: #1890ff;
            color: white;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            font-size: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .progress-bar {
            height: 4px;
            background: #f0f0f0;
            border-radius: 2px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: #1890ff;
            width: 0%;
        }

        .text-content {
            padding: 12px;
            background: #f8f9fa;
            border-radius: 4px;
            font-size: 12px;
            color: #999;
        }

        /* 生产结果页面专用样式 */
        .preview-container {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #f8f9fa;
        }

        .preview-paper {
            background: white;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            padding: 20px;
            max-width: 400px;
            width: 100%;
            position: relative;
        }

        .preview-paper::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 20px;
            background: repeating-linear-gradient(
                90deg,
                transparent,
                transparent 8px,
                #000 8px,
                #000 10px
            );
        }

        .paper-header {
            text-align: center;
            margin-bottom: 20px;
            padding-top: 10px;
        }

        .brand-title {
            font-size: 18px;
            font-weight: bold;
            color: #333;
            margin-bottom: 4px;
        }

        .brand-subtitle {
            font-size: 14px;
            color: #666;
        }

        .product-display {
            position: relative;
            margin-bottom: 15px;
        }

        .product-image {
            width: 100%;
            height: 200px;
            object-fit: cover;
            border-radius: 4px;
        }

        .price-tag {
            position: absolute;
            bottom: 10px;
            right: 10px;
            background: linear-gradient(135deg, #ff6b9d, #c44569);
            color: white;
            padding: 8px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            box-shadow: 0 2px 8px rgba(255, 107, 157, 0.3);
        }

        .discount {
            font-size: 10px;
            margin-bottom: 2px;
        }

        .current-price {
            font-size: 14px;
            margin-bottom: 2px;
        }

        .original-price {
            font-size: 10px;
            text-decoration: line-through;
            opacity: 0.8;
        }

        .disclaimer {
            font-size: 10px;
            color: #999;
            text-align: center;
            line-height: 1.4;
        }

        /* 头部导航样式 */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 24px;
            background: white;
            border-bottom: 1px solid #eee;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .header-left h1 {
            margin: 0;
            font-size: 18px;
            color: #333;
        }

        .header-divider {
            color: #ccc;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .header-link {
            color: #666;
            text-decoration: none;
            font-size: 14px;
            padding: 4px 8px;
            border-radius: 4px;
            transition: all 0.3s;
        }

        .header-link:hover {
            background: #f0f0f0;
            color: #333;
        }

        .upload-info {
            transition: all 0.3s ease;
        }

        .upload-info .form-group {
            transition: all 0.3s ease;
        }

        .input-group {
            display: flex;
            gap: 8px;
        }

        .input-group .form-input {
            flex: 1;
        }

        .tabs {
            display: flex;
            border-bottom: 1px solid #e8e8e8;
            margin-bottom: 20px;
        }

        .tab {
            padding: 12px 20px;
            cursor: pointer;
            border-bottom: 2px solid transparent;
        }

        .tab.active {
            color: #1890ff;
            border-bottom-color: #1890ff;
        }

        .image-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 12px;
            margin-top: 16px;
        }

        @media (max-width: 768px) {
            .image-grid {
                grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
                gap: 8px;
            }
        }

        @media (max-width: 480px) {
            .image-grid {
                grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
                gap: 6px;
            }
        }

        .image-item {
            border: 2px solid transparent;
            border-radius: 8px;
            overflow: hidden;
            cursor: pointer;
            transition: all 0.3s;
        }

        .image-item:hover {
            border-color: #1890ff;
        }

        .image-item.selected {
            border-color: #1890ff;
            background-color: rgba(24,144,255,0.1);
        }

        .image-item img {
            width: 100%;
            height: 120px;
            object-fit: cover;
        }

        .task-list {
            list-style: none;
        }

        .task-item {
            padding: 12px 16px;
            border: 1px solid #e8e8e8;
            border-radius: 6px;
            margin-bottom: 8px;
            cursor: pointer;
        }

        .task-item:hover {
            background-color: #f5f5f5;
        }

        .task-item.active {
            background-color: #e6f7ff;
            border-color: #1890ff;
        }

        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #999;
        }

        .message {
            padding: 12px 16px;
            border-radius: 6px;
            margin-bottom: 16px;
            font-size: 14px;
        }

        .message.success {
            background-color: #f6ffed;
            border: 1px solid #b7eb8f;
            color: #52c41a;
        }

        .message.warning {
            background-color: #fffbe6;
            border: 1px solid #ffe58f;
            color: #faad14;
        }

        .message.error {
            background-color: #fff2f0;
            border: 1px solid #ffccc7;
            color: #ff4d4f;
        }

        /* 加载动画 */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #1890ff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Toast提示 */
        .toast {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%) translateY(-100%);
            background: #1890ff;
            color: white;
            padding: 12px 20px;
            border-radius: 6px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            z-index: 1000;
            opacity: 0;
            transition: all 0.5s ease;
        }

        .toast.show {
            transform: translateX(-50%) translateY(0);
            opacity: 1;
        }

        /* 反馈图标 */
        .feedback-icon {
            cursor: pointer;
            color: rgba(153, 153, 153, 0.6);
            font-size: 14px;
            margin-left: 5px;
            transition: all 0.3s ease;
            opacity: 0.7;
        }

        .feedback-icon:hover {
            color: rgba(255, 77, 79, 0.8);
            opacity: 1;
        }

        /* 反馈弹窗 */
        .feedback-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1001;
        }

        .feedback-content {
            background: white;
            padding: 24px;
            border-radius: 8px;
            width: 400px;
            max-width: 90%;
        }

        .feedback-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .feedback-title {
            font-size: 16px;
            font-weight: 500;
        }

        .feedback-close {
            cursor: pointer;
            font-size: 20px;
            color: #999;
        }

        .feedback-textarea {
            width: 100%;
            min-height: 100px;
            padding: 12px;
            border: 1px solid #d9d9d9;
            border-radius: 6px;
            resize: vertical;
            font-family: inherit;
        }

        .feedback-actions {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 16px;
        }

        /* 图片放大相关样式 */
        .image-item {
            position: relative;
        }

        .image-hover-icons {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            display: flex;
            gap: 10px;
            opacity: 0;
            transition: opacity 0.3s ease;
            z-index: 10;
        }

        .image-item:hover .image-hover-icons {
            opacity: 1;
        }

        .hover-icon {
            width: 32px;
            height: 32px;
            background: rgba(0, 0, 0, 0.7);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            color: white;
            font-size: 16px;
            transition: background 0.3s ease;
        }

        .hover-icon:hover {
            background: rgba(0, 0, 0, 0.9);
        }

        /* 图片放大弹窗 */
        .image-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1002;
        }

        .image-modal-content {
            position: relative;
            max-width: 90%;
            max-height: 90%;
        }

        .modal-image {
            max-width: 80%;
            max-height: 80%;
            object-fit: contain;
        }

        .modal-arrow {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            width: 50px;
            height: 50px;
            background: rgba(0, 0, 0, 0.7);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            color: white;
            font-size: 24px;
            transition: background 0.3s ease;
        }

        .modal-arrow:hover {
            background: rgba(0, 0, 0, 0.9);
        }

        .modal-arrow.prev {
            left: -60px;
        }

        .modal-arrow.next {
            right: -60px;
        }

        .modal-close {
            position: absolute;
            top: -50px;
            right: 0;
            width: 32px;
            height: 32px;
            background: rgba(0, 0, 0, 0.7);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            color: white;
            font-size: 18px;
            transition: background 0.3s ease;
        }

        .modal-close:hover {
            background: rgba(0, 0, 0, 0.9);
        }

        .modal-info {
            position: absolute;
            bottom: -40px;
            left: 0;
            right: 0;
            text-align: center;
            color: white;
            font-size: 14px;
        }
    </style>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
</head>
<body>
    <div class="app-container">
        <!-- 侧边栏 -->
        <div class="sidebar">
            <div class="logo">
                <h1>
                    <span class="material-icons">favorite</span>
                    AI内容管理后台
                </h1>
            </div>
            <ul class="nav-menu">
                <li class="nav-item">
                    <a href="#" class="nav-link">
                        <span class="material-icons">home</span>
                        首页
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link">
                        <span class="material-icons">upload</span>
                        上传
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link">
                        <span class="material-icons">image</span>
                        AI图生成
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link">
                        <span class="material-icons">video_library</span>
                        AI视频生成
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link">
                        <span class="material-icons">content_copy</span>
                        内容生产
                    </a>
                </li>

                <li class="nav-item">
                    <a href="#" class="nav-link">
                        <span class="material-icons">settings</span>
                        运营工具
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link">
                        <span class="material-icons">trending_up</span>
                        趋势热点
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link">
                        <span class="material-icons">search</span>
                        AI扩图查询
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link active">
                        <span class="material-icons">lightbulb</span>
                        创意工具
                    </a>
                    <ul class="sub-menu">
                        <li><a href="#" class="nav-link active" onclick="showModule('expand')">扩图</a></li>
                        <li>
                            <a href="#" class="nav-link" onclick="showModule('changeBg')">换背景</a>
                            <ul class="sub-menu" style="margin-left: 8px;">
                                <li><a href="#" class="nav-link" onclick="showModule('bgFission')">背景裂变</a></li>
                            </ul>
                        </li>
                        <li><a href="#" class="nav-link" onclick="showModule('virtualFitting')">虚拟换衣</a></li>
                        <li><a href="#" class="nav-link" onclick="showModule('imageCreation')">图片创作</a></li>
                        <li><a href="#" class="nav-link" onclick="showModule('feedbackManagement')">意见管理</a></li>
                    </ul>
                </li>
            </ul>
        </div>

        <!-- 主内容区域 -->
        <div class="main-content">
            <div class="header">
                <div class="breadcrumb" id="breadcrumb">创意工具 / 扩图</div>
                <div class="header-actions">
                    <a href="#" style="color: #1890ff; text-decoration: none; margin-right: 16px;" onclick="showOperationGuide()">操作说明</a>
                    <button class="btn btn-primary" onclick="startProduction()">生产</button>
                    <span class="material-icons">dark_mode</span>
                    <span>lucien.xu ▼</span>
                </div>
            </div>

            <div class="content-area">
                <!-- 左侧面板 -->
                <div class="left-panel">
                    <div class="panel">
                        <div class="panel-header">
                            <div class="panel-title">上传信息</div>
                            <div>
                                <button class="btn btn-secondary" onclick="resetForm()">重置</button>
                            </div>
                        </div>
                        <div class="panel-content">
                            <div class="tabs">
                                <div class="tab active" onclick="switchTab('select')">选择商品</div>
                                <div class="tab" onclick="switchTab('upload')">自行上传</div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label required">商品ID</label>
                                <div class="input-group">
                                    <input type="text" class="form-input" id="goodsId" placeholder="请输入一个商品ID" value="6920234553221107522">
                                    <button class="btn btn-primary" onclick="searchGoods()">查询</button>
                                </div>
                            </div>

                            <div id="uploadInfo" class="upload-info">
                                <!-- 动态内容 -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 中间面板 -->
                <div class="middle-panel">
                    <div class="panel">
                        <div class="panel-header">
                            <div class="panel-title" id="middlePanelTitle">生成记录</div>
                            <button class="btn btn-primary" onclick="downloadAll()">全部下载</button>
                        </div>
                        <div class="panel-content" id="middlePanelContent">
                            <!-- 动态内容 -->
                        </div>
                    </div>
                </div>

                <!-- 抽屉触发按钮 -->
                <button class="drawer-toggle" onclick="toggleDrawer()" title="任务列表">
                    <span class="material-icons">assignment</span>
                </button>

                <!-- 抽屉遮罩层 -->
                <div class="drawer-overlay" id="drawerOverlay" onclick="closeDrawer()"></div>

                <!-- 抽屉面板 -->
                <div class="drawer-panel" id="drawerPanel">
                    <div class="drawer-header">
                        <div class="drawer-title">任务列表</div>
                        <button class="drawer-close" onclick="closeDrawer()">
                            <span class="material-icons">close</span>
                        </button>
                    </div>
                    <div class="drawer-content">
                        <ul class="task-list" id="taskList">
                            <!-- 动态任务列表 -->
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast提示 -->
    <div class="toast" id="toast">
        <span class="material-icons" style="margin-right: 8px;">info</span>
        生成素材后请记得打上AIGC标签哦
    </div>

    <!-- 反馈弹窗 -->
    <div class="feedback-modal" id="feedbackModal">
        <div class="feedback-content">
            <div class="feedback-header">
                <div class="feedback-title">负向反馈</div>
                <span class="feedback-close" onclick="closeFeedbackModal()">×</span>
            </div>
            <div>
                <label style="display: block; margin-bottom: 8px; font-weight: 500;">请描述您的问题：</label>
                <textarea class="feedback-textarea" id="feedbackText" placeholder="请输入您的反馈意见..."></textarea>
            </div>
            <div class="feedback-actions">
                <button class="btn btn-secondary" onclick="closeFeedbackModal()">取消</button>
                <button class="btn btn-primary" onclick="submitFeedback()">提交</button>
            </div>
        </div>
    </div>

    <!-- 图片放大弹窗 -->
    <div class="image-modal" id="imageModal">
        <div class="image-modal-content">
            <div class="modal-close" onclick="closeImageModal()">×</div>
            <div class="modal-arrow prev" onclick="showPrevImage()">‹</div>
            <img class="modal-image" id="modalImage" src="" alt="放大图片">
            <div class="modal-arrow next" onclick="showNextImage()">›</div>
            <div class="modal-info" id="modalInfo">1/8</div>
        </div>
    </div>

    <!-- 编辑意见记录弹窗 -->
    <div class="feedback-modal" id="editFeedbackModal" style="z-index: 1004;">
        <div class="feedback-content" style="width: 500px;">
            <div class="feedback-header">
                <div class="feedback-title">编辑意见记录</div>
                <span class="feedback-close" onclick="closeEditFeedbackModal()">×</span>
            </div>
            <div style="padding: 20px;">
                <div class="form-group">
                    <label class="form-label">意见记录</label>
                    <textarea class="form-input" id="editFeedbackText" rows="4" placeholder="请输入意见记录内容"></textarea>
                </div>
                <div style="display: flex; justify-content: flex-end; gap: 10px; margin-top: 20px;">
                    <button class="btn btn-secondary" onclick="closeEditFeedbackModal()">取消</button>
                    <button class="btn btn-primary" onclick="saveFeedbackEdit()">保存</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 新增背景图弹窗 -->
    <div class="feedback-modal" id="addBgModal" style="z-index: 1003;">
        <div class="feedback-content" style="width: 600px; max-height: 80vh; overflow-y: auto;">
            <div class="feedback-header">
                <div class="feedback-title">新增背景图</div>
                <span class="feedback-close" onclick="closeAddBgModal()">×</span>
            </div>
            <div style="margin-bottom: 20px;">
                <div style="display: flex; gap: 20px;">
                    <!-- 左侧：上传参考图 -->
                    <div style="flex: 1;">
                        <h4 style="margin-bottom: 15px; color: #333;">参考图</h4>
                        <div id="uploadArea" style="border: 2px dashed #d9d9d9; border-radius: 8px; padding: 40px; text-align: center; cursor: pointer; background: #fafafa;" onclick="triggerFileUpload()">
                            <div style="margin-bottom: 10px;">
                                <span class="material-icons" style="font-size: 48px; color: #d9d9d9;">cloud_upload</span>
                            </div>
                            <div style="color: #666; font-size: 14px;">
                                点击上传参考图<br>
                                <span style="font-size: 12px; color: #999;">支持 JPEG/JPG/PNG/WEBP，10M以内</span>
                            </div>
                        </div>
                        <input type="file" id="fileUpload" accept="image/*" style="display: none;" onchange="handleFileUpload(event)">
                        <div id="uploadedImage" style="display: none; margin-top: 10px;">
                            <img id="previewImage" src="" alt="预览图" style="width: 100%; max-height: 200px; object-fit: cover; border-radius: 6px;">
                        </div>
                    </div>
                    
                    <!-- 右侧：相似程度设置 -->
                    <div style="flex: 1;">
                        <h4 style="margin-bottom: 15px; color: #333;">相似程度</h4>
                        <div style="margin-bottom: 20px;">
                            <label style="display: flex; align-items: center; gap: 5px; margin-bottom: 10px;">
                                <input type="radio" name="similarityLevel" value="low"> 低
                            </label>
                            <label style="display: flex; align-items: center; gap: 5px; margin-bottom: 10px;">
                                <input type="radio" name="similarityLevel" value="medium" checked> 中
                            </label>
                            <label style="display: flex; align-items: center; gap: 5px; margin-bottom: 10px;">
                                <input type="radio" name="similarityLevel" value="high"> 高
                            </label>
                        </div>
                        <button class="btn btn-primary" onclick="generateBgImages()" id="generateBtn" disabled>提交生成</button>
                    </div>
                </div>
            </div>
            
            <!-- 生成结果区域 -->
            <div id="generationResults" style="display: none;">
                <h4 style="margin-bottom: 15px; color: #333;">生成结果</h4>
                <div style="margin-bottom: 15px;">
                    <div class="image-grid" style="grid-template-columns: repeat(3, 1fr); gap: 12px;">
                        <div class="image-item" onclick="selectGeneratedImage(this, 0)">
                            <img src="" alt="生成结果1" style="width: 100%; height: 120px; object-fit: cover;">
                        </div>
                        <div class="image-item" onclick="selectGeneratedImage(this, 1)">
                            <img src="" alt="生成结果2" style="width: 100%; height: 120px; object-fit: cover;">
                        </div>
                        <div class="image-item" onclick="selectGeneratedImage(this, 2)">
                            <img src="" alt="生成结果3" style="width: 100%; height: 120px; object-fit: cover;">
                        </div>
                    </div>
                </div>
                <div style="display: flex; justify-content: flex-end; gap: 10px;">
                    <button class="btn btn-secondary" onclick="closeAddBgModal()">取消</button>
                    <button class="btn btn-primary" onclick="addToPreset()" id="addToPresetBtn" disabled>添加到预设</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Mock数据
        const mockData = {
            expand: {
                title: '扩图',
                breadcrumb: '创意工具 / 扩图',
                middlePanelTitle: '生成记录',
                uploadInfo: `
                    <div id="selectProductTab" style="display: block;">
                        <div class="message success">
                            查询到以上商品ID对应SPUID全部商品图
                        </div>
                        <div style="margin-bottom: 20px;">
                            <h4 style="margin-bottom: 10px; color: #333;">商品1: 6920234553255788354</h4>
                            <div class="image-grid" style="grid-template-columns: repeat(3, 1fr); gap: 8px;">
                                <div class="image-item selected" onclick="selectImage(this)">
                                    <img src="https://youke1.picui.cn/s1/2025/08/01/688cb7e3003d7.jpg" alt="Polo衫商品图片">
                                    <div style="position: absolute; bottom: 5px; left: 5px; background: #1890ff; color: white; padding: 2px 6px; border-radius: 3px; font-size: 12px;">✓</div>
                                </div>
                                <div class="image-item selected" onclick="selectImage(this)">
                                    <img src="https://youke1.picui.cn/s1/2025/08/01/688cb7e3003d7.jpg" alt="Polo衫商品图片">
                                    <div style="position: absolute; bottom: 5px; left: 5px; background: #1890ff; color: white; padding: 2px 6px; border-radius: 3px; font-size: 12px;">✓</div>
                                </div>
                                <div class="image-item" onclick="selectImage(this)">
                                    <img src="https://youke1.picui.cn/s1/2025/08/01/688cb7e3003d7.jpg" alt="Polo衫商品图片">
                                </div>
                            </div>
                        </div>
                        
                        <!-- 扩图配置项 -->
                        <div class="form-section">
                            <h4>扩图类型 <span class="help-icon" title="选择场景扩图或颜色扩图">?</span></h4>
                            <div class="radio-group">
                                <label>
                                    <input type="radio" name="expandType" value="scene" checked> 场景扩图
                                </label>
                                <label>
                                    <input type="radio" name="expandType" value="color"> 颜色扩图
                                </label>
                            </div>
                        </div>
                        
                        <div class="form-section">
                            <h4>扩图方式 <span class="help-icon" title="选择直接扩图或先切后扩">?</span></h4>
                            <div class="radio-group">
                                <label>
                                    <input type="radio" name="expandMethod" value="direct"> 直接扩图
                                </label>
                                <label>
                                    <input type="radio" name="expandMethod" value="cutFirst" checked> 先切后扩
                                </label>
                            </div>
                        </div>
                        
                        <div class="form-section">
                            <h4>扩图比例 <span class="help-icon" title="选择预设比例或自定义宽高比">?</span></h4>
                            <div class="ratio-options">
                                <label class="ratio-option selected" onclick="selectRatioOption(this)">
                                    <input type="radio" name="expandRatio" value="9:16" checked onchange="handleRatioChange(false, this)">
                                    <div class="ratio-visual ratio-9-16"></div>
                                    <div class="ratio-label">竖图</div>
                                    <div class="ratio-value">9:16</div>
                                </label>
                                <label class="ratio-option" onclick="selectRatioOption(this)">
                                    <input type="radio" name="expandRatio" value="2:3" onchange="handleRatioChange(false, this)">
                                    <div class="ratio-visual ratio-2-3"></div>
                                    <div class="ratio-label">竖图</div>
                                    <div class="ratio-value">2:3</div>
                                </label>
                                <label class="ratio-option" onclick="selectRatioOption(this)">
                                    <input type="radio" name="expandRatio" value="16:9" onchange="handleRatioChange(false, this)">
                                    <div class="ratio-visual ratio-16-9"></div>
                                    <div class="ratio-label">横图</div>
                                    <div class="ratio-value">16:9</div>
                                </label>
                                <label class="ratio-option" onclick="selectRatioOption(this)">
                                    <input type="radio" name="expandRatio" value="3:2" onchange="handleRatioChange(false, this)">
                                    <div class="ratio-visual ratio-3-2"></div>
                                    <div class="ratio-label">横图</div>
                                    <div class="ratio-value">3:2</div>
                                </label>
                                <label class="ratio-option custom-ratio-card" onclick="selectRatioOption(this)">
                                    <input type="radio" name="expandRatio" value="custom" onchange="handleRatioChange(true, this)">
                                    <div class="ratio-visual ratio-custom">
                                        <span class="material-icons" style="font-size: 16px; color: #999;">edit</span>
                                    </div>
                                    <div class="ratio-label">自定义</div>
                                    <div class="ratio-value">比例</div>
                                </label>
                            </div>
                            <div class="custom-ratio-inputs" style="display: none; margin-top: 12px;">
                                <div class="ratio-input-group">
                                    <input type="number" class="form-input ratio-input custom-width" placeholder="宽" min="1" max="100" value="16" oninput="onCustomRatioChange(this)">
                                    <span class="ratio-separator">:</span>
                                    <input type="number" class="form-input ratio-input custom-height" placeholder="高" min="1" max="100" value="9" oninput="onCustomRatioChange(this)">
                                </div>
                                <div class="ratio-hint">请输入宽高比例，如 16:9 或 4:3</div>
                            </div>
                        </div>
                        
                        <div class="form-section expand-direction-section">
                            <h4>扩图方向 <span class="help-icon expand-direction-help" title="选择向上、向下或居中扩图">?</span></h4>
                            <!-- 竖图方向选项 -->
                            <div class="radio-group vertical-directions">
                                <label>
                                    <input type="radio" name="expandDirection" value="up"> 向上扩图
                                </label>
                                <label>
                                    <input type="radio" name="expandDirection" value="down" checked> 向下扩图
                                </label>
                                <label>
                                    <input type="radio" name="expandDirection" value="center"> 居中扩图
                                </label>
                            </div>
                            <!-- 横图方向选项 -->
                            <div class="radio-group horizontal-directions" style="display: none;">
                                <label>
                                    <input type="radio" name="expandDirection" value="left"> 向左扩图
                                </label>
                                <label>
                                    <input type="radio" name="expandDirection" value="right"> 向右扩图
                                </label>
                                <label>
                                    <input type="radio" name="expandDirection" value="center"> 居中扩图
                                </label>
                            </div>
                        </div>
                        
                        <div class="form-section">
                            <h4>生成提示词</h4>
                            <textarea class="form-input" placeholder="请填写英文提示词" rows="3" maxlength="100" id="promptText"></textarea>
                        </div>
                    </div>
                    
                    <div id="uploadTab" style="display: none;">
                        <div class="form-section">
                            <h4>上传图片 <span class="help-icon" title="支持JPEG/JPG/PNG/WEBP格式，文件大小不超过10M">?</span></h4>
                            <div class="upload-area" onclick="uploadExpandImage()">
                                <span class="material-icons">+</span>
                                <div style="color: #666; font-size: 14px;">
                                    上传JPEG/JPG/PNG/WEBP 10M以内
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-section">
                            <h4>扩图类型 <span class="help-icon" title="选择场景扩图或颜色扩图">?</span></h4>
                            <div class="radio-group">
                                <label>
                                    <input type="radio" name="expandType" value="scene" checked> 场景扩图
                                </label>
                                <label>
                                    <input type="radio" name="expandType" value="color"> 颜色扩图
                                </label>
                            </div>
                        </div>
                        
                        <div class="form-section">
                            <h4>扩图方式 <span class="help-icon" title="选择直接扩图或先切后扩">?</span></h4>
                            <div class="radio-group">
                                <label>
                                    <input type="radio" name="expandMethod" value="direct"> 直接扩图
                                </label>
                                <label>
                                    <input type="radio" name="expandMethod" value="cutFirst" checked> 先切后扩
                                </label>
                            </div>
                        </div>
                        
                        <div class="form-section">
                            <h4>扩图比例 <span class="help-icon" title="选择预设比例或自定义宽高比">?</span></h4>
                            <div class="ratio-options">
                                <label class="ratio-option selected" onclick="selectRatioOption(this)">
                                    <input type="radio" name="expandRatio" value="9:16" checked onchange="handleRatioChange(false, this)">
                                    <div class="ratio-visual ratio-9-16"></div>
                                    <div class="ratio-label">竖图</div>
                                    <div class="ratio-value">9:16</div>
                                </label>
                                <label class="ratio-option" onclick="selectRatioOption(this)">
                                    <input type="radio" name="expandRatio" value="2:3" onchange="handleRatioChange(false, this)">
                                    <div class="ratio-visual ratio-2-3"></div>
                                    <div class="ratio-label">竖图</div>
                                    <div class="ratio-value">2:3</div>
                                </label>
                                <label class="ratio-option" onclick="selectRatioOption(this)">
                                    <input type="radio" name="expandRatio" value="16:9" onchange="handleRatioChange(false, this)">
                                    <div class="ratio-visual ratio-16-9"></div>
                                    <div class="ratio-label">横图</div>
                                    <div class="ratio-value">16:9</div>
                                </label>
                                <label class="ratio-option" onclick="selectRatioOption(this)">
                                    <input type="radio" name="expandRatio" value="3:2" onchange="handleRatioChange(false, this)">
                                    <div class="ratio-visual ratio-3-2"></div>
                                    <div class="ratio-label">横图</div>
                                    <div class="ratio-value">3:2</div>
                                </label>
                                <label class="ratio-option custom-ratio-card" onclick="selectRatioOption(this)">
                                    <input type="radio" name="expandRatio" value="custom" onchange="handleRatioChange(true, this)">
                                    <div class="ratio-visual ratio-custom">
                                        <span class="material-icons" style="font-size: 16px; color: #999;">edit</span>
                                    </div>
                                    <div class="ratio-label">自定义</div>
                                    <div class="ratio-value">比例</div>
                                </label>
                            </div>
                            <div class="custom-ratio-inputs" style="display: none; margin-top: 12px;">
                                <div class="ratio-input-group">
                                    <input type="number" class="form-input ratio-input custom-width" placeholder="宽" min="1" max="100" value="16" oninput="onCustomRatioChange(this)">
                                    <span class="ratio-separator">:</span>
                                    <input type="number" class="form-input ratio-input custom-height" placeholder="高" min="1" max="100" value="9" oninput="onCustomRatioChange(this)">
                                </div>
                                <div class="ratio-hint">请输入宽高比例，如 16:9 或 4:3</div>
                            </div>
                        </div>
                        
                        <div class="form-section expand-direction-section">
                            <h4>扩图方向 <span class="help-icon expand-direction-help" title="选择向上、向下或居中扩图">?</span></h4>
                            <!-- 竖图方向选项 -->
                            <div class="radio-group vertical-directions">
                                <label>
                                    <input type="radio" name="expandDirection" value="up"> 向上扩图
                                </label>
                                <label>
                                    <input type="radio" name="expandDirection" value="down" checked> 向下扩图
                                </label>
                                <label>
                                    <input type="radio" name="expandDirection" value="center"> 居中扩图
                                </label>
                            </div>
                            <!-- 横图方向选项 -->
                            <div class="radio-group horizontal-directions" style="display: none;">
                                <label>
                                    <input type="radio" name="expandDirection" value="left"> 向左扩图
                                </label>
                                <label>
                                    <input type="radio" name="expandDirection" value="right"> 向右扩图
                                </label>
                                <label>
                                    <input type="radio" name="expandDirection" value="center"> 居中扩图
                                </label>
                            </div>
                        </div>
                        
                        <div class="form-section">
                            <h4>生成提示词</h4>
                            <textarea class="form-input" placeholder="请填写英文提示词" rows="3" maxlength="100" id="promptText"></textarea>
                        </div>
                    </div>
                `,
                middlePanelContent: `
                    <div class="empty-state">
                        <div style="font-size: 48px; color: #d9d9d9; margin-bottom: 16px;">📦</div>
                        <p style="color: #999; font-size: 14px;">暂无数据</p>
                    </div>
                `,
                tasks: [
                    { id: 1, title: '任务20250101', status: '进行中' },
                    { id: 2, title: '任务20250102', status: '已完成' },
                    { id: 3, title: '任务20250103', status: '等待中' },
                    { id: 4, title: '任务20250104', status: '已完成' },
                    { id: 5, title: '任务20250105', status: '进行中' }
                ]
            },
            changeBg: {
                title: '换背景',
                breadcrumb: '创意工具 / 换背景',
                middlePanelTitle: '生成记录',
                uploadInfo: `
                    <div class="message success">
                        查询到以上商品ID对应SPUID全部商品图
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <h4 style="margin-bottom: 10px; color: #333;">商品1: 6921461213816069463</h4>
                        <div class="image-grid" style="grid-template-columns: repeat(4, 1fr); gap: 8px;">
                            <div class="image-item" onclick="selectChangeBgImage(this)">
                                <img src="https://youke1.picui.cn/s1/2025/08/01/688cb7e3003d7.jpg" alt="商品图片">
                            </div>
                            <div class="image-item selected" onclick="selectChangeBgImage(this)">
                                <img src="https://youke1.picui.cn/s1/2025/08/01/688cb7e3003d7.jpg" alt="商品图片">
                                <div style="position: absolute; bottom: 5px; left: 5px; background: #1890ff; color: white; padding: 2px 6px; border-radius: 3px; font-size: 12px;">✓</div>
                            </div>
                            <div class="image-item selected" onclick="selectChangeBgImage(this)">
                                <img src="https://youke1.picui.cn/s1/2025/08/01/688cb7e3003d7.jpg" alt="商品图片">
                                <div style="position: absolute; bottom: 5px; left: 5px; background: #1890ff; color: white; padding: 2px 6px; border-radius: 3px; font-size: 12px;">✓</div>
                            </div>
                            <div class="image-item" onclick="selectChangeBgImage(this)">
                                <img src="https://youke1.picui.cn/s1/2025/08/01/688cb7e3003d7.jpg" alt="商品图片">
                            </div>
                        </div>
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <h4 style="margin-bottom: 15px; color: #333;">背景图比例</h4>
                        <div style="display: flex; gap: 15px;">
                            <label style="display: flex; align-items: center; gap: 5px;">
                                <input type="radio" name="bgRatio" value="16:9"> 横图16:9
                            </label>
                            <label style="display: flex; align-items: center; gap: 5px;">
                                <input type="radio" name="bgRatio" value="9:16" checked> 竖图9:16
                            </label>
                            <label style="display: flex; align-items: center; gap: 5px;">
                                <input type="radio" name="bgRatio" value="1:1"> 方图1:1
                            </label>
                        </div>
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <h4 style="margin-bottom: 15px; color: #333;">选择背景图</h4>
                        
                        <div style="margin-bottom: 20px;">
                                                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                                    <h5 style="color: #333; margin: 0;">蓝色</h5>
                                    <div style="display: flex; gap: 10px;">
                                        <a href="#" style="color: #1890ff; text-decoration: none; font-size: 12px;" onclick="openAddBgModal()">新增</a>
                                        <a href="#" style="color: #1890ff; text-decoration: none; font-size: 12px;">更多></a>
                                    </div>
                                </div>
                            <div class="image-grid" style="grid-template-columns: repeat(4, 1fr); gap: 8px;">
                                <div class="image-item" onclick="selectBgImage(this)">
                                    <img src="https://youke1.picui.cn/s1/2025/08/04/689033dd3295b.jpeg" alt="蓝色背景">
                                </div>
                                <div class="image-item" onclick="selectBgImage(this)">
                                    <img src="https://youke1.picui.cn/s1/2025/08/04/689033dd3295b.jpeg" alt="蓝色背景">
                                </div>
                                <div class="image-item selected" onclick="selectBgImage(this)">
                                    <img src="https://youke1.picui.cn/s1/2025/08/04/689033dd3295b.jpeg" alt="蓝色背景">
                                    <div style="position: absolute; bottom: 5px; left: 5px; background: #1890ff; color: white; padding: 2px 6px; border-radius: 3px; font-size: 12px;">✓</div>
                                </div>
                                <div class="image-item" onclick="selectBgImage(this)">
                                    <img src="https://youke1.picui.cn/s1/2025/08/04/689033dd3295b.jpeg" alt="蓝色背景">
                                </div>
                            </div>
                        </div>
                        
                        <div style="margin-bottom: 20px;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                                <h5 style="color: #333; margin: 0;">粉色</h5>
                                <div style="display: flex; gap: 10px;">
                                    <a href="#" style="color: #1890ff; text-decoration: none; font-size: 12px;" onclick="openAddBgModal()">新增</a>
                                    <a href="#" style="color: #1890ff; text-decoration: none; font-size: 12px;">更多></a>
                                </div>
                            </div>
                            <div class="image-grid" style="grid-template-columns: repeat(4, 1fr); gap: 8px;">
                                <div class="image-item" onclick="selectBgImage(this)">
                                    <img src="https://youke1.picui.cn/s1/2025/08/04/689033dd3295b.jpeg" alt="粉色背景">
                                </div>
                                <div class="image-item selected" onclick="selectBgImage(this)">
                                    <img src="https://youke1.picui.cn/s1/2025/08/04/689033dd3295b.jpeg" alt="粉色背景">
                                    <div style="position: absolute; bottom: 5px; left: 5px; background: #1890ff; color: white; padding: 2px 6px; border-radius: 3px; font-size: 12px;">✓</div>
                                </div>
                                <div class="image-item" onclick="selectBgImage(this)">
                                    <img src="https://youke1.picui.cn/s1/2025/08/04/689033dd3295b.jpeg" alt="粉色背景">
                                </div>
                                <div class="image-item" onclick="selectBgImage(this)">
                                    <img src="https://youke1.picui.cn/s1/2025/08/04/689033dd3295b.jpeg" alt="粉色背景">
                                </div>
                            </div>
                        </div>
                        
                        <div style="margin-bottom: 20px;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                                <h5 style="color: #333; margin: 0;">紫色</h5>
                                <div style="display: flex; gap: 10px;">
                                    <a href="#" style="color: #1890ff; text-decoration: none; font-size: 12px;" onclick="openAddBgModal()">新增</a>
                                    <a href="#" style="color: #1890ff; text-decoration: none; font-size: 12px;">更多></a>
                                </div>
                            </div>
                            <div class="image-grid" style="grid-template-columns: repeat(4, 1fr); gap: 8px;">
                                <div class="image-item" onclick="selectBgImage(this)">
                                    <img src="https://youke1.picui.cn/s1/2025/08/04/689033dd3295b.jpeg" alt="紫色背景">
                                </div>
                                <div class="image-item" onclick="selectBgImage(this)">
                                    <img src="https://youke1.picui.cn/s1/2025/08/04/689033dd3295b.jpeg" alt="紫色背景">
                                </div>
                                <div class="image-item" onclick="selectBgImage(this)">
                                    <img src="https://youke1.picui.cn/s1/2025/08/04/689033dd3295b.jpeg" alt="紫色背景">
                                </div>
                                <div class="image-item" onclick="selectBgImage(this)">
                                    <img src="https://youke1.picui.cn/s1/2025/08/04/689033dd3295b.jpeg" alt="紫色背景">
                                </div>
                            </div>
                        </div>
                    </div>
                `,
                middlePanelContent: `
                    <div style="margin-bottom: 20px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                            <div>
                                <span style="font-weight: 500; color: #333;">商品Id: 6921461213816069463</span>
                                <span style="margin-left: 10px; color: #999; font-size: 12px;">2025-08-04 11:48:45</span>
                            </div>
                        </div>
                        
                        <div class="image-grid" style="grid-template-columns: repeat(4, 1fr); gap: 12px;">
                            <div class="image-item" style="position: relative;">
                                <div style="position: absolute; top: 5px; left: 5px; background: #1890ff; color: white; padding: 2px 6px; border-radius: 3px; font-size: 12px;">6000</div>
                                <img src="https://youke1.picui.cn/s1/2025/08/04/689037a51d9bb.png" alt="换背景结果1" style="width: 100%; height: 120px; object-fit: cover;">
                                <div style="display: flex; gap: 5px; margin-top: 8px; align-items: center;">
                                    <button class="btn btn-secondary" style="font-size: 12px; padding: 4px 8px;" onclick="approveImage('6000')">通过</button>
                                    <button class="btn btn-primary" style="font-size: 12px; padding: 4px 8px;" onclick="downloadSingleImage('6000')">下载</button>
                                    <span class="feedback-icon" onclick="openFeedbackModal('6000')" title="负向反馈">
                                        <img src="https://youke1.picui.cn/s1/2025/08/04/6890570a0432b.png" alt="负向反馈" style="width: 16px; height: 16px;">
                                    </span>
                                </div>
                            </div>
                            <div class="image-item" style="position: relative;">
                                <div style="position: absolute; top: 5px; left: 5px; background: #1890ff; color: white; padding: 2px 6px; border-radius: 3px; font-size: 12px;">6001</div>
                                <img src="https://youke1.picui.cn/s1/2025/08/04/689037a51d9bb.png" alt="换背景结果2" style="width: 100%; height: 120px; object-fit: cover;">
                                <div style="display: flex; gap: 5px; margin-top: 8px; align-items: center;">
                                    <button class="btn btn-secondary" style="font-size: 12px; padding: 4px 8px;" onclick="approveImage('6001')">通过</button>
                                    <button class="btn btn-primary" style="font-size: 12px; padding: 4px 8px;" onclick="downloadSingleImage('6001')">下载</button>
                                    <span class="feedback-icon" onclick="openFeedbackModal('6001')" title="负向反馈">
                                        <img src="https://youke1.picui.cn/s1/2025/08/04/6890570a0432b.png" alt="负向反馈" style="width: 16px; height: 16px;">
                                    </span>
                                </div>
                            </div>
                            <div class="image-item" style="position: relative;">
                                <div style="position: absolute; top: 5px; left: 5px; background: #1890ff; color: white; padding: 2px 6px; border-radius: 3px; font-size: 12px;">6002</div>
                                <img src="https://youke1.picui.cn/s1/2025/08/04/689037a51d9bb.png" alt="换背景结果3" style="width: 100%; height: 120px; object-fit: cover;">
                                <div style="display: flex; gap: 5px; margin-top: 8px; align-items: center;">
                                    <button class="btn btn-secondary" style="font-size: 12px; padding: 4px 8px;" onclick="approveImage('6002')">通过</button>
                                    <button class="btn btn-primary" style="font-size: 12px; padding: 4px 8px;" onclick="downloadSingleImage('6002')">下载</button>
                                    <span class="feedback-icon" onclick="openFeedbackModal('6002')" title="负向反馈">
                                        <img src="https://youke1.picui.cn/s1/2025/08/04/6890570a0432b.png" alt="负向反馈" style="width: 16px; height: 16px;">
                                    </span>
                                </div>
                            </div>
                            <div class="image-item" style="position: relative;">
                                <div style="position: absolute; top: 5px; left: 5px; background: #1890ff; color: white; padding: 2px 6px; border-radius: 3px; font-size: 12px;">6003</div>
                                <img src="https://youke1.picui.cn/s1/2025/08/04/689037a51d9bb.png" alt="换背景结果4" style="width: 100%; height: 120px; object-fit: cover;">
                                <div style="display: flex; gap: 5px; margin-top: 8px; align-items: center;">
                                    <button class="btn btn-secondary" style="font-size: 12px; padding: 4px 8px;" onclick="approveImage('6003')">通过</button>
                                    <button class="btn btn-primary" style="font-size: 12px; padding: 4px 8px;" onclick="downloadSingleImage('6003')">下载</button>
                                    <span class="feedback-icon" onclick="openFeedbackModal('6003')" title="负向反馈">
                                        <img src="https://youke1.picui.cn/s1/2025/08/04/6890570a0432b.png" alt="负向反馈" style="width: 16px; height: 16px;">
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>
                `,
                tasks: [
                    { id: 1, title: '任务20250804-1047', status: '已完成' },
                    { id: 2, title: '任务20250804-1044', status: '已完成' },
                    { id: 3, title: '任务20250729-981', status: '已完成' },
                    { id: 4, title: '任务20250729-980', status: '已完成' },
                    { id: 5, title: '任务20250728-975', status: '已完成' }
                ]
            },
            bgFission: {
                title: '背景裂变',
                breadcrumb: '创意工具 / 换背景 / 背景裂变',
                middlePanelTitle: '生成记录',
                uploadInfo: `
                    <div style="margin-bottom: 20px;">
                        <h4 style="margin-bottom: 15px; color: #333;">上传参考图</h4>
                        <div id="uploadArea" style="border: 2px dashed #d9d9d9; border-radius: 8px; padding: 40px; text-align: center; cursor: pointer; background: #fafafa;" onclick="triggerFileUpload()">
                            <div style="margin-bottom: 10px;">
                                <span class="material-icons" style="font-size: 48px; color: #d9d9d9;">cloud_upload</span>
                            </div>
                            <div style="color: #666; font-size: 14px;">
                                点击上传参考图<br>
                                <span style="font-size: 12px; color: #999;">支持 JPEG/JPG/PNG/WEBP，10M以内</span>
                            </div>
                        </div>
                        <input type="file" id="fileUpload" accept="image/*" style="display: none;" onchange="handleFileUpload(event)">
                        <div id="uploadedImage" style="display: none; margin-top: 10px;">
                            <img id="previewImage" src="" alt="预览图" style="width: 100%; max-height: 200px; object-fit: cover; border-radius: 6px;">
                        </div>
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <h4 style="margin-bottom: 15px; color: #333;">相似程度</h4>
                        <div style="display: flex; gap: 15px;">
                            <label style="display: flex; align-items: center; gap: 5px;">
                                <input type="radio" name="similarityLevel" value="low"> 低
                            </label>
                            <label style="display: flex; align-items: center; gap: 5px;">
                                <input type="radio" name="similarityLevel" value="medium" checked> 中
                            </label>
                            <label style="display: flex; align-items: center; gap: 5px;">
                                <input type="radio" name="similarityLevel" value="high"> 高
                            </label>
                        </div>
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <h4 style="margin-bottom: 15px; color: #333;">背景图比例</h4>
                        <div style="display: flex; gap: 15px;">
                            <label style="display: flex; align-items: center; gap: 5px;">
                                <input type="radio" name="bgRatio" value="16:9"> 横图16:9
                            </label>
                            <label style="display: flex; align-items: center; gap: 5px;">
                                <input type="radio" name="bgRatio" value="9:16" checked> 竖图9:16
                            </label>
                            <label style="display: flex; align-items: center; gap: 5px;">
                                <input type="radio" name="bgRatio" value="1:1"> 方图1:1
                            </label>
                        </div>
                    </div>
                `,
                middlePanelContent: `
                    <div class="empty-state">
                        <span class="material-icons">image</span>
                        <p>请先上传参考图并生成背景图</p>
                    </div>
                `,
                tasks: [
                    { id: 1, title: '背景裂变任务20250804-1050', status: '已完成' },
                    { id: 2, title: '背景裂变任务20250804-1047', status: '已完成' },
                    { id: 3, title: '背景裂变任务20250729-981', status: '已完成' },
                    { id: 4, title: '背景裂变任务20250729-980', status: '已完成' },
                    { id: 5, title: '背景裂变任务20250728-975', status: '已完成' }
                ]
            },
            virtualFitting: {
                title: '虚拟换衣',
                breadcrumb: '创意工具 / 虚拟换衣',
                middlePanelTitle: '生图任务信息编辑',
                uploadInfo: `
                    <div class="tabs">
                        <div class="tab active" onclick="switchVirtualFittingTab('select')">选择商品</div>
                        <div class="tab" onclick="switchVirtualFittingTab('upload')">自行上传</div>
                    </div>
                    
                    <div id="selectProductTab" style="display: block;">
                        <div style="margin-bottom: 20px;">
                            <h4 style="margin-bottom: 15px; color: #333;">信息编辑</h4>
                            <div class="form-group">
                                <label class="form-label required">商品ID</label>
                                <div class="input-group">
                                    <input type="text" class="form-input" id="virtualFittingGoodsId" placeholder="请输入一个商品ID" value="6921308899201171974">
                                    <button class="btn btn-primary" onclick="searchVirtualFittingGoods()">查询</button>
                                </div>
                            </div>
                            
                            <div id="virtualFittingProductInfo" style="display: none;">
                                <div style="margin-top: 15px;">
                                    <h4 style="margin-bottom: 10px; color: #333;">商品1: 6921308899201171974</h4>
                                    <div class="image-grid" style="grid-template-columns: repeat(3, 1fr); gap: 8px;">
                                        <div class="image-item selected" onclick="selectVirtualFittingImage(this)">
                                            <img src="https://youke1.picui.cn/s1/2025/08/01/688cb7e3003d7.jpg" alt="商品图片">
                                            <div style="position: absolute; bottom: 5px; left: 5px; background: #1890ff; color: white; padding: 2px 6px; border-radius: 3px; font-size: 12px;">✓</div>
                                        </div>
                                        <div class="image-item" onclick="selectVirtualFittingImage(this)">
                                            <img src="https://youke1.picui.cn/s1/2025/08/01/688cb7e3003d7.jpg" alt="商品图片">
                                        </div>
                                        <div class="image-item" onclick="selectVirtualFittingImage(this)">
                                            <img src="https://youke1.picui.cn/s1/2025/08/01/688cb7e3003d7.jpg" alt="商品图片">
                                        </div>
                                    </div>
                                </div>
                                
                                <div style="margin-top: 20px;">
                                    <h4 style="margin-bottom: 15px; color: #333;">请确认用于虚拟试衣的该SPUID所属品类 (单选)</h4>
                                    <div style="display: flex; gap: 15px;">
                                        <label style="display: flex; align-items: center; gap: 5px;">
                                            <input type="radio" name="productCategory" value="top"> 上装
                                        </label>
                                        <label style="display: flex; align-items: center; gap: 5px;">
                                            <input type="radio" name="productCategory" value="bottom" checked> 下装
                                        </label>
                                        <label style="display: flex; align-items: center; gap: 5px;">
                                            <input type="radio" name="productCategory" value="set"> 套装
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div id="uploadTab" style="display: none;">
                        <div style="margin-bottom: 20px;">
                            <h4 style="margin-bottom: 15px; color: #333;">上传商品图</h4>
                            <div style="margin-bottom: 10px; font-size: 14px; color: #666;">
                                请上传商品图片用于虚拟试衣
                            </div>
                            
                            <div class="image-grid" style="grid-template-columns: repeat(3, 1fr); gap: 12px;">
                                <div class="image-item" onclick="uploadProductImage(0)" style="border: 2px dashed #d9d9d9; display: flex; align-items: center; justify-content: center; background: #fafafa;">
                                    <div style="text-align: center; color: #999;">
                                        <div style="font-size: 24px; margin-bottom: 5px;">+</div>
                                        <div style="font-size: 12px;">上传商品图</div>
                                    </div>
                                </div>
                            </div>
                            
                            <div style="margin-top: 10px; font-size: 12px; color: #666;">
                                图片要求:分辨率不小于800*800,大小不超过10MB, 格式JPG/JPEG/PNG
                            </div>
                        </div>
                    </div>
                `,
                middlePanelContent: `
                    <div style="margin-bottom: 20px;">
                        <h4 style="margin-bottom: 15px; color: #333;">搭配建议 (可选)</h4>
                        <div class="form-group">
                            <label class="form-label">搭配建议</label>
                            <div style="display: flex; gap: 10px; align-items: center;">
                                <input type="text" class="form-input" id="stylingSuggestion" value="white Tshirt" style="flex: 1;">
                                <span style="font-size: 12px; color: #999;">12/50</span>
                            </div>
                            <div style="margin-top: 8px; font-size: 12px; color: #666;">
                                选填项;当商品图有选平铺图时,建议指定搭配服饰,未填写则系统将使用默认搭配,可能影响试衣效果;商品图为模特上身图时,无需填写搭配建议,系统将默认使用商品图中的搭配服饰进行试衣。若填写此项,请二次确认用于虚拟试衣的该搭配服饰所属品类 (单选)
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">搭配服饰品类</label>
                            <div style="display: flex; gap: 15px;">
                                <label style="display: flex; align-items: center; gap: 5px;">
                                    <input type="radio" name="stylingCategory" value="top" checked> 上装
                                </label>
                                <label style="display: flex; align-items: center; gap: 5px;">
                                    <input type="radio" name="stylingCategory" value="bottom"> 下装
                                </label>
                            </div>
                        </div>
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <h4 style="margin-bottom: 15px; color: #333;">上传参考图 <span style="color: red;">*</span></h4>
                        <div style="margin-bottom: 10px; font-size: 14px; color: #666;">
                            请上传用于虚拟试衣的效果参考图1-3张, 每一张参考图将生成4张试衣图
                        </div>
                        
                        <div class="image-grid" style="grid-template-columns: repeat(3, 1fr); gap: 12px;">
                            <div class="image-item" onclick="uploadReferenceImage(0)" style="border: 2px dashed #d9d9d9; display: flex; align-items: center; justify-content: center; background: #fafafa;">
                                <div style="text-align: center; color: #999;">
                                    <div style="font-size: 24px; margin-bottom: 5px;">+</div>
                                    <div style="font-size: 12px;">上传参考图</div>
                                </div>
                            </div>
                            <div class="image-item" onclick="uploadReferenceImage(1)" style="border: 2px dashed #d9d9d9; display: flex; align-items: center; justify-content: center; background: #fafafa;">
                                <div style="text-align: center; color: #999;">
                                    <div style="font-size: 24px; margin-bottom: 5px;">+</div>
                                    <div style="font-size: 12px;">上传参考图</div>
                                </div>
                            </div>
                            <div class="image-item" onclick="uploadReferenceImage(2)" style="border: 2px dashed #d9d9d9; display: flex; align-items: center; justify-content: center; background: #fafafa;">
                                <div style="text-align: center; color: #999;">
                                    <div style="font-size: 24px; margin-bottom: 5px;">+</div>
                                    <div style="font-size: 12px;">上传参考图</div>
                                </div>
                            </div>
                        </div>
                        
                        <div style="margin-top: 10px; font-size: 12px; color: #666;">
                            图片要求:分辨率不小于800*800,大小不超过10MB, 格式JPG/JPEG/PNG
                        </div>
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <h4 style="margin-bottom: 15px; color: #333;">任务信息</h4>
                        <div class="form-group">
                            <label class="form-label required">任务名称</label>
                            <div style="display: flex; gap: 10px; align-items: center;">
                                <input type="text" class="form-input" id="taskName" value="AI虚拟试衣-20250804-1060" style="flex: 1;">
                                <button class="btn btn-secondary" onclick="resetTaskName()">重置任务名</button>
                                <span style="font-size: 12px; color: #999;">20/45</span>
                            </div>
                        </div>
                        
                        <div style="margin-top: 10px; font-size: 12px; color: #666;">
                            生图比例与参考图尺寸相同
                        </div>
                    </div>
                `,
                middlePanelContent: `
                    <div class="empty-state">
                        <span class="material-icons">folder</span>
                        <p>暂无数据</p>
                    </div>
                `,
                tasks: [
                    { id: 1, title: '虚拟换衣任务20250101', status: '已完成' },
                    { id: 2, title: '虚拟换衣任务20250102', status: '进行中' },
                    { id: 3, title: '虚拟换衣任务20250103', status: '等待中' }
                ]
            },
            feedbackManagement: {
                title: '意见管理',
                breadcrumb: '创意工具 / 意见管理',
                middlePanelTitle: '意见记录',
                uploadInfo: `
                    <div style="margin-bottom: 20px;">
                        <h4 style="margin-bottom: 15px; color: #333;">筛选条件</h4>
                        <div style="display: flex; gap: 16px; margin-bottom: 20px;">
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <label>工具名称:</label>
                                <select class="form-input" style="width: 120px;">
                                    <option>全部</option>
                                    <option>扩图</option>
                                    <option>换背景</option>
                                    <option>背景裂变</option>
                                    <option>虚拟换衣</option>
                                    <option>图片创作</option>
                                </select>
                            </div>
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <label>时间范围:</label>
                                <input type="date" class="form-input" style="width: 120px;">
                                <span>至</span>
                                <input type="date" class="form-input" style="width: 120px;">
                            </div>
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <input type="text" class="form-input" placeholder="请输入关键字" style="width: 150px;">
                                <button class="btn btn-primary" onclick="filterFeedback()">查询</button>
                            </div>
                        </div>
                    </div>
                `,
                middlePanelContent: `
                    <div style="overflow-x: auto;">
                        <table style="width: 100%; border-collapse: collapse; font-size: 14px;">
                            <thead>
                                <tr style="background-color: #f5f5f5;">
                                    <th style="padding: 12px; text-align: left; border-bottom: 1px solid #e8e8e8; width: 100px;">工具名称</th>
                                    <th style="padding: 12px; text-align: left; border-bottom: 1px solid #e8e8e8; width: 120px;">原图及商品ID</th>
                                    <th style="padding: 12px; text-align: left; border-bottom: 1px solid #e8e8e8; width: 120px;">结果图</th>
                                    <th style="padding: 12px; text-align: left; border-bottom: 1px solid #e8e8e8; min-width: 200px;">意见记录</th>
                                    <th style="padding: 12px; text-align: left; border-bottom: 1px solid #e8e8e8; width: 120px;">操作快照</th>
                                    <th style="padding: 12px; text-align: left; border-bottom: 1px solid #e8e8e8; width: 100px;">提出人</th>
                                    <th style="padding: 12px; text-align: left; border-bottom: 1px solid #e8e8e8; width: 120px;">提出日期</th>
                                    <th style="padding: 12px; text-align: left; border-bottom: 1px solid #e8e8e8; width: 100px;">反馈</th>
                                    <th style="padding: 12px; text-align: left; border-bottom: 1px solid #e8e8e8; width: 80px;">操作</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr style="border-bottom: 1px solid #f0f0f0;" data-tool="扩图">
                                    <td style="padding: 12px;">扩图</td>
                                    <td style="padding: 12px;">
                                        <div style="margin-bottom: 4px;">
                                            <img src="https://youke1.picui.cn/s1/2025/08/04/689037a51d9bb.png" alt="原图" style="width: 60px; height: 40px; object-fit: cover; border-radius: 4px; cursor: pointer;" onclick="openImageModal('https://youke1.picui.cn/s1/2025/08/04/689037a51d9bb.png')">
                                        </div>
                                        <div style="font-size: 12px; color: #666;">商品ID: 6920234553221107522</div>
                                    </td>
                                    <td style="padding: 12px;">
                                        <img src="https://youke1.picui.cn/s1/2025/08/04/689037a51d9bb.png" alt="结果图" style="width: 60px; height: 40px; object-fit: cover; border-radius: 4px; cursor: pointer;" onclick="openImageModal('https://youke1.picui.cn/s1/2025/08/04/689037a51d9bb.png')">
                                    </td>
                                    <td style="padding: 12px;" class="feedback-content">生成的图片质量不够清晰，边缘模糊，希望能提高分辨率</td>
                                    <td style="padding: 12px;">
                                        <button class="btn btn-secondary" style="padding: 4px 8px; font-size: 12px;" onclick="viewOperationSnapshot('扩图配置截图')">查看</button>
                                    </td>
                                    <td style="padding: 12px;">张三</td>
                                    <td style="padding: 12px;">2025-01-15</td>
                                    <td style="padding: 12px;" class="feedback-status">待处理</td>
                                    <td style="padding: 12px;">
                                        <button class="btn btn-secondary" style="padding: 4px 8px; font-size: 12px;" onclick="editFeedback(this)">编辑</button>
                                    </td>
                                </tr>
                                <tr style="border-bottom: 1px solid #f0f0f0;" data-tool="换背景">
                                    <td style="padding: 12px;">换背景</td>
                                    <td style="padding: 12px;">
                                        <div style="margin-bottom: 4px;">
                                            <img src="https://youke1.picui.cn/s1/2025/08/01/688cb7e3003d7.jpg" alt="原图" style="width: 60px; height: 40px; object-fit: cover; border-radius: 4px; cursor: pointer;" onclick="openImageModal('https://youke1.picui.cn/s1/2025/08/01/688cb7e3003d7.jpg')">
                                        </div>
                                        <div style="font-size: 12px; color: #666;">商品ID: 6921461213816069463</div>
                                    </td>
                                    <td style="padding: 12px;">
                                        <img src="https://youke1.picui.cn/s1/2025/08/01/688cb7e3003d7.jpg" alt="结果图" style="width: 60px; height: 40px; object-fit: cover; border-radius: 4px; cursor: pointer;" onclick="openImageModal('https://youke1.picui.cn/s1/2025/08/01/688cb7e3003d7.jpg')">
                                    </td>
                                    <td style="padding: 12px;" class="feedback-content">背景替换后商品主体被遮挡，建议优化算法</td>
                                    <td style="padding: 12px;">
                                        <button class="btn btn-secondary" style="padding: 4px 8px; font-size: 12px;" onclick="viewOperationSnapshot('换背景配置截图')">查看</button>
                                    </td>
                                    <td style="padding: 12px;">李四</td>
                                    <td style="padding: 12px;">2025-01-14</td>
                                    <td style="padding: 12px;" class="feedback-status">已处理</td>
                                    <td style="padding: 12px;">
                                        <button class="btn btn-secondary" style="padding: 4px 8px; font-size: 12px;" onclick="editFeedback(this)">编辑</button>
                                    </td>
                                </tr>
                                <tr style="border-bottom: 1px solid #f0f0f0;" data-tool="背景裂变">
                                    <td style="padding: 12px;">背景裂变</td>
                                    <td style="padding: 12px;">
                                        <div style="margin-bottom: 4px;">
                                            <img src="https://youke1.picui.cn/s1/2025/08/04/68905925c8587.jpeg" alt="原图" style="width: 60px; height: 40px; object-fit: cover; border-radius: 4px; cursor: pointer;" onclick="openImageModal('https://youke1.picui.cn/s1/2025/08/04/68905925c8587.jpeg')">
                                        </div>
                                        <div style="font-size: 12px; color: #666;">商品ID: 6920852030913365521</div>
                                    </td>
                                    <td style="padding: 12px;">
                                        <img src="https://youke1.picui.cn/s1/2025/08/04/68905925c8587.jpeg" alt="结果图" style="width: 60px; height: 40px; object-fit: cover; border-radius: 4px; cursor: pointer;" onclick="openImageModal('https://youke1.picui.cn/s1/2025/08/04/68905925c8587.jpeg')">
                                    </td>
                                    <td style="padding: 12px;" class="feedback-content">生成的背景图风格与参考图差异较大，相似度设置不够准确</td>
                                    <td style="padding: 12px;">
                                        <button class="btn btn-secondary" style="padding: 4px 8px; font-size: 12px;" onclick="viewOperationSnapshot('背景裂变配置截图')">查看</button>
                                    </td>
                                    <td style="padding: 12px;">王五</td>
                                    <td style="padding: 12px;">2025-01-13</td>
                                    <td style="padding: 12px;" class="feedback-status">处理中</td>
                                    <td style="padding: 12px;">
                                        <button class="btn btn-secondary" style="padding: 4px 8px; font-size: 12px;" onclick="editFeedback(this)">编辑</button>
                                    </td>
                                </tr>
                                <tr style="border-bottom: 1px solid #f0f0f0;" data-tool="虚拟换衣">
                                    <td style="padding: 12px;">虚拟换衣</td>
                                    <td style="padding: 12px;">
                                        <div style="margin-bottom: 4px;">
                                            <img src="https://youke1.picui.cn/s1/2025/08/04/68905925d6370.jpeg" alt="原图" style="width: 60px; height: 40px; object-fit: cover; border-radius: 4px; cursor: pointer;" onclick="openImageModal('https://youke1.picui.cn/s1/2025/08/04/68905925d6370.jpeg')">
                                        </div>
                                        <div style="font-size: 12px; color: #666;">商品ID: 6921461213816069463</div>
                                    </td>
                                    <td style="padding: 12px;">
                                        <img src="https://youke1.picui.cn/s1/2025/08/04/68905925d6370.jpeg" alt="结果图" style="width: 60px; height: 40px; object-fit: cover; border-radius: 4px; cursor: pointer;" onclick="openImageModal('https://youke1.picui.cn/s1/2025/08/04/68905925d6370.jpeg')">
                                    </td>
                                    <td style="padding: 12px;" class="feedback-content">换衣效果不自然，衣服褶皱处理需要改进</td>
                                    <td style="padding: 12px;">
                                        <button class="btn btn-secondary" style="padding: 4px 8px; font-size: 12px;" onclick="viewOperationSnapshot('虚拟换衣配置截图')">查看</button>
                                    </td>
                                    <td style="padding: 12px;">赵六</td>
                                    <td style="padding: 12px;">2025-01-12</td>
                                    <td style="padding: 12px;" class="feedback-status">待处理</td>
                                    <td style="padding: 12px;">
                                        <button class="btn btn-secondary" style="padding: 4px 8px; font-size: 12px;" onclick="editFeedback(this)">编辑</button>
                                    </td>
                                </tr>
                                <tr style="border-bottom: 1px solid #f0f0f0;" data-tool="图片创作">
                                    <td style="padding: 12px;">图片创作</td>
                                    <td style="padding: 12px;">
                                        <div style="margin-bottom: 4px;">
                                            <img src="https://youke1.picui.cn/s1/2025/08/04/689059264c66b.jpeg" alt="原图" style="width: 60px; height: 40px; object-fit: cover; border-radius: 4px; cursor: pointer;" onclick="openImageModal('https://youke1.picui.cn/s1/2025/08/04/689059264c66b.jpeg')">
                                        </div>
                                        <div style="font-size: 12px; color: #666;">商品ID: 6920898667058027100</div>
                                    </td>
                                    <td style="padding: 12px;">
                                        <img src="https://youke1.picui.cn/s1/2025/08/04/689059264c66b.jpeg" alt="结果图" style="width: 60px; height: 40px; object-fit: cover; border-radius: 4px; cursor: pointer;" onclick="openImageModal('https://youke1.picui.cn/s1/2025/08/04/689059264c66b.jpeg')">
                                    </td>
                                    <td style="padding: 12px;" class="feedback-content">模板选择太少，希望能增加更多风格选项</td>
                                    <td style="padding: 12px;">
                                        <button class="btn btn-secondary" style="padding: 4px 8px; font-size: 12px;" onclick="viewOperationSnapshot('图片创作配置截图')">查看</button>
                                    </td>
                                    <td style="padding: 12px;">孙七</td>
                                    <td style="padding: 12px;">2025-01-11</td>
                                    <td style="padding: 12px;" class="feedback-status">已处理</td>
                                    <td style="padding: 12px;">
                                        <button class="btn btn-secondary" style="padding: 4px 8px; font-size: 12px;" onclick="editFeedback(this)">编辑</button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                `,
                tasks: []
            },
            imageCreation: {
                title: '图片创作',
                breadcrumb: '创意工具 / 图片创作',
                middlePanelTitle: '选择模板',
                uploadInfo: `
                    <div class="form-group">
                        <label class="form-label required">商品ID</label>
                        <div class="input-group">
                            <input type="text" class="form-input" placeholder="请输入一个商品ID">
                            <button class="btn btn-primary">查询</button>
                        </div>
                    </div>
                    <div class="tabs">
                        <div class="tab active">商品主图</div>
                        <div class="tab">商品含文字</div>
                        <div class="tab">商品带背</div>
                    </div>
                    <div class="empty-state">
                        <span class="material-icons">image</span>
                        <p>暂无数据</p>
                    </div>
                `,
                middlePanelContent: `
                    <div style="margin-bottom: 20px;">
                        <div style="display: flex; gap: 16px; margin-bottom: 20px;">
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <label>商品图框:</label>
                                <select class="form-input" style="width: 100px;">
                                    <option>全部</option>
                                    <option>无框</option>
                                    <option>单框</option>
                                    <option>双框</option>
                                    <option>三框</option>
                                </select>
                            </div>
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <label>商品图数:</label>
                                <select class="form-input" style="width: 100px;">
                                    <option>全部</option>
                                    <option>一图</option>
                                    <option>二图</option>
                                    <option>三图</option>
                                    <option>四图</option>
                                </select>
                            </div>
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <input type="text" class="form-input" placeholder="请输入关键字" style="width: 150px;">
                                <button class="btn btn-primary">Q 查询</button>
                            </div>
                        </div>
                    </div>
                    <div class="image-grid">
                        <div class="image-item">
                            <img src="https://youke1.picui.cn/s1/2025/08/01/688cb7e3003d7.jpg" alt="模板">
                        </div>
                        <div class="image-item">
                            <img src="https://youke1.picui.cn/s1/2025/08/01/688cb7e3003d7.jpg" alt="模板">
                        </div>
                        <div class="image-item">
                            <img src="https://youke1.picui.cn/s1/2025/08/01/688cb7e3003d7.jpg" alt="模板">
                        </div>
                        <div class="image-item">
                            <img src="https://youke1.picui.cn/s1/2025/08/01/688cb7e3003d7.jpg" alt="模板">
                        </div>
                        <div class="image-item">
                            <img src="https://youke1.picui.cn/s1/2025/08/01/688cb7e3003d7.jpg" alt="模板">
                        </div>
                        <div class="image-item">
                            <img src="https://youke1.picui.cn/s1/2025/08/01/688cb7e3003d7.jpg" alt="模板">
                        </div>
                    </div>
                `,
                tasks: [
                    { id: 1, title: '图生成任务20250101', status: '已完成' },
                    { id: 2, title: '图生成任务20250102', status: '进行中' },
                    { id: 3, title: '图生成任务20250103', status: '等待中' },
                    { id: 4, title: '图生成任务20250104', status: '已完成' }
                ]
            },
            imageCreation: {
                title: '图片创作',
                breadcrumb: '创意工具 / 图片创作',
                middlePanelTitle: '选择模板',
                uploadInfo: `
                    <div style="margin-bottom: 20px;">
                        <h4 style="margin-bottom: 10px; color: #333;">商品ID <span class="help-icon" title="请输入商品ID">?</span></h4>
                        <div style="display: flex; gap: 8px; margin-bottom: 16px;">
                            <input type="text" class="form-input" placeholder="请输入一个商品ID" style="flex: 1;">
                            <button class="btn btn-primary" onclick="queryProduct()">查询</button>
                        </div>
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                            <h4 style="margin: 0; color: #333;">商品图 (已选1个)</h4>
                            <button class="btn btn-primary" onclick="viewAll()">查看全部</button>
                        </div>
                        
                        <div style="margin-bottom: 16px;">
                            <div class="image-type-tabs">
                                <div class="tab active" onclick="switchImageType(this, 'main')">商品主图</div>
                                <div class="tab" onclick="switchImageType(this, 'text')">商品含文字</div>
                                <div class="tab" onclick="switchImageType(this, 'bg')">商品带背景</div>
                                <div class="tab" onclick="switchImageType(this, 'cutout')">商品抠图</div>
                            </div>
                        </div>
                        
                        <div style="margin-bottom: 20px;">
                            <h4 style="margin-bottom: 10px; color: #333;">商品1: 6920898667058027100</h4>
                            <div class="image-grid" style="grid-template-columns: repeat(3, 1fr); gap: 8px;">
                                <div class="image-item" onclick="selectProductImage(this)">
                                    <img src="https://youke1.picui.cn/s1/2025/08/06/6892f6ef774d3.png" alt="商品图片">
                                    <div class="image-label">正面展示</div>
                                </div>
                                <div class="image-item selected" onclick="selectProductImage(this)">
                                    <img src="https://youke1.picui.cn/s1/2025/08/06/6892f6ef774d3.png" alt="商品图片">
                                    <div class="image-label">侧面展示</div>
                                    <div style="position: absolute; bottom: 5px; left: 5px; background: #1890ff; color: white; padding: 2px 6px; border-radius: 3px; font-size: 12px;">✓</div>
                                </div>
                                <div class="image-item" onclick="selectProductImage(this)">
                                    <img src="https://youke1.picui.cn/s1/2025/08/06/6892f6ef774d3.png" alt="商品图片">
                                    <div class="image-label">背面展示</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-section">
                        <h4>类型 <span class="help-icon" title="选择图片生成类型">?</span> <span style="color: #ff4d4f;">*</span></h4>
                        <div class="radio-group">
                            <label>
                                <input type="radio" name="imageType" value="single" checked> 单品单图
                            </label>
                        </div>
                    </div>
                    
                    <div class="form-section">
                        <h4>尺寸 <span class="help-icon" title="选择图片尺寸">?</span> <span style="color: #ff4d4f;">*</span></h4>
                        <div class="form-group">
                            <select class="form-input" id="imageSize">
                                <option value="">请选择尺寸</option>
                                <option value="800x800">方图800*800</option>
                                <option value="1200x1200">方图1200*1200</option>
                                <option value="1080x1920">竖图1080*1920</option>
                                <option value="1920x1080">横图1920*1080</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-section">
                        <h4>数量 <span class="help-icon" title="设置生成数量">?</span> <span style="color: #ff4d4f;">*</span></h4>
                        <div class="form-group">
                            <input type="number" class="form-input" value="1" min="1" max="10" style="width: 80px;">
                            <span style="margin-left: 8px; color: #666;">张图/每一个模板</span>
                        </div>
                    </div>
                    
                    <div class="form-section">
                        <h4>填写价格 <span class="help-icon" title="设置商品价格">?</span> <span style="color: #ff4d4f;">*</span></h4>
                        <div class="form-group">
                            <div style="display: flex; gap: 8px; margin-bottom: 8px;">
                                <label style="min-width: 60px;">到手价:</label>
                                <input type="number" class="form-input" value="80.00" step="0.01" style="width: 120px;">
                            </div>
                            <div style="display: flex; gap: 8px;">
                                <label style="min-width: 60px;">唯品价:</label>
                                <input type="number" class="form-input" value="180.00" step="0.01" style="width: 120px;">
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-section">
                        <h4>投放渠道 <span class="help-icon" title="选择投放渠道">?</span> <span style="color: #ff4d4f;">*</span></h4>
                        <div class="form-group">
                            <select class="form-input" id="channel">
                                <option value="">请选择投放渠道</option>
                                <option value="bytedance">字节</option>
                                <option value="tencent">腾讯</option>
                                <option value="alibaba">阿里</option>
                                <option value="baidu">百度</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-section">
                        <h4>应用场景 <span class="help-icon" title="选择应用场景">?</span> <span style="color: #ff4d4f;">*</span></h4>
                        <div class="form-group">
                            <select class="form-input" id="scene">
                                <option value="">请选择应用场景</option>
                                <option value="daily">日常</option>
                                <option value="promotion">促销</option>
                                <option value="festival">节日</option>
                                <option value="seasonal">季节</option>
                            </select>
                        </div>
                    </div>
                `,
                middlePanelContent: `
                    <div style="margin-bottom: 20px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                            <h3 style="margin: 0;">选择模板</h3>
                            <button class="btn btn-primary" id="startProductionBtn" onclick="startProduction()" disabled>
                                开始生产
                            </button>
                        </div>
                        
                        <div style="display: flex; gap: 12px; margin-bottom: 16px;">
                            <div style="display: flex; gap: 8px;">
                                <label style="display: flex; align-items: center; font-weight: 500;">商品图框:</label>
                                <div class="filter-tabs">
                                    <div class="filter-tab active" onclick="filterByFrame(this, 'all')">全部</div>
                                    <div class="filter-tab" onclick="filterByFrame(this, 'none')">无框</div>
                                    <div class="filter-tab" onclick="filterByFrame(this, 'single')">单框</div>
                                    <div class="filter-tab" onclick="filterByFrame(this, 'double')">双框</div>
                                    <div class="filter-tab" onclick="filterByFrame(this, 'triple')">三框</div>
                                </div>
                            </div>
                        </div>
                        
                        <div style="display: flex; gap: 12px; margin-bottom: 16px;">
                            <div style="display: flex; gap: 8px;">
                                <label style="display: flex; align-items: center; font-weight: 500;">商品图数:</label>
                                <div class="filter-tabs">
                                    <div class="filter-tab active" onclick="filterByCount(this, 'all')">全部</div>
                                    <div class="filter-tab" onclick="filterByCount(this, '1')">一图</div>
                                    <div class="filter-tab" onclick="filterByCount(this, '2')">二图</div>
                                    <div class="filter-tab" onclick="filterByCount(this, '3')">三图</div>
                                    <div class="filter-tab" onclick="filterByCount(this, '2')">四图</div>
                                </div>
                            </div>
                        </div>
                        
                        <div style="display: flex; gap: 8px; margin-bottom: 16px;">
                            <input type="text" class="form-input" placeholder="请输入关键字" style="flex: 1;">
                            <button class="btn btn-primary" onclick="searchTemplates()">
                                <span class="material-icons" style="font-size: 16px;">search</span>
                                查询
                            </button>
                        </div>
                    </div>
                    
                    <div class="template-grid" id="templateGrid">
                        <!-- 模板将通过JavaScript动态生成 -->
                    </div>
                `
            }
        };

        let currentModule = 'expand';

        // 显示模块
        function showModule(moduleName) {
            currentModule = moduleName;
            const data = mockData[moduleName];
            
            // 重置左侧面板显示状态（如果之前被隐藏）
            const leftPanel = document.querySelector('.left-panel');
            if (leftPanel) {
                leftPanel.style.display = 'flex';
            }
            
            // 重置中间面板flex状态
            const middlePanel = document.querySelector('.middle-panel');
            if (middlePanel) {
                middlePanel.style.flex = '';
            }
            
            // 重置右侧面板显示状态
            const rightPanel = document.querySelector('.right-panel');
            if (rightPanel) {
                rightPanel.style.display = 'flex';
            }
            
            // 更新面包屑
            document.getElementById('breadcrumb').textContent = data.breadcrumb;
            
            // 更新中间面板标题
            document.getElementById('middlePanelTitle').textContent = data.middlePanelTitle;
            
            // 更新上传信息
            document.getElementById('uploadInfo').innerHTML = data.uploadInfo;
            
            // 更新中间面板内容
            document.getElementById('middlePanelContent').innerHTML = data.middlePanelContent;
            
            // 更新导航状态
            updateNavigation(moduleName);
            
            // 确保所有面板都正确显示
            const panels = document.querySelectorAll('.left-panel, .middle-panel, .right-panel');
            panels.forEach(panel => {
                if (panel) {
                    panel.style.display = 'flex';
                }
            });
            
            // 只在特定页面显示Toast提示
            const toastModules = ['expand', 'bgChange', 'bgFission', 'imageCreation', 'virtualTryOn'];
            if (toastModules.includes(moduleName)) {
                showToast();
            }
            
            // 初始化字符计数功能（已移除）
            // initCharCount();
            
            // 特殊处理扩图功能
            if (moduleName === 'expand') {
                // 设置扩图功能的初始状态为"选择商品"
                const tabs = document.querySelectorAll('.tab');
                if (tabs.length >= 2) {
                    tabs[0].classList.add('active'); // 选择商品
                    tabs[1].classList.remove('active'); // 自行上传
                }
                // 显示选择商品模式
                switchExpandTab('select');
                
                // 初始化扩图方向选项（延迟执行确保DOM已渲染）
                setTimeout(() => {
                    const defaultRatioRadio = document.querySelector('input[name="expandRatio"]:checked');
                    if (defaultRatioRadio) {
                        updateDirectionOptions(defaultRatioRadio);
                    }
                }, 100);
            }
            
            // 特殊处理背景裂变功能
            if (moduleName === 'bgFission') {
                resetBgFissionForm();
                hideTabsAndGoodsId();
            } else if (moduleName === 'imageCreation') {
                // 图片创作特殊处理
                hideTabsAndGoodsId();
                // 初始化模板网格和配置监听器
                setTimeout(() => {
                    updateTemplates();
                    addConfigListeners();
                }, 100);
            } else if (moduleName === 'feedbackManagement') {
                hideTabsAndGoodsId();
                // 意见管理特殊布局：隐藏左面板，只显示中间面板
                document.querySelector('.left-panel').style.display = 'none';
                document.querySelector('.middle-panel').style.flex = '1';
                // 更新中间面板标题，去除全部下载按钮
                document.getElementById('middlePanelTitle').innerHTML = '意见记录';
                // 隐藏中间面板的"全部下载"按钮
                const middlePanelHeader = document.querySelector('.middle-panel .panel-header');
                if (middlePanelHeader) {
                    const downloadAllBtn = middlePanelHeader.querySelector('button[onclick="downloadAll()"]');
                    if (downloadAllBtn) {
                        downloadAllBtn.style.display = 'none';
                    }
                }
                // 隐藏生产按钮，添加导出按钮到中间面板标题右侧
                const headerActions = document.querySelector('.header-actions');
                if (headerActions) {
                    const productionBtn = headerActions.querySelector('.btn-primary');
                    if (productionBtn && productionBtn.textContent === '生产') {
                        productionBtn.style.display = 'none';
                    }
                    // 移除已存在的导出按钮
                    const existingExportBtn = headerActions.querySelector('.export-btn');
                    if (existingExportBtn) {
                        existingExportBtn.remove();
                    }
                }
                // 在中间面板标题右侧添加导出按钮
                const middlePanelTitle = document.getElementById('middlePanelTitle');
                if (middlePanelTitle) {
                    middlePanelTitle.innerHTML = '意见记录';
                }
                // 在表格上方添加导出按钮
                const middlePanelContent = document.getElementById('middlePanelContent');
                if (middlePanelContent) {
                    const table = middlePanelContent.querySelector('table');
                    if (table) {
                        const exportButton = document.createElement('div');
                        exportButton.style.cssText = 'text-align: right; margin-bottom: 15px;';
                        exportButton.innerHTML = '<button class="btn btn-primary" onclick="exportToExcel()">导出</button>';
                        table.parentNode.insertBefore(exportButton, table);
                    }
                }
            } else {
                // 其他功能恢复标签页和商品ID模块的显示
                showTabsAndGoodsId();
                // 恢复正常布局
                document.querySelector('.left-panel').style.display = 'flex';
                document.querySelector('.middle-panel').style.flex = '';
                // 恢复中间面板的"全部下载"按钮显示
                const middlePanelHeader = document.querySelector('.middle-panel .panel-header');
                if (middlePanelHeader) {
                    const downloadAllBtn = middlePanelHeader.querySelector('button[onclick="downloadAll()"]');
                    if (downloadAllBtn) {
                        downloadAllBtn.style.display = 'inline-block';
                    }
                }
                // 恢复生产按钮显示
                const headerActions = document.querySelector('.header-actions');
                if (headerActions) {
                    const productionBtn = headerActions.querySelector('.btn-primary');
                    if (productionBtn && productionBtn.textContent === '生产') {
                        productionBtn.style.display = 'inline-block';
                    }
                    // 移除导出按钮
                    const existingExportBtn = headerActions.querySelector('.export-btn');
                    if (existingExportBtn) {
                        existingExportBtn.remove();
                    }
                }
                // 更新任务列表
                updateTaskList(data.tasks);
            }
        }

        // 更新任务列表
        function updateTaskList(tasks) {
            const taskList = document.getElementById('taskList');
            if (currentModule === 'changeBg') {
                // 换背景任务列表
                taskList.innerHTML = tasks.map(task => `
                    <li class="task-item" onclick="selectTask(this)">
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <img src="https://youke1.picui.cn/s1/2025/08/01/688cb7e3003d7.jpg" alt="换背景预览" style="width: 40px; height: 40px; object-fit: cover; border-radius: 4px; flex-shrink: 0;">
                            <div style="flex: 1;">
                                <div style="font-weight: 500;">${task.title}</div>
                                <div style="font-size: 12px; color: #999;">${task.status}</div>
                            </div>
                        </div>
                    </li>
                `).join('');
            } else if (currentModule === 'bgFission') {
                // 背景裂变任务列表
                taskList.innerHTML = tasks.map(task => `
                    <li class="task-item" onclick="selectTask(this)">
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <img src="https://youke1.picui.cn/s1/2025/08/04/68905925c8587.jpeg" alt="背景裂变预览" style="width: 40px; height: 40px; object-fit: cover; border-radius: 4px; flex-shrink: 0;">
                            <div style="flex: 1;">
                                <div style="font-weight: 500;">${task.title}</div>
                                <div style="font-size: 12px; color: #999;">${task.status}</div>
                            </div>
                        </div>
                    </li>
                `).join('');
            } else if (currentModule === 'feedbackManagement') {
                // 意见管理任务列表
                taskList.innerHTML = tasks.map(task => `
                    <li class="task-item" onclick="selectTask(this)">
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <div style="width: 40px; height: 40px; background: #f0f0f0; border-radius: 4px; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
                                <span class="material-icons" style="color: #666;">feedback</span>
                            </div>
                            <div style="flex: 1;">
                                <div style="font-weight: 500;">${task.title}</div>
                                <div style="font-size: 12px; color: #999;">${task.status}</div>
                            </div>
                        </div>
                    </li>
                `).join('');
            } else {
                // 扩图任务列表
                taskList.innerHTML = tasks.map(task => `
                    <li class="task-item" onclick="selectTask(this)">
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <img src="https://youke1.picui.cn/s1/2025/08/01/688cb7e3003d7.jpg" alt="商品预览" style="width: 40px; height: 40px; object-fit: cover; border-radius: 4px; flex-shrink: 0;">
                            <div style="flex: 1;">
                                <div style="font-weight: 500;">${task.title}</div>
                                <div style="font-size: 12px; color: #999;">${task.status}</div>
                            </div>
                        </div>
                    </li>
                `).join('');
            }
        }

        // 更新导航状态
        function updateNavigation(moduleName) {
            document.querySelectorAll('.sub-menu .nav-link').forEach(link => {
                link.classList.remove('active');
            });
            
            if (moduleName === 'bgFission') {
                // 背景裂变是换背景的子功能，需要特殊处理
                const changeBgLink = document.querySelector('.nav-link[onclick*="changeBg"]');
                if (changeBgLink) {
                    changeBgLink.classList.add('active');
                }
                const bgFissionLink = document.querySelector('.nav-link[onclick*="bgFission"]');
                if (bgFissionLink) {
                    bgFissionLink.classList.add('active');
                }
            } else if (moduleName === 'changeBg') {
                // 换背景功能本身，只激活换背景链接
                const changeBgLink = document.querySelector('.nav-link[onclick*="changeBg"]');
                if (changeBgLink) {
                    changeBgLink.classList.add('active');
                }
            } else {
                // 找到对应的导航链接并激活
                const targetLink = document.querySelector(`.nav-link[onclick*="${moduleName}"]`);
                if (targetLink) {
                    targetLink.classList.add('active');
                }
            }
        }

        // 切换标签页
        function switchTab(tabName) {
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // 如果是扩图功能，需要特殊处理
            if (currentModule === 'expand') {
                switchExpandTab(tabName);
            }
        }

        // 扩图功能的标签页切换
        function switchExpandTab(tabName) {
            const selectProductTab = document.getElementById('selectProductTab');
            const uploadTab = document.getElementById('uploadTab');
            const goodsIdGroup = document.querySelector('.form-group');
            
            if (tabName === 'select') {
                // 显示选择商品模式
                if (selectProductTab) selectProductTab.style.display = 'block';
                if (uploadTab) uploadTab.style.display = 'none';
                
                // 显示商品ID输入框
                if (goodsIdGroup) goodsIdGroup.style.display = 'block';
            } else if (tabName === 'upload') {
                // 显示自行上传模式
                if (selectProductTab) selectProductTab.style.display = 'none';
                if (uploadTab) uploadTab.style.display = 'block';
                
                // 隐藏商品ID输入框
                if (goodsIdGroup) goodsIdGroup.style.display = 'none';
            }
        }

        // 处理比例变化（包括自定义输入框和方向选项）
        function handleRatioChange(showCustom, element) {
            // 找到当前radio按钮所在的form-section
            const formSection = element.closest('.form-section');
            if (!formSection) return;
            
            // 处理自定义输入框显示/隐藏
            const customInputs = formSection.querySelector('.custom-ratio-inputs');
            if (customInputs) {
                if (showCustom) {
                    customInputs.style.display = 'block';
                    // 聚焦到宽度输入框
                    const widthInput = customInputs.querySelector('.custom-width');
                    if (widthInput) {
                        setTimeout(() => widthInput.focus(), 100);
                    }
                } else {
                    customInputs.style.display = 'none';
                }
            }
            
            // 更新扩图方向选项
            updateDirectionOptions(element);
        }

        // 更新扩图方向选项
        function updateDirectionOptions(ratioElement) {
            // 找到所有扩图方向区域
            const directionSections = document.querySelectorAll('.expand-direction-section');
            
            directionSections.forEach(directionSection => {
                const verticalDirections = directionSection.querySelector('.vertical-directions');
                const horizontalDirections = directionSection.querySelector('.horizontal-directions');
                const helpIcon = directionSection.querySelector('.expand-direction-help');
                
                if (!verticalDirections || !horizontalDirections) return;
                
                // 判断当前比例是竖图还是横图
                const isVertical = isVerticalRatio(ratioElement);
                
                if (isVertical) {
                    // 显示竖图方向选项
                    verticalDirections.style.display = 'flex';
                    horizontalDirections.style.display = 'none';
                    if (helpIcon) helpIcon.title = '选择向上、向下或居中扩图';
                    
                    // 清除横图方向的选中状态
                    const horizontalInputs = horizontalDirections.querySelectorAll('input[type="radio"]');
                    horizontalInputs.forEach(input => input.checked = false);
                    
                    // 确保竖图方向有默认选中项
                    const verticalInputs = verticalDirections.querySelectorAll('input[type="radio"]');
                    const hasChecked = Array.from(verticalInputs).some(input => input.checked);
                    if (!hasChecked && verticalInputs.length > 0) {
                        verticalInputs[1].checked = true; // 默认选择"向下扩图"
                    }
                } else {
                    // 显示横图方向选项
                    verticalDirections.style.display = 'none';
                    horizontalDirections.style.display = 'flex';
                    if (helpIcon) helpIcon.title = '选择向左、向右或居中扩图';
                    
                    // 清除竖图方向的选中状态
                    const verticalInputs = verticalDirections.querySelectorAll('input[type="radio"]');
                    verticalInputs.forEach(input => input.checked = false);
                    
                    // 确保横图方向有默认选中项
                    const horizontalInputs = horizontalDirections.querySelectorAll('input[type="radio"]');
                    const hasChecked = Array.from(horizontalInputs).some(input => input.checked);
                    if (!hasChecked && horizontalInputs.length > 0) {
                        horizontalInputs[2].checked = true; // 默认选择"居中扩图"
                    }
                }
            });
        }

        // 判断当前比例是否为竖图
        function isVerticalRatio(ratioElement) {
            const formSection = ratioElement.closest('.form-section');
            if (!formSection) return true; // 默认竖图
            
            const checkedRadio = formSection.querySelector('input[name="expandRatio"]:checked');
            if (!checkedRadio) return true;
            
            if (checkedRadio.value === 'custom') {
                // 自定义比例：比较宽度和高度
                const widthInput = formSection.querySelector('.custom-width');
                const heightInput = formSection.querySelector('.custom-height');
                if (widthInput && heightInput && widthInput.value && heightInput.value) {
                    const width = parseFloat(widthInput.value);
                    const height = parseFloat(heightInput.value);
                    return width < height; // 宽小于高为竖图
                }
                return true; // 默认竖图
            } else {
                // 预设比例：根据比例值判断
                const [width, height] = checkedRadio.value.split(':').map(Number);
                return width < height;
            }
        }

        // 当自定义比例输入改变时触发
        function onCustomRatioChange(inputElement) {
            // 找到对应的比例选择radio按钮
            const customRatioInputs = inputElement.closest('.custom-ratio-inputs');
            if (!customRatioInputs) return;
            
            const formSection = customRatioInputs.closest('.form-section');
            if (!formSection) return;
            
            const customRadio = formSection.querySelector('input[name="expandRatio"][value="custom"]');
            if (!customRadio || !customRadio.checked) return;
            
            // 更新方向选项
            updateDirectionOptions(customRadio);
        }

        // 抽屉控制函数
        function toggleDrawer() {
            const drawerPanel = document.getElementById('drawerPanel');
            const drawerOverlay = document.getElementById('drawerOverlay');
            
            if (drawerPanel.classList.contains('open')) {
                closeDrawer();
            } else {
                openDrawer();
            }
        }

        function openDrawer() {
            const drawerPanel = document.getElementById('drawerPanel');
            const drawerOverlay = document.getElementById('drawerOverlay');
            
            drawerPanel.classList.add('open');
            drawerOverlay.classList.add('show');
            
            // 防止背景滚动
            document.body.style.overflow = 'hidden';
        }

        function closeDrawer() {
            const drawerPanel = document.getElementById('drawerPanel');
            const drawerOverlay = document.getElementById('drawerOverlay');
            
            drawerPanel.classList.remove('open');
            drawerOverlay.classList.remove('show');
            
            // 恢复背景滚动
            document.body.style.overflow = '';
        }

        // ESC键关闭抽屉
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                const drawerPanel = document.getElementById('drawerPanel');
                if (drawerPanel && drawerPanel.classList.contains('open')) {
                    closeDrawer();
                }
            }
        });

        // 选择比例选项
        function selectRatioOption(element) {
            // 移除同一组中其他选项的selected类
            const ratioOptions = element.closest('.ratio-options');
            if (ratioOptions) {
                ratioOptions.querySelectorAll('.ratio-option').forEach(option => {
                    option.classList.remove('selected');
                });
            }
            
            // 为当前选项添加selected类
            element.classList.add('selected');
            
            // 触发radio按钮的change事件
            const radioInput = element.querySelector('input[type="radio"]');
            if (radioInput) {
                radioInput.checked = true;
                radioInput.dispatchEvent(new Event('change'));
            }
        }

        // 图片创作相关函数
        function queryProduct() {
            showToast('商品查询成功！');
            // 这里可以添加实际的商品查询逻辑
        }

        function goBack() {
            showToast('返回上一页');
        }

        function viewAll() {
            showToast('查看全部商品');
        }

        function switchImageType(element, type) {
            // 移除所有active类
            const tabs = element.parentElement.querySelectorAll('.tab');
            tabs.forEach(tab => tab.classList.remove('active'));
            
            // 为当前tab添加active类
            element.classList.add('active');
            
            // 根据类型更新商品图片
            updateProductImages(type);
        }

        function updateProductImages(type) {
            // 这里可以根据类型更新商品图片
            showToast(`切换到${type}类型`);
        }

        function selectProductImage(element) {
            // 移除同一组中其他图片的selected类
            const imageGrid = element.closest('.image-grid');
            if (imageGrid) {
                imageGrid.querySelectorAll('.image-item').forEach(item => {
                    item.classList.remove('selected');
                    const checkmark = item.querySelector('div[style*="background: #1890ff"]');
                    if (checkmark) checkmark.remove();
                });
            }
            
            // 为当前图片添加selected类和勾选标记
            element.classList.add('selected');
            const checkmark = document.createElement('div');
            checkmark.style.cssText = 'position: absolute; bottom: 5px; left: 5px; background: #1890ff; color: white; padding: 2px 6px; border-radius: 3px; font-size: 12px;';
            checkmark.textContent = '✓';
            element.appendChild(checkmark);
        }

        function filterByFrame(element, frameType) {
            // 移除所有active类
            const tabs = element.parentElement.querySelectorAll('.filter-tab');
            tabs.forEach(tab => tab.classList.remove('active'));
            
            // 为当前tab添加active类
            element.classList.add('active');
            
            // 根据筛选条件更新模板
            updateTemplates();
        }

        function filterByCount(element, count) {
            // 移除所有active类
            const tabs = element.parentElement.querySelectorAll('.filter-tab');
            tabs.forEach(tab => tab.classList.remove('active'));
            
            // 为当前tab添加active类
            element.classList.add('active');
            
            // 根据筛选条件更新模板
            updateTemplates();
        }

        function searchTemplates() {
            showToast('搜索模板中...');
            updateTemplates();
        }

        function updateTemplates() {
            const templateGrid = document.getElementById('templateGrid');
            if (!templateGrid) return;
            
            // 检查所有配置项是否已填写
            const isConfigComplete = checkConfigComplete();
            
            // 模拟模板数据
            const templates = [
                { id: 1, title: '时尚女装模板', price: '¥299', image: 'https://youke1.picui.cn/s1/2025/08/06/6892f6699c4dc.png' },
                { id: 2, title: '运动休闲模板', price: '¥129', image: 'https://youke1.picui.cn/s1/2025/08/06/6892f66a1e370.png' },
                { id: 3, title: '商务正装模板', price: '¥199', image: 'https://youke1.picui.cn/s1/2025/08/06/6892f6b278b7e.png' },
                { id: 4, title: '甜美可爱模板', price: '¥159', image: 'https://youke1.picui.cn/s1/2025/08/06/6892f6b2665cd.png' },
                { id: 5, title: '简约现代模板', price: '¥89', image: 'https://youke1.picui.cn/s1/2025/08/06/6892f6699c4dc.png' },
                { id: 6, title: '复古文艺模板', price: '¥179', image: 'https://youke1.picui.cn/s1/2025/08/06/6892f66a1e370.png' },
                { id: 7, title: '潮流街头模板', price: '¥239', image: 'https://youke1.picui.cn/s1/2025/08/06/6892f6b278b7e.png' },
                { id: 8, title: '优雅淑女模板', price: '¥189', image: 'https://youke1.picui.cn/s1/2025/08/06/6892f6b2665cd.png' }
            ];
            
            templateGrid.innerHTML = templates.map(template => `
                <div class="template-item" onclick="selectTemplate(this, ${template.id})">
                    <img src="${template.image}" alt="${template.title}">
                    ${isConfigComplete ? '<div class="template-checkbox"></div>' : ''}
                    <div class="template-info">
                        <div class="template-title">${template.title}</div>
                        <div class="template-price">${template.price}</div>
                    </div>
                    ${isConfigComplete ? '<div class="template-config-btn" onclick="event.stopPropagation(); showConfigModal();"><span class="config-label">配置</span></div>' : ''}
                </div>
            `).join('');
        }

        function checkConfigComplete() {
            // 检查商品ID
            const productIdInput = document.querySelector('input[placeholder="请输入一个商品ID"]');
            if (!productIdInput || !productIdInput.value.trim()) return false;
            
            // 检查尺寸
            const imageSizeSelect = document.getElementById('imageSize');
            if (!imageSizeSelect || !imageSizeSelect.value) return false;
            
            // 检查数量
            const quantityInput = document.querySelector('input[type="number"][value="1"]');
            if (!quantityInput || !quantityInput.value || quantityInput.value < 1) return false;
            
            // 检查价格
            const priceInputs = document.querySelectorAll('input[type="number"][step="0.01"]');
            for (let input of priceInputs) {
                if (!input.value || parseFloat(input.value) <= 0) return false;
            }
            
            // 检查投放渠道
            const channelSelect = document.getElementById('channel');
            if (!channelSelect || !channelSelect.value) return false;
            
            // 检查应用场景
            const sceneSelect = document.getElementById('scene');
            if (!sceneSelect || !sceneSelect.value) return false;
            
            return true;
        }

        function selectTemplate(element, templateId) {
            // 检查配置是否完整
            if (!checkConfigComplete()) {
                showToast('请先完成所有配置项');
                return;
            }
            
            // 移除其他模板的选中状态
            const templateGrid = element.closest('.template-grid');
            if (templateGrid) {
                templateGrid.querySelectorAll('.template-item').forEach(item => {
                    item.classList.remove('selected');
                    const checkbox = item.querySelector('.template-checkbox');
                    if (checkbox) checkbox.innerHTML = '';
                });
            }
            
            // 为当前模板添加选中状态
            element.classList.add('selected');
            const checkbox = element.querySelector('.template-checkbox');
            if (checkbox) checkbox.innerHTML = '✓';
            
            // 更新开始生产按钮状态
            updateProductionButton();
        }

        function updateProductionButton() {
            const selectedTemplate = document.querySelector('.template-item.selected');
            const productionBtn = document.getElementById('startProductionBtn');
            if (productionBtn) {
                if (selectedTemplate && checkConfigComplete()) {
                    productionBtn.disabled = false;
                } else {
                    productionBtn.disabled = true;
                }
            }
        }

        function startProduction() {
            // 根据当前模块决定生产逻辑
            if (currentModule === 'expand') {
                startExpandProduction();
            } else if (currentModule === 'imageCreation') {
                startImageCreationProduction();
            } else if (currentModule === 'changeBg') {
                startChangeBgProduction();
            } else if (currentModule === 'bgFission') {
                startBgFissionProduction();
            } else {
                showToast('开始生产...');
                setTimeout(() => {
                    showToast('生产完成！');
                }, 2000);
            }
        }

        function startExpandProduction() {
            showToast('开始扩图生产...');
            
            // 模拟扩图生产过程
            setTimeout(() => {
                showExpandResultPage();
            }, 2000);
        }

        function startImageCreationProduction() {
            showToast('开始生产...');
            
            // 模拟生产过程
            setTimeout(() => {
                showResultPage();
            }, 2000);
        }

        function startChangeBgProduction() {
            showToast('开始换背景生产...');
            
            // 模拟换背景生产过程
            setTimeout(() => {
                showChangeBgResultPage();
            }, 2000);
        }

        function startBgFissionProduction() {
            showToast('开始背景裂变生产...');
            
            // 模拟背景裂变生产过程
            setTimeout(() => {
                showBgFissionResultPage();
            }, 2000);
        }

        function showExpandResultPage() {
            // 更新中间面板显示扩图结果
            const middlePanel = document.querySelector('.middle-panel');
            const rightPanel = document.querySelector('.right-panel');
            
            if (middlePanel) {
                middlePanel.innerHTML = `
                    <div class="panel">
                        <div class="panel-header">
                            <div class="panel-title">生成记录</div>
                            <button class="btn btn-primary" onclick="downloadAll()">全部下载</button>
                        </div>
                        <div class="panel-content">
                            <div class="generation-section">
                                <div class="product-info">
                                    <div class="product-details">
                                        <span class="product-id">商品Id: 6920234553255788354</span>
                                        <span class="generation-time">2025-08-04 18:39:44</span>
                                    </div>
                                    <button class="btn btn-primary" onclick="regenerateExpand()">重新生成</button>
                                </div>
                                <div class="image-grid">
                                    <div class="image-item">
                                        <div class="image-id">5978</div>
                                        <img src="https://youke1.picui.cn/s1/2025/08/01/688cb7e3003d7.jpg" alt="扩图结果1">
                                        <div class="image-actions">
                                            <button class="btn btn-secondary" onclick="passResult('5978')">通过</button>
                                            <button class="btn btn-primary" onclick="downloadResult('5978')">下载</button>
                                            <button class="btn btn-feedback" onclick="feedbackResult('5978')">👎</button>
                                        </div>
                                    </div>
                                    <div class="image-item">
                                        <div class="image-id">5977</div>
                                        <img src="https://youke1.picui.cn/s1/2025/08/01/688cb7e3003d7.jpg" alt="扩图结果2">
                                        <div class="image-actions">
                                            <button class="btn btn-secondary" onclick="passResult('5977')">通过</button>
                                            <button class="btn btn-primary" onclick="downloadResult('5977')">下载</button>
                                            <button class="btn btn-feedback" onclick="feedbackResult('5977')">👎</button>
                                        </div>
                                    </div>
                                    <div class="image-item">
                                        <div class="image-id">5976</div>
                                        <img src="https://youke1.picui.cn/s1/2025/08/01/688cb7e3003d7.jpg" alt="扩图结果3">
                                        <div class="image-actions">
                                            <button class="btn btn-secondary" onclick="passResult('5976')">通过</button>
                                            <button class="btn btn-primary" onclick="downloadResult('5976')">下载</button>
                                            <button class="btn btn-feedback" onclick="feedbackResult('5976')">👎</button>
                                        </div>
                                    </div>
                                    <div class="image-item">
                                        <div class="image-id">5975</div>
                                        <img src="https://youke1.picui.cn/s1/2025/08/01/688cb7e3003d7.jpg" alt="扩图结果4">
                                        <div class="image-actions">
                                            <button class="btn btn-secondary" onclick="passResult('5975')">通过</button>
                                            <button class="btn btn-primary" onclick="downloadResult('5975')">下载</button>
                                            <button class="btn btn-feedback" onclick="feedbackResult('5975')">👎</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="generation-section">
                                <div class="product-info">
                                    <div class="product-details">
                                        <span class="product-id">商品Id: 6921461213816069463</span>
                                        <span class="generation-time">2025-08-04 18:35:22</span>
                                    </div>
                                    <button class="btn btn-primary" onclick="regenerateExpand()">重新生成</button>
                                </div>
                                <div class="image-grid">
                                    <div class="image-item">
                                        <div class="image-id">5982</div>
                                        <img src="https://youke1.picui.cn/s1/2025/08/01/688cb7e3003d7.jpg" alt="扩图结果5">
                                        <div class="image-actions">
                                            <button class="btn btn-secondary" onclick="passResult('5982')">通过</button>
                                            <button class="btn btn-primary" onclick="downloadResult('5982')">下载</button>
                                            <button class="btn btn-feedback" onclick="feedbackResult('5982')">👎</button>
                                        </div>
                                    </div>
                                    <div class="image-item">
                                        <div class="image-id">5981</div>
                                        <img src="https://youke1.picui.cn/s1/2025/08/01/688cb7e3003d7.jpg" alt="扩图结果6">
                                        <div class="image-actions">
                                            <button class="btn btn-secondary" onclick="passResult('5981')">通过</button>
                                            <button class="btn btn-primary" onclick="downloadResult('5981')">下载</button>
                                            <button class="btn btn-feedback" onclick="feedbackResult('5981')">👎</button>
                                        </div>
                                    </div>
                                    <div class="image-item">
                                        <div class="image-id">5980</div>
                                        <img src="https://youke1.picui.cn/s1/2025/08/01/688cb7e3003d7.jpg" alt="扩图结果7">
                                        <div class="image-actions">
                                            <button class="btn btn-secondary" onclick="passResult('5980')">通过</button>
                                            <button class="btn btn-primary" onclick="downloadResult('5980')">下载</button>
                                            <button class="btn btn-feedback" onclick="feedbackResult('5980')">👎</button>
                                        </div>
                                    </div>
                                    <div class="image-item">
                                        <div class="image-id">5979</div>
                                        <img src="https://youke1.picui.cn/s1/2025/08/01/688cb7e3003d7.jpg" alt="扩图结果8">
                                        <div class="image-actions">
                                            <button class="btn btn-secondary" onclick="passResult('5979')">通过</button>
                                            <button class="btn btn-primary" onclick="downloadResult('5979')">下载</button>
                                            <button class="btn btn-feedback" onclick="feedbackResult('5979')">👎</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }
            
            if (rightPanel) {
                rightPanel.innerHTML = `
                    <div class="panel">
                        <div class="panel-header">
                            <h3>扩图配置</h3>
                        </div>
                        <div class="panel-content">
                            <div class="config-item">
                                <label>扩图类型:</label>
                                <span>场景扩图</span>
                            </div>
                            <div class="config-item">
                                <label>扩图方式:</label>
                                <span>先切后扩</span>
                            </div>
                            <div class="config-item">
                                <label>扩图比例:</label>
                                <span>9:16</span>
                            </div>
                            <div class="config-item">
                                <label>扩图方向:</label>
                                <span>向下扩图</span>
                            </div>
                        </div>
                    </div>
                `;
            }
            
            showToast('扩图生产完成！');
        }

        function showChangeBgResultPage() {
            // 更新中间面板显示换背景结果
            const middlePanel = document.querySelector('.middle-panel');
            const rightPanel = document.querySelector('.right-panel');
            
            if (middlePanel) {
                middlePanel.innerHTML = `
                    <div class="panel">
                        <div class="panel-header">
                            <div class="panel-title">生成记录</div>
                            <button class="btn btn-primary" onclick="downloadAll()">全部下载</button>
                        </div>
                        <div class="panel-content">
                            <div class="generation-section">
                                <div class="product-info">
                                    <div class="product-details">
                                        <span class="product-id">商品Id: 6921461213816069463</span>
                                        <span class="generation-time">2025-08-04 18:42:15</span>
                                    </div>
                                    <button class="btn btn-primary" onclick="regenerateChangeBg()">重新生成</button>
                                </div>
                                <div class="image-grid">
                                    <div class="image-item">
                                        <div class="image-id">5986</div>
                                        <img src="https://youke1.picui.cn/s1/2025/08/01/688cb7e3003d7.jpg" alt="换背景结果1">
                                        <div class="image-actions">
                                            <button class="btn btn-secondary" onclick="passResult('5986')">通过</button>
                                            <button class="btn btn-primary" onclick="downloadResult('5986')">下载</button>
                                            <button class="btn btn-feedback" onclick="feedbackResult('5986')">👎</button>
                                        </div>
                                    </div>
                                    <div class="image-item">
                                        <div class="image-id">5985</div>
                                        <img src="https://youke1.picui.cn/s1/2025/08/01/688cb7e3003d7.jpg" alt="换背景结果2">
                                        <div class="image-actions">
                                            <button class="btn btn-secondary" onclick="passResult('5985')">通过</button>
                                            <button class="btn btn-primary" onclick="downloadResult('5985')">下载</button>
                                            <button class="btn btn-feedback" onclick="feedbackResult('5985')">👎</button>
                                        </div>
                                    </div>
                                    <div class="image-item">
                                        <div class="image-id">5984</div>
                                        <img src="https://youke1.picui.cn/s1/2025/08/01/688cb7e3003d7.jpg" alt="换背景结果3">
                                        <div class="image-actions">
                                            <button class="btn btn-secondary" onclick="passResult('5984')">通过</button>
                                            <button class="btn btn-primary" onclick="downloadResult('5984')">下载</button>
                                            <button class="btn btn-feedback" onclick="feedbackResult('5984')">👎</button>
                                        </div>
                                    </div>
                                    <div class="image-item">
                                        <div class="image-id">5983</div>
                                        <img src="https://youke1.picui.cn/s1/2025/08/01/688cb7e3003d7.jpg" alt="换背景结果4">
                                        <div class="image-actions">
                                            <button class="btn btn-secondary" onclick="passResult('5983')">通过</button>
                                            <button class="btn btn-primary" onclick="downloadResult('5983')">下载</button>
                                            <button class="btn btn-feedback" onclick="feedbackResult('5983')">👎</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }
            
            if (rightPanel) {
                rightPanel.innerHTML = `
                    <div class="panel">
                        <div class="panel-header">
                            <h3>换背景配置</h3>
                        </div>
                        <div class="panel-content">
                            <div class="config-item">
                                <label>背景图比例:</label>
                                <span>竖图9:16</span>
                            </div>
                            <div class="config-item">
                                <label>处理方式:</label>
                                <span>智能换背景</span>
                            </div>
                        </div>
                    </div>
                `;
            }
            
            showToast('换背景生产完成！');
        }

        function showBgFissionResultPage() {
            // 更新中间面板显示背景裂变结果
            const middlePanel = document.querySelector('.middle-panel');
            const rightPanel = document.querySelector('.right-panel');
            
            if (middlePanel) {
                middlePanel.innerHTML = `
                    <div class="panel">
                        <div class="panel-header">
                            <div class="panel-title">生成记录</div>
                            <button class="btn btn-primary" onclick="downloadAll()">全部下载</button>
                        </div>
                        <div class="panel-content">
                            <div class="generation-section">
                                <div class="product-info">
                                    <div class="product-details">
                                        <span class="product-id">商品Id: 6920852030913365521</span>
                                        <span class="generation-time">2025-08-04 18:45:33</span>
                                    </div>
                                    <button class="btn btn-primary" onclick="regenerateBgFission()">重新生成</button>
                                </div>
                                <div class="image-grid">
                                    <div class="image-item">
                                        <div class="image-id">5990</div>
                                        <img src="https://youke1.picui.cn/s1/2025/08/01/688cb7e3003d7.jpg" alt="背景裂变结果1">
                                        <div class="image-actions">
                                            <button class="btn btn-secondary" onclick="passResult('5990')">通过</button>
                                            <button class="btn btn-primary" onclick="downloadResult('5990')">下载</button>
                                            <button class="btn btn-feedback" onclick="feedbackResult('5990')">👎</button>
                                        </div>
                                    </div>
                                    <div class="image-item">
                                        <div class="image-id">5989</div>
                                        <img src="https://youke1.picui.cn/s1/2025/08/01/688cb7e3003d7.jpg" alt="背景裂变结果2">
                                        <div class="image-actions">
                                            <button class="btn btn-secondary" onclick="passResult('5989')">通过</button>
                                            <button class="btn btn-primary" onclick="downloadResult('5989')">下载</button>
                                            <button class="btn btn-feedback" onclick="feedbackResult('5989')">👎</button>
                                        </div>
                                    </div>
                                    <div class="image-item">
                                        <div class="image-id">5988</div>
                                        <img src="https://youke1.picui.cn/s1/2025/08/01/688cb7e3003d7.jpg" alt="背景裂变结果3">
                                        <div class="image-actions">
                                            <button class="btn btn-secondary" onclick="passResult('5988')">通过</button>
                                            <button class="btn btn-primary" onclick="downloadResult('5988')">下载</button>
                                            <button class="btn btn-feedback" onclick="feedbackResult('5988')">👎</button>
                                        </div>
                                    </div>
                                    <div class="image-item">
                                        <div class="image-id">5987</div>
                                        <img src="https://youke1.picui.cn/s1/2025/08/01/688cb7e3003d7.jpg" alt="背景裂变结果4">
                                        <div class="image-actions">
                                            <button class="btn btn-secondary" onclick="passResult('5987')">通过</button>
                                            <button class="btn btn-primary" onclick="downloadResult('5987')">下载</button>
                                            <button class="btn btn-feedback" onclick="feedbackResult('5987')">👎</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }
            
            if (rightPanel) {
                rightPanel.innerHTML = `
                    <div class="panel">
                        <div class="panel-header">
                            <h3>背景裂变配置</h3>
                        </div>
                        <div class="panel-content">
                            <div class="config-item">
                                <label>裂变类型:</label>
                                <span>智能裂变</span>
                            </div>
                            <div class="config-item">
                                <label>裂变数量:</label>
                                <span>3张</span>
                            </div>
                        </div>
                    </div>
                `;
            }
            
            showToast('背景裂变生产完成！');
        }

        function showResultPage() {
            // 更新左侧面板为编辑功能
            const leftPanel = document.querySelector('.left-panel');
            const middlePanel = document.querySelector('.middle-panel');
            const rightPanel = document.querySelector('.right-panel');
            
            // 确保当前模块状态正确
            currentModule = 'imageCreation';
            
            // 确保导航元素仍然可点击
            const navLinks = document.querySelectorAll('.nav-link');
            navLinks.forEach(link => {
                link.style.pointerEvents = 'auto';
                link.style.cursor = 'pointer';
            });
            
            // 更新左侧面板为编辑功能
            if (leftPanel) {
                leftPanel.innerHTML = `
                    <div class="panel">
                        <div class="panel-header">
                            <h3>编辑</h3>
                        </div>
                        <div class="panel-content">
                            <div class="edit-tabs">
                                <div class="edit-tab active" onclick="switchEditTab(this, 'template')">模板</div>
                                <div class="edit-tab" onclick="switchEditTab(this, 'background')">背景图</div>
                                <div class="edit-tab" onclick="switchEditTab(this, 'price')">价格标</div>
                            </div>
                            
                            <div class="edit-filters">
                                <div class="filter-group">
                                    <select class="form-select" onchange="filterEditContent()">
                                        <option>日常</option>
                                        <option>节日</option>
                                        <option>活动</option>
                                    </select>
                                    <select class="form-select" onchange="filterEditContent()">
                                        <option>图框</option>
                                        <option>无框</option>
                                        <option>圆角</option>
                                    </select>
                                    <select class="form-select" onchange="filterEditContent()">
                                        <option>图数</option>
                                        <option>单图</option>
                                        <option>多图</option>
                                    </select>
                                </div>
                                <div class="search-group">
                                    <input type="text" class="form-input" placeholder="关键字" onkeyup="searchEditContent(this.value)">
                                    <button class="btn btn-primary" onclick="searchEditContent()">搜索</button>
                                    <button class="btn btn-secondary" onclick="uploadEditContent()">上传</button>
                                    <button class="btn btn-secondary" onclick="resetEditContent()">重置</button>
                                </div>
                            </div>
                            
                            <div class="edit-grid" id="editGrid">
                                <!-- 编辑网格内容将根据选中的tab动态显示 -->
                            </div>
                        </div>
                    </div>
                `;
                
                // 初始化编辑内容
                setTimeout(() => {
                    switchEditTab(document.querySelector('.edit-tab.active'), 'template');
                    
                    // 确保编辑项目在初始状态下是禁用的
                    const editItems = leftPanel.querySelectorAll('.edit-item');
                    editItems.forEach(item => {
                        item.style.pointerEvents = 'none';
                        item.style.opacity = '0.5';
                        item.classList.add('disabled');
                    });
                    
                    // 确保导航状态正确
                    updateNavigation('imageCreation');
                    
                    // 确保导航元素仍然可点击
                    const navLinks = document.querySelectorAll('.nav-link');
                    navLinks.forEach(link => {
                        link.style.pointerEvents = 'auto';
                        link.style.cursor = 'pointer';
                        // 重新绑定点击事件
                        if (link.onclick) {
                            const onclickAttr = link.getAttribute('onclick');
                            if (onclickAttr) {
                                link.onclick = null;
                                link.setAttribute('onclick', onclickAttr);
                            }
                        }
                    });
                }, 100);
            }
            
            // 更新中间面板
            if (middlePanel) {
                middlePanel.innerHTML = `
                    <div class="panel">
                        <div class="panel-header">
                            <div class="result-controls">
                                <button class="btn btn-primary" onclick="editImage()">编辑</button>
                                <div class="result-actions">
                                    <button class="btn btn-primary" onclick="downloadAll()">全部下载</button>
                                    <button class="btn btn-primary" onclick="downloadImage()">下载</button>
                                </div>
                            </div>
                        </div>
                        <div class="panel-content">
                            <div class="main-preview">
                                <div class="preview-container">
                                    <div class="preview-paper">
                                        <div class="paper-header">
                                            <div class="brand-title">唯品会 × UR</div>
                                            <div class="brand-subtitle">上唯品会买URBAN REVIVO</div>
                                        </div>
                                        <div class="product-display">
                                            <img src="https://youke1.picui.cn/s1/2025/08/06/6892f6ef774d3.png" alt="商品图片" class="product-image">
                                            <div class="price-tag">
                                                <div class="discount">4.7折</div>
                                                <div class="current-price">¥142</div>
                                                <div class="original-price">¥299</div>
                                            </div>
                                        </div>
                                        <div class="disclaimer">
                                            商品价格及库存变动具体以唯品会APP实际情况为准
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="generated-results">
                                <div class="result-item">
                                    <div class="result-id">6267</div>
                                    <div class="result-image">
                                        <img src="https://youke1.picui.cn/s1/2025/08/06/6892f6ef774d3.png" alt="生成结果1">
                                    </div>
                                    <div class="result-actions">
                                        <button class="btn btn-secondary" onclick="passResult('6267')">通过</button>
                                        <button class="btn btn-primary" onclick="downloadResult('6267')">下载</button>
                                        <button class="btn btn-feedback" onclick="feedbackResult('6267')">👎</button>
                                    </div>
                                </div>
                                <div class="result-item">
                                    <div class="result-id">6266</div>
                                    <div class="result-image">
                                        <img src="https://youke1.picui.cn/s1/2025/08/06/6892f6ef774d3.png" alt="生成结果2">
                                    </div>
                                    <div class="result-actions">
                                        <button class="btn btn-secondary" onclick="passResult('6266')">通过</button>
                                        <button class="btn btn-primary" onclick="downloadResult('6266')">下载</button>
                                        <button class="btn btn-feedback" onclick="feedbackResult('6266')">👎</button>
                                    </div>
                                </div>
                                <div class="result-item failed">
                                    <div class="result-id">6265</div>
                                    <div class="result-image">
                                        <div class="failed-placeholder">
                                            <span class="material-icons">help</span>
                                            <span>生成失败</span>
                                        </div>
                                    </div>
                                    <div class="result-actions">
                                        <button class="btn btn-secondary" onclick="passResult('6265')">通过</button>
                                        <button class="btn btn-primary" onclick="downloadResult('6265')">下载</button>
                                        <button class="btn btn-feedback" onclick="feedbackResult('6265')">👎</button>
                                    </div>
                                </div>
                                <div class="result-item">
                                    <div class="result-id">6260</div>
                                    <div class="result-image">
                                        <img src="https://youke1.picui.cn/s1/2025/08/06/6892f6ef774d3.png" alt="生成结果4">
                                    </div>
                                    <div class="result-actions">
                                        <button class="btn btn-secondary" onclick="passResult('6260')">通过</button>
                                        <button class="btn btn-primary" onclick="downloadResult('6260')">下载</button>
                                        <button class="btn btn-feedback" onclick="feedbackResult('6260')">👎</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }
            
            // 更新右侧面板
            if (rightPanel) {
                rightPanel.innerHTML = `
                    <div class="panel">
                        <div class="panel-header">
                            <button class="btn btn-secondary" onclick="goBackToCreation()">返回</button>
                        </div>
                        <div class="panel-content">
                            <div class="product-section">
                                <div class="section-header">
                                    <h4>商品图 (已选1个)</h4>
                                    <button class="btn btn-link" onclick="viewAllProducts()">查看全部</button>
                                </div>
                                <div class="product-tabs">
                                    <div class="product-tab active" onclick="switchProductTab(this, 'main')">商品主图</div>
                                    <div class="product-tab" onclick="switchProductTab(this, 'text')">商品含文字</div>
                                    <div class="product-tab" onclick="switchProductTab(this, 'background')">商品带背景</div>
                                    <div class="product-tab" onclick="switchProductTab(this, 'cutout')">商品抠图</div>
                                </div>
                                <div class="product-info">
                                    <div class="product-id">商品1:6920852030913365521</div>
                                    <div class="product-images">
                                        <div class="product-image selected" onclick="selectProductImage(this)">
                                            <img src="https://youke1.picui.cn/s1/2025/08/06/6892f6ef774d3.png" alt="商品图片">
                                            <div class="image-check">✓</div>
                                        </div>
                                        <div class="product-image" onclick="selectProductImage(this)">
                                            <img src="https://youke1.picui.cn/s1/2025/08/06/6892f6ef774d3.png" alt="商品图片">
                                        </div>
                                        <div class="product-image" onclick="selectProductImage(this)">
                                            <img src="https://youke1.picui.cn/s1/2025/08/06/6892f6ef774d3.png" alt="商品图片">
                                        </div>
                                    </div>
                                    <div class="progress-bar">
                                        <div class="progress-fill" style="width: 60%;"></div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="text-section">
                                <div class="section-header">
                                    <h4>文本</h4>
                                    <button class="btn btn-link" onclick="changeText()">换一换</button>
                                </div>
                                <div class="text-content">
                                    <p>暂无数据</p>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }
        }

        function regenerateExpand() {
            showToast('重新扩图中...');
            setTimeout(() => {
                showToast('重新扩图完成！');
            }, 1500);
        }

        function regenerateChangeBg() {
            showToast('重新换背景中...');
            setTimeout(() => {
                showToast('重新换背景完成！');
            }, 1500);
        }

        function regenerateBgFission() {
            showToast('重新背景裂变中...');
            setTimeout(() => {
                showToast('重新背景裂变完成！');
            }, 1500);
        }

        // 通过结果
        function passResult(resultId) {
            showToast(`结果 ${resultId} 已通过！`);
        }

        // 下载结果
        function downloadResult(resultId) {
            showToast(`正在下载结果 ${resultId}...`);
            setTimeout(() => {
                showToast(`结果 ${resultId} 下载完成！`);
            }, 1000);
        }

        // 反馈结果
        function feedbackResult(resultId) {
            showToast(`已提交结果 ${resultId} 的反馈`);
            // 这里可以打开反馈弹窗
            setTimeout(() => {
                showFeedbackModal();
            }, 500);
        }

        // 查看操作快照
        function viewOperationSnapshot(snapshotName) {
            showToast(`正在查看 ${snapshotName}...`);
            // 这里可以打开操作快照弹窗
            setTimeout(() => {
                showToast(`${snapshotName} 已打开`);
            }, 1000);
        }

        // 编辑反馈（支持编辑填写）
        function editFeedback(button) {
            const row = button.closest('tr');
            const feedbackContent = row.querySelector('.feedback-content');
            const feedbackStatus = row.querySelector('.feedback-status');
            
            // 创建编辑输入框
            const textarea = document.createElement('textarea');
            textarea.className = 'feedback-edit-textarea';
            textarea.value = feedbackContent.textContent;
            textarea.style.width = '100%';
            textarea.style.height = '60px';
            textarea.style.padding = '8px';
            textarea.style.border = '1px solid #d9d9d9';
            textarea.style.borderRadius = '4px';
            textarea.style.fontSize = '14px';
            
            // 替换内容为输入框
            feedbackContent.innerHTML = '';
            feedbackContent.appendChild(textarea);
            textarea.focus();
            
            // 修改按钮为保存
            button.textContent = '保存';
            button.onclick = () => saveFeedback(button, textarea, feedbackStatus);
        }

        // 保存反馈
        function saveFeedback(button, textarea, feedbackStatus) {
            const newContent = textarea.value;
            const row = button.closest('tr');
            const feedbackContent = row.querySelector('.feedback-content');
            
            // 恢复显示内容
            feedbackContent.textContent = newContent;
            
            // 恢复按钮
            button.textContent = '编辑';
            button.onclick = () => editFeedback(button);
            
            // 更新状态
            feedbackStatus.textContent = '已更新';
            feedbackStatus.style.color = '#52c41a';
            
            showToast('反馈已保存');
        }

        function regenerateImage() {
            showToast('重新生成中...');
            setTimeout(() => {
                // 保持在当前结果页面，不跳转到其他模块
                showToast('重新生成完成！');
            }, 1500);
        }

        // 编辑图片功能
        function editImage() {
            // 更新中间面板的按钮
            const resultControls = document.querySelector('.result-controls');
            if (resultControls) {
                resultControls.innerHTML = `
                    <div class="edit-actions">
                        <button class="btn btn-primary" onclick="regenerateWithNewSelection()">重新生成</button>
                        <button class="btn btn-secondary" onclick="cancelEdit()">取消</button>
                    </div>
                `;
            }
            
            // 显示左侧编辑面板并启用选择功能
            const leftPanel = document.querySelector('.left-panel');
            if (leftPanel) {
                leftPanel.style.display = 'flex';
                
                // 启用所有编辑项目的选择功能
                const editItems = leftPanel.querySelectorAll('.edit-item');
                editItems.forEach(item => {
                    item.style.pointerEvents = 'auto';
                    item.style.opacity = '1';
                });
                
                // 移除禁用状态的样式
                editItems.forEach(item => {
                    item.classList.remove('disabled');
                });
            }
            
            showToast('进入编辑模式，请选择新的模板、背景图或价格标');
        }

        // 重新生成功能
        function regenerateWithNewSelection() {
            showToast('正在重新生成...');
            setTimeout(() => {
                showToast('重新生成完成！');
                cancelEdit();
            }, 2000);
        }

        // 取消编辑
        function cancelEdit() {
            // 恢复编辑按钮
            const resultControls = document.querySelector('.result-controls');
            if (resultControls) {
                resultControls.innerHTML = `
                    <button class="btn btn-primary" onclick="editImage()">编辑</button>
                    <div class="result-actions">
                        <button class="btn btn-primary" onclick="downloadAll()">全部下载</button>
                        <button class="btn btn-primary" onclick="downloadImage()">下载</button>
                    </div>
                `;
            }
            
            // 重新禁用所有编辑项目
            const leftPanel = document.querySelector('.left-panel');
            if (leftPanel) {
                const editItems = leftPanel.querySelectorAll('.edit-item');
                editItems.forEach(item => {
                    item.style.pointerEvents = 'none';
                    item.style.opacity = '0.5';
                    item.classList.add('disabled');
                });
            }
            
            showToast('已取消编辑');
        }

        // 关闭编辑模式
        function closeEdit() {
            // 恢复右侧面板
            const rightPanel = document.querySelector('.right-panel');
            if (rightPanel) {
                rightPanel.style.display = 'block';
            }
            
            // 恢复结果页面
            showResultPage();
        }

        function downloadImage() {
            showToast('开始下载...');
        }

        function switchEditTab(element, tabType) {
            // 移除所有active类
            const tabs = element.parentElement.querySelectorAll('.edit-tab');
            tabs.forEach(tab => tab.classList.remove('active'));
            
            // 为当前tab添加active类
            element.classList.add('active');
            
            // 更新编辑内容
            updateEditContent(tabType);
        }

        function updateEditContent(tabType) {
            const editGrid = document.getElementById('editGrid');
            if (!editGrid) return;
            
            const contentMap = {
                template: generateTemplateGrid(),
                background: generateBackgroundGrid(),
                price: generatePriceGrid()
            };
            
            editGrid.innerHTML = contentMap[tabType] || '<p>选择编辑选项</p>';
        }

        // 生成模板网格
        function generateTemplateGrid() {
            const chipTemplates = [
                { id: 1, title: '薯片包装模板1', price: '¥9.9', image: 'https://youke1.picui.cn/s1/2025/08/06/6892f6699c4dc.png', type: 'template' },
                { id: 2, title: '薯片包装模板2', price: '¥12.9', image: 'https://youke1.picui.cn/s1/2025/08/06/6892f66a1e370.png', type: 'template' },
                { id: 3, title: '薯片包装模板3', price: '¥8.9', image: 'https://youke1.picui.cn/s1/2025/08/06/6892f6b278b7e.png', type: 'template' },
                { id: 4, title: '薯片包装模板4', price: '¥15.9', image: 'https://youke1.picui.cn/s1/2025/08/06/6892f6b2665cd.png', type: 'template' },
                { id: 5, title: '薯片包装模板5', price: '¥11.9', image: 'https://youke1.picui.cn/s1/2025/08/06/6892f6699c4dc.png', type: 'template' },
                { id: 6, title: '薯片包装模板6', price: '¥13.9', image: 'https://youke1.picui.cn/s1/2025/08/06/6892f66a1e370.png', type: 'template' }
            ];
            
            return `
                <div class="edit-grid-content">
                    ${chipTemplates.map(template => `
                                        <div class="edit-item disabled" onclick="selectEditItem(this)" data-id="${template.id}" data-type="${template.type}">
                    <img src="${template.image}" alt="${template.title}">
                    <div class="edit-item-info">
                        <div class="edit-item-title">${template.title}</div>
                        <div class="edit-item-price">${template.price}</div>
                    </div>
                    <div class="edit-checkbox"></div>
                </div>
                    `).join('')}
                </div>
            `;
        }

                // 生成背景图网格
        function generateBackgroundGrid() {
            const chipBackgrounds = [
                { id: 1, title: '薯片背景1', image: 'https://youke1.picui.cn/s1/2025/08/04/68905926417c1.jpeg', type: 'background' },
                { id: 2, title: '薯片背景2', image: 'https://youke1.picui.cn/s1/2025/08/06/689307a474930.jpeg', type: 'background' },
                { id: 3, title: '薯片背景3', image: 'https://youke1.picui.cn/s1/2025/08/04/68905925c8587.jpeg', type: 'background' },
                { id: 4, title: '薯片背景4', image: 'https://youke1.picui.cn/s1/2025/08/04/68905926', type: 'background' },
                { id: 5, title: '薯片背景5', image: 'https://youke1.picui.cn/s1/2025/08/04/68905926417c1.jpeg', type: 'background' },
                { id: 6, title: '薯片背景6', image: 'https://youke1.picui.cn/s1/2025/08/06/689307a474930.jpeg', type: 'background' }
            ];
            
            // 检查是否在配置弹窗中
            const isConfigModal = document.getElementById('configGrid');
            const itemClass = isConfigModal ? 'config-item' : 'edit-item disabled';
            const onclickFunc = isConfigModal ? 'selectConfigItem(this)' : 'selectEditItem(this)';
            
            return `
                <div class="${isConfigModal ? 'config-grid-content' : 'edit-grid-content'}">
                    ${chipBackgrounds.map(bg => `
                        <div class="${itemClass}" onclick="${onclickFunc}" data-id="${bg.id}" data-type="${bg.type}">
                            <img src="${bg.image}" alt="${bg.title}">
                            <div class="${isConfigModal ? 'config-item-info' : 'edit-item-info'}">
                                <div class="${isConfigModal ? 'config-item-title' : 'edit-item-title'}">${bg.title}</div>
                            </div>
                            <div class="${isConfigModal ? 'config-checkbox' : 'edit-checkbox'}"></div>
                        </div>
                    `).join('')}
                </div>
            `;
        }

                // 生成价格标网格
        function generatePriceGrid() {
            const chipPriceTags = [
                { id: 1, title: '薯片价格标签1', image: 'https://youke1.picui.cn/s1/2025/08/06/689307a3f1487.png', type: 'price' },
                { id: 2, title: '薯片价格标签2', image: 'https://youke1.picui.cn/s1/2025/08/06/689307a7be228.png', type: 'price' },
                { id: 3, title: '薯片价格标签3', image: 'https://youke1.picui.cn/s1/2025/08/06/689307a7d8c56.png', type: 'price' },
                { id: 4, title: '薯片价格标签4', image: 'https://youke1.picui.cn/s1/2025/08/06/689307a3f1487.png', type: 'price' },
                { id: 5, title: '薯片价格标签5', image: 'https://youke1.picui.cn/s1/2025/08/06/689307a7be228.png', type: 'price' },
                { id: 6, title: '薯片价格标签6', image: 'https://youke1.picui.cn/s1/2025/08/06/689307a7d8c56.png', type: 'price' }
            ];
            
            // 检查是否在配置弹窗中
            const isConfigModal = document.getElementById('configGrid');
            const itemClass = isConfigModal ? 'config-item' : 'edit-item disabled';
            const onclickFunc = isConfigModal ? 'selectConfigItem(this)' : 'selectEditItem(this)';
            
            return `
                <div class="${isConfigModal ? 'config-grid-content' : 'edit-grid-content'}">
                    ${chipPriceTags.map(tag => `
                        <div class="${itemClass}" onclick="${onclickFunc}" data-id="${tag.id}" data-type="${tag.type}">
                            <img src="${tag.image}" alt="${tag.title}">
                            <div class="${isConfigModal ? 'config-item-info' : 'edit-item-info'}">
                                <div class="${isConfigModal ? 'config-item-title' : 'edit-item-title'}">${tag.title}</div>
                            </div>
                            <div class="${isConfigModal ? 'config-checkbox' : 'edit-checkbox'}"></div>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        // 选择编辑项目
        function selectEditItem(element) {
            // 检查是否处于禁用状态
            if (element.classList.contains('disabled')) {
                return; // 禁用状态下不响应点击
            }
            
            // 移除所有选中状态
            const items = element.parentElement.querySelectorAll('.edit-item');
            items.forEach(item => item.classList.remove('selected'));
            
            // 为当前项目添加选中状态
            element.classList.add('selected');
            
            showToast('已选择新的样式');
        }

        // 选择缩略图
        function selectThumbnail(element) {
            // 移除所有选中状态
            const thumbnails = document.querySelectorAll('.thumbnail-item');
            thumbnails.forEach(item => item.classList.remove('selected'));
            
            // 为当前缩略图添加选中状态
            element.classList.add('selected');
            
            // 更新主预览图
            const mainImage = document.querySelector('.result-image');
            if (mainImage && element.querySelector('img')) {
                mainImage.src = element.querySelector('img').src;
            }
        }

        // 移除缩略图
        function removeThumbnail(element) {
            element.parentElement.remove();
            showToast('已移除该生成结果');
        }

        // 返回创作页面
        function goBackToCreation() {
            showModule('imageCreation');
        }

        // 查看全部商品
        function viewAllProducts() {
            showToast('查看全部商品');
        }

        // 更换文本
        function changeText() {
            showToast('更换文本');
        }

        // 下载全部
        function downloadAll() {
            showToast('开始下载全部图片');
        }

        // 左侧编辑面板功能
        function filterEditContent() {
            showToast('筛选编辑内容');
        }

        function searchEditContent(keyword) {
            if (keyword) {
                showToast(`搜索关键词: ${keyword}`);
            }
        }

        function uploadEditContent() {
            showToast('上传编辑内容');
        }

        function resetEditContent() {
            showToast('重置编辑内容');
        }

        // 右侧商品面板功能
        function switchProductTab(element, tabType) {
            // 移除所有active类
            const tabs = element.parentElement.querySelectorAll('.product-tab');
            tabs.forEach(tab => tab.classList.remove('active'));
            
            // 为当前tab添加active类
            element.classList.add('active');
            
            // 根据标签页类型更新商品图片
            updateProductImagesByTab(tabType);
            
            showToast(`切换到${tabType}标签页`);
        }

        function updateProductImagesByTab(tabType) {
            const productImages = document.querySelectorAll('.product-images .product-image img');
            const imageMap = {
                'main': 'https://youke1.picui.cn/s1/2025/08/06/6892f6ef774d3.png',
                'text': 'https://youke1.picui.cn/s1/2025/08/06/6892f66a1e370.png',
                'background': 'https://youke1.picui.cn/s1/2025/08/06/6892f6b278b7e.png',
                'cutout': 'https://youke1.picui.cn/s1/2025/08/06/6892f6b2665cd.png'
            };
            
            const newImageSrc = imageMap[tabType] || imageMap['main'];
            productImages.forEach(img => {
                img.src = newImageSrc;
            });
        }

        // 选择商品图片（右侧面板）
        function selectProductImage(element) {
            // 移除所有选中状态
            const images = element.parentElement.querySelectorAll('.product-image');
            images.forEach(img => img.classList.remove('selected'));
            
            // 为当前图片添加选中状态
            element.classList.add('selected');
            
            // 更新主预览图
            const mainImage = document.querySelector('.product-display .product-image');
            if (mainImage && element.querySelector('img')) {
                mainImage.src = element.querySelector('img').src;
            }
            
            showToast('已选择新的商品图片');
        }

        // 更新右侧面板为商品详情
        function updateRightPanelForResult() {
            const rightPanel = document.querySelector('.right-panel');
            if (rightPanel) {
                rightPanel.innerHTML = `
                    <div class="panel-header">
                        <button class="btn btn-secondary" onclick="goBackToCreation()">返回</button>
                    </div>
                    <div class="panel-content">
                        <div class="product-section">
                            <div class="section-header">
                                <h4>商品图 (已选1个)</h4>
                                <button class="btn btn-link" onclick="viewAllProducts()">查看全部</button>
                            </div>
                            <div class="product-tabs">
                                <div class="product-tab active">商品主图</div>
                                <div class="product-tab">商品含文字</div>
                                <div class="product-tab">商品带背景</div>
                                <div class="product-tab">商品抠图</div>
                            </div>
                            <div class="product-info">
                                <div class="product-id">商品1:6920852030913365521</div>
                                <div class="product-images">
                                    <div class="product-image selected">
                                        <img src="https://youke1.picui.cn/s1/2025/08/06/6892f6ef774d3.png" alt="商品图片">
                                        <div class="image-check">✓</div>
                                    </div>
                                    <div class="product-image">
                                        <img src="https://youke1.picui.cn/s1/2025/08/06/6892f6ef774d3.png" alt="商品图片">
                                    </div>
                                    <div class="product-image">
                                        <img src="https://youke1.picui.cn/s1/2025/08/06/6892f6ef774d3.png" alt="商品图片">
                                    </div>
                                </div>
                                <div class="progress-bar">
                                    <div class="progress-fill"></div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="text-section">
                            <div class="section-header">
                                <h4>文本</h4>
                                <button class="btn btn-link" onclick="changeText()">换一换</button>
                            </div>
                            <div class="text-content">
                                <p>暂无数据</p>
                            </div>
                        </div>
                    </div>
                `;
            }
        }

        // 监听配置项变化
        function addConfigListeners() {
            // 监听商品ID输入
            const productIdInput = document.querySelector('input[placeholder="请输入一个商品ID"]');
            if (productIdInput) {
                productIdInput.addEventListener('input', updateTemplateState);
            }
            
            // 监听尺寸选择
            const imageSizeSelect = document.getElementById('imageSize');
            if (imageSizeSelect) {
                imageSizeSelect.addEventListener('change', updateTemplateState);
            }
            
            // 监听数量输入
            const quantityInput = document.querySelector('input[type="number"][value="1"]');
            if (quantityInput) {
                quantityInput.addEventListener('input', updateTemplateState);
            }
            
            // 监听价格输入
            const priceInputs = document.querySelectorAll('input[type="number"][step="0.01"]');
            priceInputs.forEach(input => {
                input.addEventListener('input', updateTemplateState);
            });
            
            // 监听投放渠道选择
            const channelSelect = document.getElementById('channel');
            if (channelSelect) {
                channelSelect.addEventListener('change', updateTemplateState);
            }
            
            // 监听应用场景选择
            const sceneSelect = document.getElementById('scene');
            if (sceneSelect) {
                sceneSelect.addEventListener('change', updateTemplateState);
            }
        }

        function updateTemplateState() {
            // 更新模板选择框显示
            updateTemplates();
            // 更新生产按钮状态
            updateProductionButton();
        }

        // 获取当前选择的扩图比例值
        function getCurrentRatio(formSection) {
            const checkedRadio = formSection.querySelector('input[name="expandRatio"]:checked');
            if (!checkedRadio) return null;
            
            if (checkedRadio.value === 'custom') {
                const widthInput = formSection.querySelector('.custom-width');
                const heightInput = formSection.querySelector('.custom-height');
                if (widthInput && heightInput && widthInput.value && heightInput.value) {
                    return `${widthInput.value}:${heightInput.value}`;
                }
                return '16:9'; // 默认值
            }
            
            return checkedRadio.value;
        }

        // 选择图片
        function selectImage(element) {
            element.classList.toggle('selected');
        }

        // 选择任务
        function selectTask(element) {
            document.querySelectorAll('.task-item').forEach(item => {
                item.classList.remove('active');
            });
            element.classList.add('active');
        }

        // 初始化字符计数功能（已移除）
        // function initCharCount() {
        //     const promptText = document.getElementById('promptText');
        //     const charCount = document.getElementById('charCount');
        //     
        //     if (promptText && charCount) {
        //         // 更新初始字符数
        //         charCount.textContent = promptText.value.length;
        //         
        //         // 添加输入事件监听
        //         promptText.addEventListener('input', function() {
        //             charCount.textContent = this.value.length;
        //         });
        //     }
        // }

        // 显示操作说明
        function showOperationGuide() {
            alert('扩图功能操作说明：\n\n1. 上传图片：支持JPEG/JPG/PNG/WEBP格式，文件大小不超过10M\n2. 扩图类型：选择场景扩图或颜色扩图\n3. 扩图方式：选择直接扩图或先切后扩\n4. 扩图比例：选择预设比例（竖图9:16、横图16:9）或自定义尺寸（如4:3、1:1等）\n5. 扩图方向：选择向上、向下或居中扩图\n6. 生成提示词：填写英文提示词，不超过100字符\n\n点击"提交"按钮开始生成扩图结果。');
        }

        // 上传扩图图片
        function uploadExpandImage() {
            // 创建文件输入元素
            const fileInput = document.createElement('input');
            fileInput.type = 'file';
            fileInput.accept = 'image/jpeg,image/jpg,image/png,image/webp';
            fileInput.style.display = 'none';
            
            fileInput.onchange = function(event) {
                const file = event.target.files[0];
                if (file) {
                    // 检查文件大小（10MB = 10 * 1024 * 1024 bytes）
                    if (file.size > 10 * 1024 * 1024) {
                        alert('文件大小不能超过10MB');
                        return;
                    }
                    
                    // 检查文件类型
                    const allowedTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/webp'];
                    if (!allowedTypes.includes(file.type)) {
                        alert('只支持JPEG/JPG/PNG/WEBP格式的图片');
                        return;
                    }
                    
                    // 显示预览
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        const uploadArea = document.querySelector('.upload-area');
                        if (uploadArea) {
                            uploadArea.innerHTML = `
                                <img src="${e.target.result}" alt="预览图" style="max-width: 100%; max-height: 200px; object-fit: cover; border-radius: 6px;">
                                <div style="margin-top: 10px; color: #666; font-size: 14px;">
                                    已上传: ${file.name}
                                </div>
                            `;
                        }
                    };
                    reader.readAsDataURL(file);
                }
            };
            
            // 触发文件选择
            document.body.appendChild(fileInput);
            fileInput.click();
            document.body.removeChild(fileInput);
        }

        // 搜索商品
        function searchGoods() {
            const goodsId = document.getElementById('goodsId').value;
            if (!goodsId) {
                alert('请输入商品ID');
                return;
            }
            
            // 模拟加载状态
            const uploadInfo = document.getElementById('uploadInfo');
            uploadInfo.innerHTML = '<div style="text-align: center; padding: 40px;"><div class="loading"></div><p>正在查询商品信息...</p></div>';
            
            // 模拟API调用延迟
            setTimeout(() => {
                if (goodsId === '6920234553221107522') {
                    // 如果是扩图功能，显示商品选择界面
                    if (currentModule === 'expand') {
                        uploadInfo.innerHTML = `
                            <div id="selectProductTab" style="display: block;">
                                <div class="message success">
                                    查询到以上商品ID对应SPUID全部商品图
                                </div>
                                <div style="margin-bottom: 20px;">
                                    <h4 style="margin-bottom: 10px; color: #333;">商品1: 6920234553255788354</h4>
                                    <div class="image-grid" style="grid-template-columns: repeat(3, 1fr); gap: 8px;">
                                        <div class="image-item selected" onclick="selectImage(this)">
                                            <img src="https://youke1.picui.cn/s1/2025/08/01/688cb7e3003d7.jpg" alt="Polo衫商品图片">
                                            <div style="position: absolute; bottom: 5px; left: 5px; background: #1890ff; color: white; padding: 2px 6px; border-radius: 3px; font-size: 12px;">✓</div>
                                        </div>
                                        <div class="image-item selected" onclick="selectImage(this)">
                                            <img src="https://youke1.picui.cn/s1/2025/08/01/688cb7e3003d7.jpg" alt="Polo衫商品图片">
                                            <div style="position: absolute; bottom: 5px; left: 5px; background: #1890ff; color: white; padding: 2px 6px; border-radius: 3px; font-size: 12px;">✓</div>
                                        </div>
                                        <div class="image-item" onclick="selectImage(this)">
                                            <img src="https://youke1.picui.cn/s1/2025/08/01/688cb7e3003d7.jpg" alt="Polo衫商品图片">
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- 扩图配置项 -->
                                <div class="form-section">
                                    <h4>扩图类型 <span class="help-icon" title="选择场景扩图或颜色扩图">?</span></h4>
                                    <div class="radio-group">
                                        <label>
                                            <input type="radio" name="expandType" value="scene" checked> 场景扩图
                                        </label>
                                        <label>
                                            <input type="radio" name="expandType" value="color"> 颜色扩图
                                        </label>
                                    </div>
                                </div>
                                
                                <div class="form-section">
                                    <h4>扩图方式 <span class="help-icon" title="选择直接扩图或先切后扩">?</span></h4>
                                    <div class="radio-group">
                                        <label>
                                            <input type="radio" name="expandMethod" value="direct"> 直接扩图
                                        </label>
                                        <label>
                                            <input type="radio" name="expandMethod" value="cutFirst" checked> 先切后扩
                                        </label>
                                    </div>
                                </div>
                                
                                <div class="form-section">
                                    <h4>扩图比例 <span class="help-icon" title="选择竖图9:16或横图16:9">?</span></h4>
                                    <div class="radio-group">
                                        <label>
                                            <input type="radio" name="expandRatio" value="9:16" checked> 竖图9:16
                                        </label>
                                        <label>
                                            <input type="radio" name="expandRatio" value="16:9"> 横图16:9
                                        </label>
                                    </div>
                                </div>
                                
                                <div class="form-section">
                                    <h4>扩图方向 <span class="help-icon" title="选择向上、向下或居中扩图">?</span></h4>
                                    <div class="radio-group">
                                        <label>
                                            <input type="radio" name="expandDirection" value="up"> 向上扩图
                                        </label>
                                        <label>
                                            <input type="radio" name="expandDirection" value="down" checked> 向下扩图
                                        </label>
                                        <label>
                                            <input type="radio" name="expandDirection" value="center"> 居中扩图
                                        </label>
                                    </div>
                                </div>
                                
                                <div class="form-section">
                                    <h4>生成提示词</h4>
                                    <textarea class="form-input" placeholder="请填写英文提示词" rows="3" maxlength="100" id="promptText"></textarea>
                                </div>
                            </div>
                            
                            <div id="uploadTab" style="display: none;">
                                <div class="form-section">
                                    <h4>上传图片 <span class="help-icon" title="支持JPEG/JPG/PNG/WEBP格式，文件大小不超过10M">?</span></h4>
                                    <div class="upload-area" onclick="uploadExpandImage()">
                                        <span class="material-icons">+</span>
                                        <div style="color: #666; font-size: 14px;">
                                            上传JPEG/JPG/PNG/WEBP 10M以内
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="form-section">
                                    <h4>扩图类型 <span class="help-icon" title="选择场景扩图或颜色扩图">?</span></h4>
                                    <div class="radio-group">
                                        <label>
                                            <input type="radio" name="expandType" value="scene" checked> 场景扩图
                                        </label>
                                        <label>
                                            <input type="radio" name="expandType" value="color"> 颜色扩图
                                        </label>
                                    </div>
                                </div>
                                
                                <div class="form-section">
                                    <h4>扩图方式 <span class="help-icon" title="选择直接扩图或先切后扩">?</span></h4>
                                    <div class="radio-group">
                                        <label>
                                            <input type="radio" name="expandMethod" value="direct"> 直接扩图
                                        </label>
                                        <label>
                                            <input type="radio" name="expandMethod" value="cutFirst" checked> 先切后扩
                                        </label>
                                    </div>
                                </div>
                                
                                <div class="form-section">
                                    <h4>扩图比例 <span class="help-icon" title="选择竖图9:16或横图16:9">?</span></h4>
                                    <div class="radio-group">
                                        <label>
                                            <input type="radio" name="expandRatio" value="9:16" checked> 竖图9:16
                                        </label>
                                        <label>
                                            <input type="radio" name="expandRatio" value="16:9"> 横图16:9
                                        </label>
                                    </div>
                                </div>
                                
                                <div class="form-section">
                                    <h4>扩图方向 <span class="help-icon" title="选择向上、向下或居中扩图">?</span></h4>
                                    <div class="radio-group">
                                        <label>
                                            <input type="radio" name="expandDirection" value="up"> 向上扩图
                                        </label>
                                        <label>
                                            <input type="radio" name="expandDirection" value="down" checked> 向下扩图
                                        </label>
                                        <label>
                                            <input type="radio" name="expandDirection" value="center"> 居中扩图
                                        </label>
                                    </div>
                                </div>
                                
                                <div class="form-section">
                                    <h4>生成提示词</h4>
                                    <textarea class="form-input" placeholder="请填写英文提示词" rows="3" maxlength="100" id="promptText"></textarea>
                                </div>
                            </div>
                        `;
                        // 初始化字符计数（已移除）
                        // initCharCount();
                    } else {
                        showModule(currentModule);
                    }
                } else {
                    uploadInfo.innerHTML = `
                        <div class="message error">
                            查询失败，请输正确的商品ID
                        </div>
                    `;
                }
            }, 1500);
        }

        // 重置表单
        function resetForm() {
            if (currentModule === 'changeBg') {
                // 重置换背景表单
                document.getElementById('goodsId').value = '6921461213816069463';
                document.querySelectorAll('.image-item.selected').forEach(item => {
                    item.classList.remove('selected');
                    const checkmark = item.querySelector('div[style*="background: #1890ff"]');
                    if (checkmark) checkmark.remove();
                });
                // 重置背景比例选择
                document.querySelector('input[name="bgRatio"][value="9:16"]').checked = true;
                return;
            } else if (currentModule === 'bgFission') {
                // 重置背景裂变表单
                resetBgFissionForm();
                return;
            } else if (currentModule === 'feedbackManagement') {
                // 意见管理不需要重置表单
                return;
            }
            
            // 重置扩图表单
            document.getElementById('goodsId').value = '';
            document.querySelectorAll('.image-item').forEach(item => {
                item.classList.remove('selected');
            });
        }

        // 提交表单
        function submitForm() {
            if (currentModule === 'changeBg') {
                submitChangeBg();
                return;
            } else if (currentModule === 'bgFission') {
                submitBgFission();
                return;
            } else if (currentModule === 'virtualFitting') {
                submitVirtualFitting();
                return;
            } else if (currentModule === 'feedbackManagement') {
                // 意见管理不需要提交表单
                return;
            }
            
            const selectedImages = document.querySelectorAll('.image-item.selected');
            if (selectedImages.length === 0) {
                alert('请先选择图片');
                return;
            }
            
            // 获取配置参数
            const expandType = document.querySelector('input[name="expandType"]:checked')?.value;
            const expandMethod = document.querySelector('input[name="expandMethod"]:checked')?.value;
            const expandRatio = document.querySelector('input[name="expandRatio"]:checked')?.value;
            const expandDirection = document.querySelector('input[name="expandDirection"]:checked')?.value;
            const prompt = document.getElementById('promptText')?.value || '';
            
            // 显示提交状态
            const middlePanelContent = document.getElementById('middlePanelContent');
            middlePanelContent.innerHTML = `
                <div style="text-align: center; padding: 40px;">
                    <div class="loading"></div>
                    <p>正在生成扩图结果...</p>
                </div>
            `;
            
            // 模拟生成过程
            setTimeout(() => {
                const currentTime = new Date().toLocaleString('zh-CN', {
                    year: 'numeric',
                    month: '2-digit',
                    day: '2-digit',
                    hour: '2-digit',
                    minute: '2-digit',
                    second: '2-digit'
                }).replace(/\//g, '-');
                
                middlePanelContent.innerHTML = `
                    <div style="margin-bottom: 20px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                            <div>
                                <span style="font-weight: 500; color: #333;">商品Id: 6920234553255788354</span>
                                <span style="margin-left: 10px; color: #999; font-size: 12px;">${currentTime}</span>
                            </div>
                            <button class="btn btn-primary" onclick="regenerateImage()">重新生成</button>
                        </div>
                        
                        <div class="image-grid" style="grid-template-columns: repeat(4, 1fr); gap: 12px;">
                            <div class="image-item" style="position: relative;">
                                <div style="position: absolute; top: 5px; left: 5px; background: #1890ff; color: white; padding: 2px 6px; border-radius: 3px; font-size: 12px;">5978</div>
                                <img src="https://youke1.picui.cn/s1/2025/08/01/688cb7e3003d7.jpg" alt="扩图结果1" style="width: 100%; height: 120px; object-fit: cover;">
                                <div class="image-hover-icons">
                                    <div class="hover-icon" onclick="copyImage('5978')" title="复制">📋</div>
                                    <div class="hover-icon" onclick="openImageModal('5978', 0)" title="查看">👁</div>
                                </div>
                                <div style="display: flex; gap: 5px; margin-top: 8px; align-items: center;">
                                    <button class="btn btn-secondary" style="font-size: 12px; padding: 4px 8px;" onclick="approveImage('5978')">通过</button>
                                    <button class="btn btn-primary" style="font-size: 12px; padding: 4px 8px;" onclick="downloadSingleImage('5978')">下载</button>
                                    <span class="feedback-icon" onclick="openFeedbackModal('5978')" title="负向反馈">
                                        <img src="https://youke1.picui.cn/s1/2025/08/04/6890570a0432b.png" alt="负向反馈" style="width: 16px; height: 16px;">
                                    </span>
                                </div>
                            </div>
                            <div class="image-item" style="position: relative;">
                                <div style="position: absolute; top: 5px; left: 5px; background: #1890ff; color: white; padding: 2px 6px; border-radius: 3px; font-size: 12px;">5977</div>
                                <img src="https://youke1.picui.cn/s1/2025/08/01/688cb7e3003d7.jpg" alt="扩图结果2" style="width: 100%; height: 120px; object-fit: cover;">
                                <div class="image-hover-icons">
                                    <div class="hover-icon" onclick="copyImage('5977')" title="复制">📋</div>
                                    <div class="hover-icon" onclick="openImageModal('5977', 1)" title="查看">👁</div>
                                </div>
                                <div style="display: flex; gap: 5px; margin-top: 8px; align-items: center;">
                                    <button class="btn btn-secondary" style="font-size: 12px; padding: 4px 8px;" onclick="approveImage('5977')">通过</button>
                                    <button class="btn btn-primary" style="font-size: 12px; padding: 4px 8px;" onclick="downloadSingleImage('5977')">下载</button>
                                    <span class="feedback-icon" onclick="openFeedbackModal('5977')" title="负向反馈">
                                        <img src="https://youke1.picui.cn/s1/2025/08/04/6890570a0432b.png" alt="负向反馈" style="width: 16px; height: 16px;">
                                    </span>
                                </div>
                            </div>
                            <div class="image-item" style="position: relative;">
                                <div style="position: absolute; top: 5px; left: 5px; background: #1890ff; color: white; padding: 2px 6px; border-radius: 3px; font-size: 12px;">5976</div>
                                <img src="https://youke1.picui.cn/s1/2025/08/01/688cb7e3003d7.jpg" alt="扩图结果3" style="width: 100%; height: 120px; object-fit: cover;">
                                <div class="image-hover-icons">
                                    <div class="hover-icon" onclick="copyImage('5976')" title="复制">📋</div>
                                    <div class="hover-icon" onclick="openImageModal('5976', 2)" title="查看">👁</div>
                                </div>
                                <div style="display: flex; gap: 5px; margin-top: 8px; align-items: center;">
                                    <button class="btn btn-secondary" style="font-size: 12px; padding: 4px 8px;" onclick="approveImage('5976')">通过</button>
                                    <button class="btn btn-primary" style="font-size: 12px; padding: 4px 8px;" onclick="downloadSingleImage('5976')">下载</button>
                                    <span class="feedback-icon" onclick="openFeedbackModal('5976')" title="负向反馈">
                                        <img src="https://youke1.picui.cn/s1/2025/08/04/6890570a0432b.png" alt="负向反馈" style="width: 16px; height: 16px;">
                                    </span>
                                </div>
                            </div>
                            <div class="image-item" style="position: relative;">
                                <div style="position: absolute; top: 5px; left: 5px; background: #1890ff; color: white; padding: 2px 6px; border-radius: 3px; font-size: 12px;">5975</div>
                                <img src="https://youke1.picui.cn/s1/2025/08/01/688cb7e3003d7.jpg" alt="扩图结果4" style="width: 100%; height: 120px; object-fit: cover;">
                                <div class="image-hover-icons">
                                    <div class="hover-icon" onclick="copyImage('5975')" title="复制">📋</div>
                                    <div class="hover-icon" onclick="openImageModal('5975', 3)" title="查看">👁</div>
                                </div>
                                <div style="display: flex; gap: 5px; margin-top: 8px; align-items: center;">
                                    <button class="btn btn-secondary" style="font-size: 12px; padding: 4px 8px;" onclick="approveImage('5975')">通过</button>
                                    <button class="btn btn-primary" style="font-size: 12px; padding: 4px 8px;" onclick="downloadSingleImage('5975')">下载</button>
                                    <span class="feedback-icon" onclick="openFeedbackModal('5975')" title="负向反馈">
                                        <img src="https://youke1.picui.cn/s1/2025/08/04/6890570a0432b.png" alt="负向反馈" style="width: 16px; height: 16px;">
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                            <div>
                                <span style="font-weight: 500; color: #333;">商品Id: 6920234553255788354</span>
                                <span style="margin-left: 10px; color: #999; font-size: 12px;">${currentTime}</span>
                            </div>
                            <button class="btn btn-primary" onclick="regenerateImage()">重新生成</button>
                        </div>
                        
                        <div class="image-grid" style="grid-template-columns: repeat(4, 1fr); gap: 12px;">
                            <div class="image-item" style="position: relative;">
                                <div style="position: absolute; top: 5px; left: 5px; background: #1890ff; color: white; padding: 2px 6px; border-radius: 3px; font-size: 12px;">5982</div>
                                <img src="https://youke1.picui.cn/s1/2025/08/01/688cb7e3003d7.jpg" alt="扩图结果5" style="width: 100%; height: 120px; object-fit: cover;">
                                <div class="image-hover-icons">
                                    <div class="hover-icon" onclick="copyImage('5982')" title="复制">📋</div>
                                    <div class="hover-icon" onclick="openImageModal('5982', 4)" title="查看">👁</div>
                                </div>
                                <div style="display: flex; gap: 5px; margin-top: 8px; align-items: center;">
                                    <button class="btn btn-secondary" style="font-size: 12px; padding: 4px 8px;" onclick="approveImage('5982')">通过</button>
                                    <button class="btn btn-primary" style="font-size: 12px; padding: 4px 8px;" onclick="downloadSingleImage('5982')">下载</button>
                                    <span class="feedback-icon" onclick="openFeedbackModal('5982')" title="负向反馈">
                                        <img src="https://youke1.picui.cn/s1/2025/08/04/6890570a0432b.png" alt="负向反馈" style="width: 16px; height: 16px;">
                                    </span>
                                </div>
                            </div>
                            <div class="image-item" style="position: relative;">
                                <div style="position: absolute; top: 5px; left: 5px; background: #1890ff; color: white; padding: 2px 6px; border-radius: 3px; font-size: 12px;">5981</div>
                                <img src="https://youke1.picui.cn/s1/2025/08/01/688cb7e3003d7.jpg" alt="扩图结果6" style="width: 100%; height: 120px; object-fit: cover;">
                                <div class="image-hover-icons">
                                    <div class="hover-icon" onclick="copyImage('5981')" title="复制">📋</div>
                                    <div class="hover-icon" onclick="openImageModal('5981', 5)" title="查看">👁</div>
                                </div>
                                <div style="display: flex; gap: 5px; margin-top: 8px; align-items: center;">
                                    <button class="btn btn-secondary" style="font-size: 12px; padding: 4px 8px;" onclick="approveImage('5981')">通过</button>
                                    <button class="btn btn-primary" style="font-size: 12px; padding: 4px 8px;" onclick="downloadSingleImage('5981')">下载</button>
                                    <span class="feedback-icon" onclick="openFeedbackModal('5981')" title="负向反馈">
                                        <img src="https://youke1.picui.cn/s1/2025/08/04/6890570a0432b.png" alt="负向反馈" style="width: 16px; height: 16px;">
                                    </span>
                                </div>
                            </div>
                            <div class="image-item" style="position: relative;">
                                <div style="position: absolute; top: 5px; left: 5px; background: #1890ff; color: white; padding: 2px 6px; border-radius: 3px; font-size: 12px;">5980</div>
                                <img src="https://youke1.picui.cn/s1/2025/08/01/688cb7e3003d7.jpg" alt="扩图结果7" style="width: 100%; height: 120px; object-fit: cover;">
                                <div class="image-hover-icons">
                                    <div class="hover-icon" onclick="copyImage('5980')" title="复制">📋</div>
                                    <div class="hover-icon" onclick="openImageModal('5980', 6)" title="查看">👁</div>
                                </div>
                                <div style="display: flex; gap: 5px; margin-top: 8px; align-items: center;">
                                    <button class="btn btn-secondary" style="font-size: 12px; padding: 4px 8px;" onclick="approveImage('5980')">通过</button>
                                    <button class="btn btn-primary" style="font-size: 12px; padding: 4px 8px;" onclick="downloadSingleImage('5980')">下载</button>
                                    <span class="feedback-icon" onclick="openFeedbackModal('5980')" title="负向反馈">
                                        <img src="https://youke1.picui.cn/s1/2025/08/04/6890570a0432b.png" alt="负向反馈" style="width: 16px; height: 16px;">
                                    </span>
                                </div>
                            </div>
                            <div class="image-item" style="position: relative;">
                                <div style="position: absolute; top: 5px; left: 5px; background: #1890ff; color: white; padding: 2px 6px; border-radius: 3px; font-size: 12px;">5979</div>
                                <img src="https://youke1.picui.cn/s1/2025/08/01/688cb7e3003d7.jpg" alt="扩图结果8" style="width: 100%; height: 120px; object-fit: cover;">
                                <div class="image-hover-icons">
                                    <div class="hover-icon" onclick="copyImage('5979')" title="复制">📋</div>
                                    <div class="hover-icon" onclick="openImageModal('5979', 7)" title="查看">👁</div>
                                </div>
                                <div style="display: flex; gap: 5px; margin-top: 8px; align-items: center;">
                                    <button class="btn btn-secondary" style="font-size: 12px; padding: 4px 8px;" onclick="approveImage('5979')">通过</button>
                                    <button class="btn btn-primary" style="font-size: 12px; padding: 4px 8px;" onclick="downloadSingleImage('5979')">下载</button>
                                    <span class="feedback-icon" onclick="openFeedbackModal('5979')" title="负向反馈">
                                        <img src="https://youke1.picui.cn/s1/2025/08/04/6890570a0432b.png" alt="负向反馈" style="width: 16px; height: 16px;">
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                
                // 添加新任务到任务列表
                addNewTask();
                
            }, 3000);
        }
        
        // 下载图片
        function downloadImage() {
            alert('开始下载扩图结果...');
        }
        
        // 重新生成
        function regenerateImage() {
            submitForm();
        }
        
        // 通过图片
        function approveImage(imageId) {
            alert(`图片 ${imageId} 已通过审核`);
        }
        
        // 下载单张图片
        function downloadSingleImage(imageId) {
            alert(`开始下载图片 ${imageId}`);
        }
        
        // 添加新任务
        function addNewTask() {
            const taskList = document.getElementById('taskList');
            const newTask = document.createElement('li');
            newTask.className = 'task-item';
            newTask.onclick = function() { selectTask(this); };
            
            if (currentModule === 'changeBg') {
                // 添加换背景任务
                newTask.innerHTML = `
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <img src="https://youke1.picui.cn/s1/2025/08/01/688cb7e3003d7.jpg" alt="换背景预览" style="width: 40px; height: 40px; object-fit: cover; border-radius: 4px; flex-shrink: 0;">
                        <div style="flex: 1;">
                            <div style="font-weight: 500;">换背景任务 ${new Date().getTime()}</div>
                            <div style="font-size: 12px; color: #999;">已完成</div>
                        </div>
                    </div>
                `;
            } else if (currentModule === 'bgFission') {
                // 添加背景裂变任务
                newTask.innerHTML = `
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <img src="https://youke1.picui.cn/s1/2025/08/04/68905925c8587.jpeg" alt="背景裂变预览" style="width: 40px; height: 40px; object-fit: cover; border-radius: 4px; flex-shrink: 0;">
                        <div style="flex: 1;">
                            <div style="font-weight: 500;">背景裂变任务 ${new Date().getTime()}</div>
                            <div style="font-size: 12px; color: #999;">已完成</div>
                        </div>
                    </div>
                `;
            } else if (currentModule === 'feedbackManagement') {
                // 添加意见管理任务
                newTask.innerHTML = `
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <div style="width: 40px; height: 40px; background: #f0f0f0; border-radius: 4px; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
                            <span class="material-icons" style="color: #666;">feedback</span>
                        </div>
                        <div style="flex: 1;">
                            <div style="font-weight: 500;">意见处理任务 ${new Date().getTime()}</div>
                            <div style="font-size: 12px; color: #999;">待处理</div>
                        </div>
                    </div>
                `;
            } else {
                // 添加扩图任务
                newTask.innerHTML = `
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <img src="https://youke1.picui.cn/s1/2025/08/01/688cb7e3003d7.jpg" alt="商品预览" style="width: 40px; height: 40px; object-fit: cover; border-radius: 4px; flex-shrink: 0;">
                        <div style="flex: 1;">
                            <div style="font-weight: 500;">扩图任务 ${new Date().getTime()}</div>
                            <div style="font-size: 12px; color: #999;">已完成</div>
                        </div>
                    </div>
                `;
            }
            
            taskList.insertBefore(newTask, taskList.firstChild);
        }

        // 显示Toast提示
        function showToast() {
            const toast = document.getElementById('toast');
            toast.classList.add('show');
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        // 显示反馈弹窗
        function showFeedbackModal() {
            const modal = document.getElementById('feedbackModal');
            modal.style.display = 'flex';
            document.getElementById('feedbackText').value = '';
        }

        // 打开反馈弹窗
        function openFeedbackModal(imageId) {
            const modal = document.getElementById('feedbackModal');
            modal.style.display = 'flex';
            document.getElementById('feedbackText').value = '';
            modal.dataset.imageId = imageId;
        }

        // 关闭反馈弹窗
        function closeFeedbackModal() {
            const modal = document.getElementById('feedbackModal');
            modal.style.display = 'none';
        }

        // 提交反馈
        function submitFeedback() {
            const modal = document.getElementById('feedbackModal');
            const imageId = modal.dataset.imageId;
            const feedbackText = document.getElementById('feedbackText').value;
            
            if (!feedbackText.trim()) {
                alert('请输入反馈内容');
                return;
            }
            
            alert(`图片 ${imageId} 的反馈已提交：${feedbackText}`);
            closeFeedbackModal();
        }

        // 图片数据
        const imageData = [
            { id: '5978', src: 'https://youke1.picui.cn/s1/2025/08/01/688cb7e3003d7.jpg', info: '蚕丝 夏凉' },
            { id: '5977', src: 'https://youke1.picui.cn/s1/2025/08/01/688cb7e3003d7.jpg', info: '蚕丝 夏凉' },
            { id: '5976', src: 'https://youke1.picui.cn/s1/2025/08/01/688cb7e3003d7.jpg', info: '蚕丝 夏凉' },
            { id: '5975', src: 'https://youke1.picui.cn/s1/2025/08/01/688cb7e3003d7.jpg', info: '蚕丝 夏凉' },
            { id: '5982', src: 'https://youke1.picui.cn/s1/2025/08/01/688cb7e3003d7.jpg', info: '蚕丝 夏凉' },
            { id: '5981', src: 'https://youke1.picui.cn/s1/2025/08/01/688cb7e3003d7.jpg', info: '蚕丝 夏凉' },
            { id: '5980', src: 'https://youke1.picui.cn/s1/2025/08/01/688cb7e3003d7.jpg', info: '蚕丝 夏凉' },
            { id: '5979', src: 'https://youke1.picui.cn/s1/2025/08/01/688cb7e3003d7.jpg', info: '蚕丝 夏凉' }
        ];

        let currentImageIndex = 0;

        // 复制图片
        function copyImage(imageId) {
            alert(`图片 ${imageId} 已复制到剪贴板`);
        }

        // 打开图片放大弹窗
        function openImageModal(imageId, index) {
            currentImageIndex = index;
            const modal = document.getElementById('imageModal');
            const modalImage = document.getElementById('modalImage');
            const modalInfo = document.getElementById('modalInfo');
            
            modalImage.src = imageData[index].src;
            modalInfo.textContent = `${index + 1}/${imageData.length}`;
            modal.style.display = 'flex';
        }

        // 关闭图片放大弹窗
        function closeImageModal() {
            const modal = document.getElementById('imageModal');
            modal.style.display = 'none';
        }

        // 显示上一张图片
        function showPrevImage() {
            currentImageIndex = (currentImageIndex - 1 + imageData.length) % imageData.length;
            updateModalImage();
        }

        // 显示下一张图片
        function showNextImage() {
            currentImageIndex = (currentImageIndex + 1) % imageData.length;
            updateModalImage();
        }

        // 更新弹窗中的图片
        function updateModalImage() {
            const modalImage = document.getElementById('modalImage');
            const modalInfo = document.getElementById('modalInfo');
            
            modalImage.src = imageData[currentImageIndex].src;
            modalInfo.textContent = `${currentImageIndex + 1}/${imageData.length}`;
        }

        // 键盘事件监听
        document.addEventListener('keydown', function(e) {
            const modal = document.getElementById('imageModal');
            if (modal.style.display === 'flex') {
                if (e.key === 'Escape') {
                    closeImageModal();
                } else if (e.key === 'ArrowLeft') {
                    showPrevImage();
                } else if (e.key === 'ArrowRight') {
                    showNextImage();
                }
            }
        });

        // 选择背景图片
        function selectBgImage(element) {
            // 移除同组中其他图片的选中状态
            const parent = element.parentElement;
            parent.querySelectorAll('.image-item').forEach(item => {
                item.classList.remove('selected');
                const checkmark = item.querySelector('div[style*="background: #1890ff"]');
                if (checkmark) checkmark.remove();
            });
            
            // 添加选中状态
            element.classList.add('selected');
            const checkmark = document.createElement('div');
            checkmark.style.cssText = 'position: absolute; bottom: 5px; left: 5px; background: #1890ff; color: white; padding: 2px 6px; border-radius: 3px; font-size: 12px;';
            checkmark.textContent = '✓';
            element.appendChild(checkmark);
        }

        // 换背景商品查询
        function searchChangeBgGoods() {
            const goodsId = document.getElementById('goodsId').value;
            if (!goodsId) {
                alert('请输入商品ID');
                return;
            }
            
            // 模拟加载状态
            const uploadInfo = document.getElementById('uploadInfo');
            uploadInfo.innerHTML = '<div style="text-align: center; padding: 40px;"><div class="loading"></div><p>正在查询商品信息...</p></div>';
            
            // 模拟API调用延迟
            setTimeout(() => {
                if (goodsId === '6921461213816069463') {
                    // 恢复换背景功能显示
                    showModule('changeBg');
                } else {
                    uploadInfo.innerHTML = `
                        <div class="message error">
                            查询失败，请输正确的商品ID
                        </div>
                    `;
                }
            }, 1500);
        }

        // 选择换背景商品图片
        function selectChangeBgImage(element) {
            element.classList.toggle('selected');
            
            // 更新选中标记
            const checkmark = element.querySelector('div[style*="background: #1890ff"]');
            if (element.classList.contains('selected')) {
                if (!checkmark) {
                    const newCheckmark = document.createElement('div');
                    newCheckmark.style.cssText = 'position: absolute; bottom: 5px; left: 5px; background: #1890ff; color: white; padding: 2px 6px; border-radius: 3px; font-size: 12px;';
                    newCheckmark.textContent = '✓';
                    element.appendChild(newCheckmark);
                }
            } else {
                if (checkmark) {
                    checkmark.remove();
                }
            }
        }

        // 换背景提交处理
        function submitChangeBg() {
            const selectedImages = document.querySelectorAll('.image-item.selected img[alt*="商品图片"]');
            const selectedBgImages = document.querySelectorAll('.image-item.selected img[alt*="背景"]');
            const bgRatio = document.querySelector('input[name="bgRatio"]:checked')?.value;
            
            if (selectedImages.length === 0) {
                alert('请先选择商品图片');
                return;
            }
            
            if (selectedBgImages.length === 0) {
                alert('请先选择背景图片');
                return;
            }
            
            if (!bgRatio) {
                alert('请选择背景图比例');
                return;
            }
            
            // 显示生成状态
            const middlePanelContent = document.getElementById('middlePanelContent');
            middlePanelContent.innerHTML = `
                <div style="text-align: center; padding: 40px;">
                    <div class="loading"></div>
                    <p>正在生成换背景结果...</p>
                </div>
            `;
            
            // 模拟生成过程
            setTimeout(() => {
                const currentTime = new Date().toLocaleString('zh-CN', {
                    year: 'numeric',
                    month: '2-digit',
                    day: '2-digit',
                    hour: '2-digit',
                    minute: '2-digit',
                    second: '2-digit'
                }).replace(/\//g, '-');
                
                const goodsId = document.getElementById('goodsId').value || '6921461213816069463';
                
                middlePanelContent.innerHTML = `
                    <div style="margin-bottom: 20px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                            <div>
                                <span style="font-weight: 500; color: #333;">商品Id: ${goodsId}</span>
                                <span style="margin-left: 10px; color: #999; font-size: 12px;">${currentTime}</span>
                            </div>
                            <button class="btn btn-primary" onclick="regenerateChangeBg()">重新生成</button>
                        </div>
                        
                        <div class="image-grid" style="grid-template-columns: repeat(4, 1fr); gap: 12px;">
                            <div class="image-item" style="position: relative;">
                                <div style="position: absolute; top: 5px; left: 5px; background: #1890ff; color: white; padding: 2px 6px; border-radius: 3px; font-size: 12px;">6000</div>
                                <img src="https://youke1.picui.cn/s1/2025/08/04/689037a51d9bb.png" alt="换背景结果1" style="width: 100%; height: 120px; object-fit: cover;">
                                <div style="display: flex; gap: 5px; margin-top: 8px; align-items: center;">
                                    <button class="btn btn-secondary" style="font-size: 12px; padding: 4px 8px;" onclick="approveImage('6000')">通过</button>
                                    <button class="btn btn-primary" style="font-size: 12px; padding: 4px 8px;" onclick="downloadSingleImage('6000')">下载</button>
                                    <span class="feedback-icon" onclick="openFeedbackModal('6000')" title="负向反馈">
                                        <img src="https://youke1.picui.cn/s1/2025/08/04/6890570a0432b.png" alt="负向反馈" style="width: 16px; height: 16px;">
                                    </span>
                                </div>
                            </div>
                            <div class="image-item" style="position: relative;">
                                <div style="position: absolute; top: 5px; left: 5px; background: #1890ff; color: white; padding: 2px 6px; border-radius: 3px; font-size: 12px;">6001</div>
                                <img src="https://youke1.picui.cn/s1/2025/08/04/689037a51d9bb.png" alt="换背景结果2" style="width: 100%; height: 120px; object-fit: cover;">
                                <div style="display: flex; gap: 5px; margin-top: 8px; align-items: center;">
                                    <button class="btn btn-secondary" style="font-size: 12px; padding: 4px 8px;" onclick="approveImage('6001')">通过</button>
                                    <button class="btn btn-primary" style="font-size: 12px; padding: 4px 8px;" onclick="downloadSingleImage('6001')">下载</button>
                                    <span class="feedback-icon" onclick="openFeedbackModal('6001')" title="负向反馈">
                                        <img src="https://youke1.picui.cn/s1/2025/08/04/6890570a0432b.png" alt="负向反馈" style="width: 16px; height: 16px;">
                                    </span>
                                </div>
                            </div>
                            <div class="image-item" style="position: relative;">
                                <div style="position: absolute; top: 5px; left: 5px; background: #1890ff; color: white; padding: 2px 6px; border-radius: 3px; font-size: 12px;">6002</div>
                                <img src="https://youke1.picui.cn/s1/2025/08/04/689037a51d9bb.png" alt="换背景结果3" style="width: 100%; height: 120px; object-fit: cover;">
                                <div style="display: flex; gap: 5px; margin-top: 8px; align-items: center;">
                                    <button class="btn btn-secondary" style="font-size: 12px; padding: 4px 8px;" onclick="approveImage('6002')">通过</button>
                                    <button class="btn btn-primary" style="font-size: 12px; padding: 4px 8px;" onclick="downloadSingleImage('6002')">下载</button>
                                    <span class="feedback-icon" onclick="openFeedbackModal('6002')" title="负向反馈">
                                        <img src="https://youke1.picui.cn/s1/2025/08/04/6890570a0432b.png" alt="负向反馈" style="width: 16px; height: 16px;">
                                    </span>
                                </div>
                            </div>
                            <div class="image-item" style="position: relative;">
                                <div style="position: absolute; top: 5px; left: 5px; background: #1890ff; color: white; padding: 2px 6px; border-radius: 3px; font-size: 12px;">6003</div>
                                <img src="https://youke1.picui.cn/s1/2025/08/04/689037a51d9bb.png" alt="换背景结果4" style="width: 100%; height: 120px; object-fit: cover;">
                                <div style="display: flex; gap: 5px; margin-top: 8px; align-items: center;">
                                    <button class="btn btn-secondary" style="font-size: 12px; padding: 4px 8px;" onclick="approveImage('6003')">通过</button>
                                    <button class="btn btn-primary" style="font-size: 12px; padding: 4px 8px;" onclick="downloadSingleImage('6003')">下载</button>
                                    <span class="feedback-icon" onclick="openFeedbackModal('6003')" title="负向反馈">
                                        <img src="https://youke1.picui.cn/s1/2025/08/04/6890570a0432b.png" alt="负向反馈" style="width: 16px; height: 16px;">
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                
                // 添加新任务到任务列表
                addNewTask();
                
            }, 3000);
        }

        // 重新生成换背景
        function regenerateChangeBg() {
            submitChangeBg();
        }

        // 下载全部
        function downloadAll() {
            alert('开始下载全部文件...');
        }

        // 新增背景图相关变量
        let uploadedImageSrc = '';
        let selectedGeneratedImageIndex = -1;
        let generatedImages = [];

        // 打开新增背景图弹窗
        function openAddBgModal() {
            const modal = document.getElementById('addBgModal');
            modal.style.display = 'flex';
            resetAddBgModal();
        }

        // 关闭新增背景图弹窗
        function closeAddBgModal() {
            const modal = document.getElementById('addBgModal');
            modal.style.display = 'none';
            resetAddBgModal();
        }

        // 重置新增背景图弹窗
        function resetAddBgModal() {
            uploadedImageSrc = '';
            selectedGeneratedImageIndex = -1;
            generatedImages = [];
            
            // 重置上传区域
            document.getElementById('uploadArea').style.display = 'block';
            document.getElementById('uploadedImage').style.display = 'none';
            document.getElementById('previewImage').src = '';
            
            // 重置生成按钮
            document.getElementById('generateBtn').disabled = true;
            
            // 隐藏生成结果
            document.getElementById('generationResults').style.display = 'none';
            document.getElementById('addToPresetBtn').disabled = true;
            
            // 重置相似程度选择
            document.querySelector('input[name="similarityLevel"][value="medium"]').checked = true;
        }

        // 重置背景裂变表单
        function resetBgFissionForm() {
            // 重置上传区域
            const uploadArea = document.getElementById('uploadArea');
            const uploadedImage = document.getElementById('uploadedImage');
            const previewImage = document.getElementById('previewImage');
            
            if (uploadArea) {
                uploadArea.style.display = 'block';
            }
            if (uploadedImage) {
                uploadedImage.style.display = 'none';
            }
            if (previewImage) {
                previewImage.src = '';
            }
            
            // 重置相似程度选择
            const mediumRadio = document.querySelector('input[name="similarityLevel"][value="medium"]');
            if (mediumRadio) {
                mediumRadio.checked = true;
            }
            
            // 重置背景比例选择
            const bgRatioRadio = document.querySelector('input[name="bgRatio"][value="9:16"]');
            if (bgRatioRadio) {
                bgRatioRadio.checked = true;
            }
            
            // 重置中间面板内容
            const middlePanelContent = document.getElementById('middlePanelContent');
            if (middlePanelContent) {
                middlePanelContent.innerHTML = `
                    <div class="empty-state">
                        <span class="material-icons">image</span>
                        <p>请先上传参考图并生成背景图</p>
                    </div>
                `;
            }
        }

        // 触发文件上传
        function triggerFileUpload() {
            document.getElementById('fileUpload').click();
        }

        // 处理文件上传
        function handleFileUpload(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            // 检查文件类型
            const allowedTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/webp'];
            if (!allowedTypes.includes(file.type)) {
                alert('请上传JPEG/JPG/PNG/WEBP格式的图片');
                return;
            }
            
            // 检查文件大小（10M以内）
            if (file.size > 10 * 1024 * 1024) {
                alert('文件大小不能超过10M');
                return;
            }
            
            // 模拟上传成功，使用mock图片
            uploadedImageSrc = 'https://youke1.picui.cn/s1/2025/08/04/68905925c8587.jpeg';
            
            // 显示预览
            document.getElementById('uploadArea').style.display = 'none';
            document.getElementById('uploadedImage').style.display = 'block';
            document.getElementById('previewImage').src = uploadedImageSrc;
            
            // 启用生成按钮
            document.getElementById('generateBtn').disabled = false;
        }

        // 生成背景图
        function generateBgImages() {
            if (!uploadedImageSrc) {
                alert('请先上传参考图');
                return;
            }
            
            const similarityLevel = document.querySelector('input[name="similarityLevel"]:checked').value;
            
            // 显示加载状态
            document.getElementById('generateBtn').textContent = '生成中...';
            document.getElementById('generateBtn').disabled = true;
            
            // 模拟生成过程
            setTimeout(() => {
                // Mock生成结果
                generatedImages = [
                    'https://youke1.picui.cn/s1/2025/08/04/68905925d6370.jpeg',
                    'https://youke1.picui.cn/s1/2025/08/04/689059264c66b.jpeg',
                    'https://youke1.picui.cn/s1/2025/08/04/68905926417c1.jpeg'
                ];
                
                // 更新生成结果图片
                const resultImages = document.querySelectorAll('#generationResults .image-item img');
                resultImages.forEach((img, index) => {
                    img.src = generatedImages[index];
                });
                
                // 显示生成结果
                document.getElementById('generationResults').style.display = 'block';
                
                // 重置生成按钮
                document.getElementById('generateBtn').textContent = '提交生成';
                document.getElementById('generateBtn').disabled = false;
                
            }, 2000);
        }

        // 选择生成的图片
        function selectGeneratedImage(element, index) {
            // 移除其他选中状态
            document.querySelectorAll('#generationResults .image-item').forEach(item => {
                item.classList.remove('selected');
                const checkmark = item.querySelector('div[style*="background: #1890ff"]');
                if (checkmark) checkmark.remove();
            });
            
            // 添加选中状态
            element.classList.add('selected');
            selectedGeneratedImageIndex = index;
            
            const checkmark = document.createElement('div');
            checkmark.style.cssText = 'position: absolute; bottom: 5px; left: 5px; background: #1890ff; color: white; padding: 2px 6px; border-radius: 3px; font-size: 12px;';
            checkmark.textContent = '✓';
            element.appendChild(checkmark);
            
            // 启用添加到预设按钮
            document.getElementById('addToPresetBtn').disabled = false;
        }

        // 添加到预设
        function addToPreset() {
            if (selectedGeneratedImageIndex === -1) {
                alert('请先选择一张生成的图片');
                return;
            }
            
            const selectedImage = generatedImages[selectedGeneratedImageIndex];
            
            // 添加到蓝色分类的预设中
            const blueCategory = document.querySelector('h5[style*="color: #333"]').parentElement.parentElement.nextElementSibling;
            const imageGrid = blueCategory.querySelector('.image-grid');
            
            // 创建新的图片项
            const newImageItem = document.createElement('div');
            newImageItem.className = 'image-item';
            newImageItem.onclick = function() { selectBgImage(this); };
            newImageItem.innerHTML = `
                <img src="${selectedImage}" alt="新增背景" style="width: 100%; height: 120px; object-fit: cover;">
            `;
            
            // 添加到网格中
            imageGrid.appendChild(newImageItem);
            
            // 关闭弹窗
            closeAddBgModal();
            
            // 显示成功提示
            alert('背景图已成功添加到预设中！');
        }

        // 提交背景裂变
        function submitBgFission() {
            const uploadArea = document.getElementById('uploadArea');
            const uploadedImage = document.getElementById('uploadedImage');
            
            if (uploadArea && uploadArea.style.display !== 'none') {
                alert('请先上传参考图');
                return;
            }
            
            const similarityLevel = document.querySelector('input[name="similarityLevel"]:checked')?.value;
            const bgRatio = document.querySelector('input[name="bgRatio"]:checked')?.value;
            
            if (!similarityLevel) {
                alert('请选择相似程度');
                return;
            }
            
            if (!bgRatio) {
                alert('请选择背景图比例');
                return;
            }
            
            // 显示生成状态
            const middlePanelContent = document.getElementById('middlePanelContent');
            middlePanelContent.innerHTML = `
                <div style="text-align: center; padding: 40px;">
                    <div class="loading"></div>
                    <p>正在生成背景图...</p>
                </div>
            `;
            
            // 模拟生成过程
            setTimeout(() => {
                const currentTime = new Date().toLocaleString('zh-CN', {
                    year: 'numeric',
                    month: '2-digit',
                    day: '2-digit',
                    hour: '2-digit',
                    minute: '2-digit',
                    second: '2-digit'
                }).replace(/\//g, '-');
                
                middlePanelContent.innerHTML = `
                    <div style="margin-bottom: 20px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                            <div>
                                <span style="font-weight: 500; color: #333;">背景裂变任务</span>
                                <span style="margin-left: 10px; color: #999; font-size: 12px;">${currentTime}</span>
                            </div>
                            <button class="btn btn-primary" onclick="regenerateBgFission()">重新生成</button>
                        </div>
                        
                        <div class="image-grid" style="grid-template-columns: repeat(3, 1fr); gap: 12px;">
                            <div class="image-item" style="position: relative;">
                                <div style="position: absolute; top: 5px; left: 5px; background: #1890ff; color: white; padding: 2px 6px; border-radius: 3px; font-size: 12px;">7000</div>
                                <img src="https://youke1.picui.cn/s1/2025/08/04/68905925d6370.jpeg" alt="背景裂变结果1" style="width: 100%; height: 120px; object-fit: cover;">
                                <div style="display: flex; gap: 5px; margin-top: 8px; align-items: center;">
                                    <button class="btn btn-secondary" style="font-size: 12px; padding: 4px 8px;" onclick="approveImage('7000')">通过</button>
                                    <button class="btn btn-primary" style="font-size: 12px; padding: 4px 8px;" onclick="downloadSingleImage('7000')">下载</button>
                                    <span class="feedback-icon" onclick="openFeedbackModal('7000')" title="负向反馈">
                                        <img src="https://youke1.picui.cn/s1/2025/08/04/6890570a0432b.png" alt="负向反馈" style="width: 16px; height: 16px;">
                                    </span>
                                </div>
                            </div>
                            <div class="image-item" style="position: relative;">
                                <div style="position: absolute; top: 5px; left: 5px; background: #1890ff; color: white; padding: 2px 6px; border-radius: 3px; font-size: 12px;">7001</div>
                                <img src="https://youke1.picui.cn/s1/2025/08/04/689059264c66b.jpeg" alt="背景裂变结果2" style="width: 100%; height: 120px; object-fit: cover;">
                                <div style="display: flex; gap: 5px; margin-top: 8px; align-items: center;">
                                    <button class="btn btn-secondary" style="font-size: 12px; padding: 4px 8px;" onclick="approveImage('7001')">通过</button>
                                    <button class="btn btn-primary" style="font-size: 12px; padding: 4px 8px;" onclick="downloadSingleImage('7001')">下载</button>
                                    <span class="feedback-icon" onclick="openFeedbackModal('7001')" title="负向反馈">
                                        <img src="https://youke1.picui.cn/s1/2025/08/04/6890570a0432b.png" alt="负向反馈" style="width: 16px; height: 16px;">
                                    </span>
                                </div>
                            </div>
                            <div class="image-item" style="position: relative;">
                                <div style="position: absolute; top: 5px; left: 5px; background: #1890ff; color: white; padding: 2px 6px; border-radius: 3px; font-size: 12px;">7002</div>
                                <img src="https://youke1.picui.cn/s1/2025/08/04/68905926417c1.jpeg" alt="背景裂变结果3" style="width: 100%; height: 120px; object-fit: cover;">
                                <div style="display: flex; gap: 5px; margin-top: 8px; align-items: center;">
                                    <button class="btn btn-secondary" style="font-size: 12px; padding: 4px 8px;" onclick="approveImage('7002')">通过</button>
                                    <button class="btn btn-primary" style="font-size: 12px; padding: 4px 8px;" onclick="downloadSingleImage('7002')">下载</button>
                                    <span class="feedback-icon" onclick="openFeedbackModal('7002')" title="负向反馈">
                                        <img src="https://youke1.picui.cn/s1/2025/08/04/6890570a0432b.png" alt="负向反馈" style="width: 16px; height: 16px;">
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                
                // 添加新任务到任务列表
                addNewTask();
                
            }, 3000);
        }

        // 重新生成背景裂变
        function regenerateBgFission() {
            submitBgFission();
        }

        // 隐藏标签页和商品ID模块
        function hideTabsAndGoodsId() {
            const tabs = document.querySelector('.tabs');
            const goodsIdGroup = document.querySelector('.form-group');
            
            if (tabs) {
                tabs.style.display = 'none';
            }
            
            if (goodsIdGroup) {
                goodsIdGroup.style.display = 'none';
            }
        }

        // 显示标签页和商品ID模块
        function showTabsAndGoodsId() {
            const tabs = document.querySelector('.tabs');
            const goodsIdGroup = document.querySelector('.form-group');
            
            if (tabs) {
                tabs.style.display = 'flex';
            }
            
            if (goodsIdGroup) {
                goodsIdGroup.style.display = 'block';
            }
        }

        // 筛选意见记录
        function filterFeedback() {
            const toolSelect = document.querySelector('select');
            const keywordInput = document.querySelector('input[placeholder="请输入关键字"]');
            const toolFilter = toolSelect ? toolSelect.value : '全部';
            const keywordFilter = keywordInput ? keywordInput.value.toLowerCase() : '';
            
            const rows = document.querySelectorAll('#middlePanelContent tbody tr');
            let visibleCount = 0;
            
            rows.forEach(row => {
                const toolName = row.getAttribute('data-tool') || row.cells[0].textContent;
                const feedbackContent = row.querySelector('.feedback-content').textContent.toLowerCase();
                
                let showRow = true;
                
                // 工具名称筛选
                if (toolFilter !== '全部' && toolName !== toolFilter) {
                    showRow = false;
                }
                
                // 关键字筛选
                if (keywordFilter && !feedbackContent.includes(keywordFilter)) {
                    showRow = false;
                }
                
                row.style.display = showRow ? '' : 'none';
                if (showRow) visibleCount++;
            });
            
            // 显示筛选结果统计
            console.log(`筛选结果：显示 ${visibleCount} 条记录`);
        }

        // 编辑意见记录
        function editFeedback(button) {
            const row = button.closest('tr');
            const feedbackCell = row.querySelector('.feedback-content');
            const currentText = feedbackCell.textContent;
            
            // 打开编辑弹窗
            const modal = document.getElementById('editFeedbackModal');
            const textarea = document.getElementById('editFeedbackText');
            textarea.value = currentText;
            modal.style.display = 'flex';
            
            // 保存当前行引用
            modal.dataset.currentRow = row.rowIndex;
        }

        // 关闭编辑意见记录弹窗
        function closeEditFeedbackModal() {
            const modal = document.getElementById('editFeedbackModal');
            modal.style.display = 'none';
        }

        // 保存意见记录编辑
        function saveFeedbackEdit() {
            const modal = document.getElementById('editFeedbackModal');
            const textarea = document.getElementById('editFeedbackText');
            const newText = textarea.value.trim();
            
            if (!newText) {
                alert('请输入意见记录内容');
                return;
            }
            
            const rowIndex = modal.dataset.currentRow;
            const table = document.querySelector('#middlePanelContent table tbody');
            const row = table.rows[rowIndex - 1];
            
            if (row) {
                const feedbackCell = row.querySelector('.feedback-content');
                feedbackCell.textContent = newText;
            }
            
            closeEditFeedbackModal();
            alert('意见记录已更新');
        }

        // 导出Excel功能
        function exportToExcel() {
            // 获取表格数据
            const table = document.querySelector('#middlePanelContent table');
            if (!table) {
                alert('没有找到表格数据');
                return;
            }
            
            const rows = table.querySelectorAll('tbody tr');
            let csvContent = '工具名称,问题截图,意见记录,提出人,提出日期,操作\n';
            
            rows.forEach(row => {
                const cells = row.querySelectorAll('td');
                const rowData = [];
                
                cells.forEach((cell, index) => {
                    let cellText = cell.textContent.trim();
                    // 跳过操作列
                    if (index === 5) return;
                    // 处理包含逗号的文本
                    if (cellText.includes(',')) {
                        cellText = `"${cellText}"`;
                    }
                    rowData.push(cellText);
                });
                
                csvContent += rowData.join(',') + '\n';
            });
            
            // 创建下载链接
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', `意见管理记录_${new Date().toISOString().split('T')[0]}.csv`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            alert('导出成功！文件已下载到您的下载文件夹。');
        }

        // 虚拟换衣相关函数
        function searchVirtualFittingGoods() {
            const goodsId = document.getElementById('virtualFittingGoodsId').value;
            if (!goodsId) {
                alert('请输入商品ID');
                return;
            }
            
            // 模拟加载状态
            const productInfo = document.getElementById('virtualFittingProductInfo');
            productInfo.style.display = 'block';
            productInfo.innerHTML = '<div style="text-align: center; padding: 20px;"><div class="loading"></div><p>正在查询商品信息...</p></div>';
            
            // 模拟API调用延迟
            setTimeout(() => {
                if (goodsId === '6921308899201171974') {
                    productInfo.innerHTML = `
                        <div style="margin-top: 15px;">
                            <h4 style="margin-bottom: 10px; color: #333;">商品1: ${goodsId}</h4>
                            <div class="image-grid" style="grid-template-columns: repeat(3, 1fr); gap: 8px;">
                                <div class="image-item selected" onclick="selectVirtualFittingImage(this)">
                                    <img src="https://youke1.picui.cn/s1/2025/08/01/688cb7e3003d7.jpg" alt="商品图片">
                                    <div style="position: absolute; bottom: 5px; left: 5px; background: #1890ff; color: white; padding: 2px 6px; border-radius: 3px; font-size: 12px;">✓</div>
                                </div>
                                <div class="image-item" onclick="selectVirtualFittingImage(this)">
                                    <img src="https://youke1.picui.cn/s1/2025/08/01/688cb7e3003d7.jpg" alt="商品图片">
                                </div>
                                <div class="image-item" onclick="selectVirtualFittingImage(this)">
                                    <img src="https://youke1.picui.cn/s1/2025/08/01/688cb7e3003d7.jpg" alt="商品图片">
                                </div>
                            </div>
                        </div>
                        
                        <div style="margin-top: 20px;">
                            <h4 style="margin-bottom: 15px; color: #333;">请确认用于虚拟试衣的该SPUID所属品类 (单选)</h4>
                            <div style="display: flex; gap: 15px;">
                                <label style="display: flex; align-items: center; gap: 5px;">
                                    <input type="radio" name="productCategory" value="top"> 上装
                                </label>
                                <label style="display: flex; align-items: center; gap: 5px;">
                                    <input type="radio" name="productCategory" value="bottom" checked> 下装
                                </label>
                                <label style="display: flex; align-items: center; gap: 5px;">
                                    <input type="radio" name="productCategory" value="set"> 套装
                                </label>
                            </div>
                        </div>
                    `;
                } else {
                    productInfo.innerHTML = `
                        <div class="message error">
                            查询失败，请输正确的商品ID
                        </div>
                    `;
                }
            }, 1500);
        }

        function selectVirtualFittingImage(element) {
            // 移除其他选中状态
            document.querySelectorAll('#virtualFittingProductInfo .image-item').forEach(item => {
                item.classList.remove('selected');
                const checkmark = item.querySelector('div[style*="background: #1890ff"]');
                if (checkmark) checkmark.remove();
            });
            
            // 添加选中状态
            element.classList.add('selected');
            const checkmark = document.createElement('div');
            checkmark.style.cssText = 'position: absolute; bottom: 5px; left: 5px; background: #1890ff; color: white; padding: 2px 6px; border-radius: 3px; font-size: 12px;';
            checkmark.textContent = '✓';
            element.appendChild(checkmark);
        }

        function uploadReferenceImage(index) {
            // 模拟文件上传
            const fileInput = document.createElement('input');
            fileInput.type = 'file';
            fileInput.accept = 'image/*';
            fileInput.onchange = function(e) {
                const file = e.target.files[0];
                if (file) {
                    // 模拟上传成功
                    const imageContainer = document.querySelectorAll('.image-grid .image-item')[index];
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        imageContainer.innerHTML = `<img src="${e.target.result}" alt="参考图${index + 1}" style="width: 100%; height: 120px; object-fit: cover;">`;
                    };
                    reader.readAsDataURL(file);
                }
            };
            fileInput.click();
        }

        function resetTaskName() {
            const taskNameInput = document.getElementById('taskName');
            if (taskNameInput) {
                const now = new Date();
                const dateStr = now.getFullYear().toString() + 
                               (now.getMonth() + 1).toString().padStart(2, '0') + 
                               now.getDate().toString().padStart(2, '0');
                const timeStr = now.getHours().toString().padStart(2, '0') + 
                               now.getMinutes().toString().padStart(2, '0');
                taskNameInput.value = `AI虚拟试衣-${dateStr}-${timeStr}`;
                
                // 更新字符计数
                const charCount = taskNameInput.value.length;
                const charCountSpan = taskNameInput.parentNode.querySelector('span');
                if (charCountSpan) {
                    charCountSpan.textContent = `${charCount}/45`;
                }
            }
        }

        // 虚拟换衣提交功能
        function submitVirtualFitting() {
            const selectedImage = document.querySelector('#virtualFittingProductInfo .image-item.selected');
            if (!selectedImage) {
                alert('请先选择商品图片');
                return;
            }
            
            const referenceImages = document.querySelectorAll('.image-grid .image-item img');
            if (referenceImages.length === 0) {
                alert('请至少上传一张参考图');
                return;
            }
            
            const taskName = document.getElementById('taskName').value;
            if (!taskName.trim()) {
                alert('请输入任务名称');
                return;
            }
            
            // 显示生成状态
            const middlePanelContent = document.getElementById('middlePanelContent');
            middlePanelContent.innerHTML = `
                <div style="text-align: center; padding: 40px;">
                    <div class="loading"></div>
                    <p>正在生成虚拟试衣图片...</p>
                </div>
            `;
            
            // 模拟生成延迟
            setTimeout(() => {
                const currentTime = new Date().toLocaleString();
                middlePanelContent.innerHTML = `
                    <div style="margin-bottom: 20px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                            <div>
                                <span style="font-weight: 500; color: #333;">虚拟试衣任务</span>
                                <span style="margin-left: 10px; color: #999; font-size: 12px;">${currentTime}</span>
                            </div>
                            <button class="btn btn-primary" onclick="regenerateVirtualFitting()">重新生成</button>
                        </div>
                        
                        <div style="display: flex; gap: 20px; margin-bottom: 20px;">
                            <div style="flex: 1; text-align: center;">
                                <h4 style="margin-bottom: 10px;">商品图</h4>
                                <img src="https://youke1.picui.cn/s1/2025/08/01/688cb7e3003d7.jpg" alt="商品图" style="width: 200px; height: 200px; object-fit: cover; border-radius: 8px;">
                            </div>
                            <div style="display: flex; align-items: center; font-size: 24px; color: #999;">+</div>
                            <div style="flex: 1; text-align: center;">
                                <h4 style="margin-bottom: 10px;">参考图</h4>
                                <img src="https://youke1.picui.cn/s1/2025/08/01/688cb7e3003d7.jpg" alt="参考图" style="width: 200px; height: 200px; object-fit: cover; border-radius: 8px;">
                            </div>
                            <div style="display: flex; align-items: center; font-size: 24px; color: #999;">=</div>
                            <div style="flex: 1;">
                                <h4 style="margin-bottom: 10px;">虚拟试衣结果图 ${currentTime}</h4>
                                <div class="image-grid" style="grid-template-columns: repeat(2, 1fr); gap: 12px;">
                                    <div class="image-item" style="position: relative;">
                                        <div style="position: absolute; top: 5px; left: 5px; background: #1890ff; color: white; padding: 2px 6px; border-radius: 3px; font-size: 12px;">8001</div>
                                        <img src="https://youke1.picui.cn/s1/2025/08/01/688cb7e3003d7.jpg" alt="虚拟试衣结果1" style="width: 100%; height: 120px; object-fit: cover;">
                                        <div style="display: flex; gap: 5px; margin-top: 8px; align-items: center;">
                                            <button class="btn btn-secondary" style="font-size: 12px; padding: 4px 8px;" onclick="approveImage('8001')">通过</button>
                                            <button class="btn btn-primary" style="font-size: 12px; padding: 4px 8px;" onclick="downloadSingleImage('8001')">下载</button>
                                        </div>
                                    </div>
                                    <div class="image-item" style="position: relative;">
                                        <div style="position: absolute; top: 5px; left: 5px; background: #1890ff; color: white; padding: 2px 6px; border-radius: 3px; font-size: 12px;">8002</div>
                                        <img src="https://youke1.picui.cn/s1/2025/08/01/688cb7e3003d7.jpg" alt="虚拟试衣结果2" style="width: 100%; height: 120px; object-fit: cover;">
                                        <div style="display: flex; gap: 5px; margin-top: 8px; align-items: center;">
                                            <button class="btn btn-secondary" style="font-size: 12px; padding: 4px 8px;" onclick="approveImage('8002')">通过</button>
                                            <button class="btn btn-primary" style="font-size: 12px; padding: 4px 8px;" onclick="downloadSingleImage('8002')">下载</button>
                                        </div>
                                    </div>
                                    <div class="image-item" style="position: relative;">
                                        <div style="position: absolute; top: 5px; left: 5px; background: #1890ff; color: white; padding: 2px 6px; border-radius: 3px; font-size: 12px;">8003</div>
                                        <img src="https://youke1.picui.cn/s1/2025/08/01/688cb7e3003d7.jpg" alt="虚拟试衣结果3" style="width: 100%; height: 120px; object-fit: cover;">
                                        <div style="display: flex; gap: 5px; margin-top: 8px; align-items: center;">
                                            <button class="btn btn-secondary" style="font-size: 12px; padding: 4px 8px;" onclick="approveImage('8003')">通过</button>
                                            <button class="btn btn-primary" style="font-size: 12px; padding: 4px 8px;" onclick="downloadSingleImage('8003')">下载</button>
                                        </div>
                                    </div>
                                    <div class="image-item" style="position: relative;">
                                        <div style="position: absolute; top: 5px; left: 5px; background: #1890ff; color: white; padding: 2px 6px; border-radius: 3px; font-size: 12px;">8004</div>
                                        <img src="https://youke1.picui.cn/s1/2025/08/01/688cb7e3003d7.jpg" alt="虚拟试衣结果4" style="width: 100%; height: 120px; object-fit: cover;">
                                        <div style="display: flex; gap: 5px; margin-top: 8px; align-items: center;">
                                            <button class="btn btn-secondary" style="font-size: 12px; padding: 4px 8px;" onclick="approveImage('8004')">通过</button>
                                            <button class="btn btn-primary" style="font-size: 12px; padding: 4px 8px;" onclick="downloadSingleImage('8004')">下载</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                
                // 添加新任务到任务列表
                addNewTask();
                
            }, 3000);
        }

        function regenerateVirtualFitting() {
            submitVirtualFitting();
        }

        // 切换虚拟换衣标签页
        function switchVirtualFittingTab(tabName) {
            // 更新标签页状态
            document.querySelectorAll('#virtualFitting .tabs .tab').forEach(tab => {
                tab.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // 显示对应内容
            if (tabName === 'select') {
                document.getElementById('selectProductTab').style.display = 'block';
                document.getElementById('uploadTab').style.display = 'none';
            } else if (tabName === 'upload') {
                document.getElementById('selectProductTab').style.display = 'none';
                document.getElementById('uploadTab').style.display = 'block';
            }
        }

        // 上传商品图片
        function uploadProductImage(index) {
            const fileInput = document.createElement('input');
            fileInput.type = 'file';
            fileInput.accept = 'image/*';
            fileInput.onchange = function(e) {
                const file = e.target.files[0];
                if (file) {
                    const imageContainer = document.querySelectorAll('#uploadTab .image-grid .image-item')[index];
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        imageContainer.innerHTML = `<img src="${e.target.result}" alt="商品图片" style="width: 100%; height: 120px; object-fit: cover;">`;
                    };
                    reader.readAsDataURL(file);
                }
            };
            fileInput.click();
        }

        // 初始化页面
        document.addEventListener('DOMContentLoaded', function() {
            showModule('expand');
            
            // 添加字符计数功能
            document.addEventListener('input', function(e) {
                if (e.target.id === 'promptText') {
                    const charCount = document.getElementById('charCount');
                    if (charCount) {
                        charCount.textContent = e.target.value.length;
                    }
                } else if (e.target.id === 'taskName') {
                    const charCount = e.target.value.length;
                    const charCountSpan = e.target.parentNode.querySelector('span');
                    if (charCountSpan) {
                        charCountSpan.textContent = `${charCount}/45`;
                    }
                } else if (e.target.id === 'stylingSuggestion') {
                    const charCount = e.target.value.length;
                    const charCountSpan = e.target.parentNode.querySelector('span');
                    if (charCountSpan) {
                        charCountSpan.textContent = `${charCount}/50`;
                    }
                }
            });
        });

        // 配置弹窗HTML
        function createConfigModal() {
            const modalHTML = `
                <div id="configModal" class="config-modal" style="display: none;">
                    <div class="config-modal-overlay" onclick="closeConfigModal()"></div>
                    <div class="config-modal-content">
                        <div class="config-modal-header">
                            <h3>配置背景图和价格签</h3>
                            <button class="config-modal-close" onclick="closeConfigModal()">×</button>
                        </div>
                        <div class="config-modal-body">
                            <div class="config-tabs">
                                <div class="config-tab active" onclick="switchConfigTab(this, 'background')">背景图</div>
                                <div class="config-tab" onclick="switchConfigTab(this, 'price')">价格签</div>
                            </div>
                            <div class="config-grid" id="configGrid">
                                <!-- 配置网格内容将根据选中的tab动态显示 -->
                            </div>
                        </div>
                        <div class="config-modal-footer">
                            <button class="btn btn-secondary" onclick="closeConfigModal()">取消</button>
                            <button class="btn btn-primary" onclick="confirmConfig()">确认配置</button>
                        </div>
                    </div>
                </div>
            `;
            
            // 如果弹窗不存在，则添加到body
            if (!document.getElementById('configModal')) {
                document.body.insertAdjacentHTML('beforeend', modalHTML);
            }
        }

        // 显示配置弹窗
        function showConfigModal() {
            createConfigModal();
            const modal = document.getElementById('configModal');
            if (modal) {
                modal.style.display = 'flex';
                // 初始化配置内容
                switchConfigTab(document.querySelector('.config-tab.active'), 'background');
            }
        }

        // 关闭配置弹窗
        function closeConfigModal() {
            const modal = document.getElementById('configModal');
            if (modal) {
                modal.style.display = 'none';
            }
        }

        // 切换配置标签页
        function switchConfigTab(element, tabType) {
            // 移除所有active类
            document.querySelectorAll('.config-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // 为当前tab添加active类
            element.classList.add('active');
            
            // 更新配置网格内容
            updateConfigGrid(tabType);
        }

        // 更新配置网格内容
        function updateConfigGrid(tabType) {
            const configGrid = document.getElementById('configGrid');
            if (!configGrid) return;
            
            if (tabType === 'background') {
                configGrid.innerHTML = generateBackgroundGrid();
            } else if (tabType === 'price') {
                configGrid.innerHTML = generatePriceGrid();
            }
        }

        // 选择配置项目
        function selectConfigItem(element) {
            // 移除其他选中状态
            const configGrid = element.closest('.config-grid');
            if (configGrid) {
                configGrid.querySelectorAll('.config-item').forEach(item => {
                    item.classList.remove('selected');
                });
            }
            
            // 为当前项目添加选中状态
            element.classList.add('selected');
        }

        // 确认配置
        function confirmConfig() {
            const selectedBackground = document.querySelector('.config-grid .config-item.selected[data-type="background"]');
            const selectedPrice = document.querySelector('.config-grid .config-item.selected[data-type="price"]');
            
            if (selectedBackground || selectedPrice) {
                showToast('配置已保存');
                closeConfigModal();
            } else {
                showToast('请至少选择一个配置项');
            }
        }
    </script>
</body>
</html> 